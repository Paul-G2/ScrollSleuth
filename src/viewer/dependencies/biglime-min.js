var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var k=0;return function(){return k<b.length?{done:!1,value:b[k++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.makeIterator=function(b){var k="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return k?k.call(b):$jscomp.arrayIterator(b)};$jscomp.arrayFromIterator=function(b){for(var k,a=[];!(k=b.next()).done;)a.push(k.value);return a};
$jscomp.arrayFromIterable=function(b){return b instanceof Array?b:$jscomp.arrayFromIterator($jscomp.makeIterator(b))};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,k,a){b!=Array.prototype&&b!=Object.prototype&&(b[k]=a.value)};$jscomp.polyfill=function(b,k,a,c){if(k){a=$jscomp.global;b=b.split(".");for(c=0;c<b.length-1;c++){var d=b[c];d in a||(a[d]={});a=a[d]}b=b[b.length-1];c=a[b];k=k(c);k!=c&&null!=k&&$jscomp.defineProperty(a,b,{configurable:!0,writable:!0,value:k})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(b){function k(){this.batch_=null}function a(a){return a instanceof d?a:new d(function(c,b){c(a)})}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;k.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};k.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var c=$jscomp.global.setTimeout;k.prototype.asyncExecuteFunction=function(a){c(a,
0)};k.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var c=0;c<a.length;++c){var b=a[c];a[c]=null;try{b()}catch(m){this.asyncThrow_(m)}}}this.batch_=null};k.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var d=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var c=this.createResolveAndReject_();try{a(c.resolve,c.reject)}catch(h){c.reject(h)}};d.prototype.createResolveAndReject_=
function(){function a(a){return function(d){b||(b=!0,a.call(c,d))}}var c=this,b=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};d.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof d)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var c=null!=a;break a;case "function":c=!0;break a;default:c=!1}c?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};d.prototype.resolveToNonPromiseObj_=function(a){var c=
void 0;try{c=a.then}catch(h){this.reject_(h);return}"function"==typeof c?this.settleSameAsThenable_(c,a):this.fulfill_(a)};d.prototype.reject_=function(a){this.settle_(2,a)};d.prototype.fulfill_=function(a){this.settle_(1,a)};d.prototype.settle_=function(a,c){if(0!=this.state_)throw Error("Cannot settle("+a+", "+c+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=c;this.executeOnSettledCallbacks_()};d.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
0;a<this.onSettledCallbacks_.length;++a)e.asyncExecute(this.onSettledCallbacks_[a]);this.onSettledCallbacks_=null}};var e=new k;d.prototype.settleSameAsPromise_=function(a){var c=this.createResolveAndReject_();a.callWhenSettled_(c.resolve,c.reject)};d.prototype.settleSameAsThenable_=function(a,c){var b=this.createResolveAndReject_();try{a.call(c,b.resolve,b.reject)}catch(m){b.reject(m)}};d.prototype.then=function(a,c){function b(a,c){return"function"==typeof a?function(c){try{e(a(c))}catch(p){f(p)}}:
c}var e,f,g=new d(function(a,c){e=a;f=c});this.callWhenSettled_(b(a,e),b(c,f));return g};d.prototype.catch=function(a){return this.then(void 0,a)};d.prototype.callWhenSettled_=function(a,c){function b(){switch(d.state_){case 1:a(d.result_);break;case 2:c(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?e.asyncExecute(b):this.onSettledCallbacks_.push(b)};d.resolve=a;d.reject=function(a){return new d(function(c,b){b(a)})};d.race=function(c){return new d(function(b,
d){for(var e=$jscomp.makeIterator(c),f=e.next();!f.done;f=e.next())a(f.value).callWhenSettled_(b,d)})};d.all=function(c){var b=$jscomp.makeIterator(c),e=b.next();return e.done?a([]):new d(function(c,d){function f(a){return function(b){g[a]=b;h--;0==h&&c(g)}}var g=[],h=0;do g.push(void 0),h++,a(e.value).callWhenSettled_(f(g.length-1),d),e=b.next();while(!e.done)})};return d},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var b=0;return function(k){return $jscomp.SYMBOL_PREFIX+(k||"")+b++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.asyncIterator;b||(b=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.underscoreProtoCanBeSet=function(){var b={a:!0},k={};try{return k.__proto__=b,k.a}catch(a){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(b,k){b.__proto__=k;if(b.__proto__!==k)throw new TypeError(b+" is not extensible");return b}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(b){if(!(b instanceof Object))throw new TypeError("Iterator result "+b+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(b){this.yieldResult=b};$jscomp.generator.Context.prototype.throw_=function(b){this.abruptCompletion_={exception:b,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(b){this.abruptCompletion_={return:b};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(b){this.abruptCompletion_={jumpTo:b};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(b,k){this.nextAddress=k;return{value:b}};$jscomp.generator.Context.prototype.yieldAll=function(b,k){b=$jscomp.makeIterator(b);var a=b.next();$jscomp.generator.ensureIteratorResultIsObject_(a);if(a.done)this.yieldResult=a.value,this.nextAddress=k;else return this.yieldAllIterator_=b,this.yield(a.value,k)};
$jscomp.generator.Context.prototype.jumpTo=function(b){this.nextAddress=b};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(b,k){this.catchAddress_=b;void 0!=k&&(this.finallyAddress_=k)};$jscomp.generator.Context.prototype.setFinallyBlock=function(b){this.catchAddress_=0;this.finallyAddress_=b||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(b,k){this.nextAddress=b;this.catchAddress_=k||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(b){this.catchAddress_=b||0;b=this.abruptCompletion_.exception;this.abruptCompletion_=null;return b};$jscomp.generator.Context.prototype.enterFinallyBlock=function(b,k,a){a?this.finallyContexts_[a]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=b||0;this.finallyAddress_=k||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(b,k){k=this.finallyContexts_.splice(k||0)[0];if(k=this.abruptCompletion_=this.abruptCompletion_||k){if(k.isException)return this.jumpToErrorHandler_();void 0!=k.jumpTo&&this.finallyAddress_<k.jumpTo?(this.nextAddress=k.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=b};$jscomp.generator.Context.prototype.forIn=function(b){return new $jscomp.generator.Context.PropertyIterator(b)};
$jscomp.generator.Context.PropertyIterator=function(b){this.object_=b;this.properties_=[];for(var k in b)this.properties_.push(k);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var b=this.properties_.pop();if(b in this.object_)return b}return null};$jscomp.generator.Engine_=function(b){this.context_=new $jscomp.generator.Context;this.program_=b};
$jscomp.generator.Engine_.prototype.next_=function(b){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,b,this.context_.next_);this.context_.next_(b);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(b){this.context_.start_();var k=this.context_.yieldAllIterator_;if(k)return this.yieldAllStep_("return"in k?k["return"]:function(a){return{value:a,done:!0}},b,this.context_.return);this.context_.return(b);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(b){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],b,this.context_.next_);this.context_.throw_(b);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(b,k,a){try{var c=b.call(this.context_.yieldAllIterator_,k);$jscomp.generator.ensureIteratorResultIsObject_(c);if(!c.done)return this.context_.stop_(),c;var d=c.value}catch(e){return this.context_.yieldAllIterator_=null,this.context_.throw_(e),this.nextStep_()}this.context_.yieldAllIterator_=null;a.call(this.context_,d);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var b=this.program_(this.context_);if(b)return this.context_.stop_(),{value:b.value,done:!1}}catch(k){this.context_.yieldResult=void 0,this.context_.throw_(k)}this.context_.stop_();if(this.context_.abruptCompletion_){b=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(b.isException)throw b.exception;return{value:b.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(b){this.next=function(k){return b.next_(k)};this.throw=function(k){return b.throw_(k)};this.return=function(k){return b.return_(k)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(b,k){k=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(k));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(k,b.prototype);return k};
$jscomp.asyncExecutePromiseGenerator=function(b){function k(a){return b.next(a)}function a(a){return b.throw(a)}return new Promise(function(c,d){function e(b){b.done?c(b.value):Promise.resolve(b.value).then(k,a).then(e,d)}e(b.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(b){return $jscomp.asyncExecutePromiseGenerator(b())};$jscomp.asyncExecutePromiseGeneratorProgram=function(b){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b)))};
$jscomp.checkStringArgs=function(b,k,a){if(null==b)throw new TypeError("The 'this' value for String.prototype."+a+" must not be null or undefined");if(k instanceof RegExp)throw new TypeError("First argument to String.prototype."+a+" must not be a regular expression");return b+""};
$jscomp.polyfill("String.prototype.endsWith",function(b){return b?b:function(b,a){var c=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===a&&(a=c.length);a=Math.max(0,Math.min(a|0,c.length));for(var d=b.length;0<d&&0<a;)if(c[--a]!=b[--d])return!1;return 0>=d}},"es6","es3");$jscomp.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6","es3");$jscomp.polyfill("Number.MIN_SAFE_INTEGER",function(){return-9007199254740991},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(b){return b?b:function(b,a,c){var d=this.length||0;0>a&&(a=Math.max(0,d+a));if(null==c||c>d)c=d;c=Number(c);0>c&&(c=Math.max(0,d+c));for(a=Number(a||0);a<c;a++)this[a]=b;return this}},"es6","es3");
$jscomp.iteratorFromArray=function(b,k){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var a=0,c={next:function(){if(a<b.length){var d=a++;return{value:k(d,b[d]),done:!1}}c.next=function(){return{done:!0,value:void 0}};return c.next()}};c[Symbol.iterator]=function(){return c};return c};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.polyfill("Math.sign",function(b){return b?b:function(b){b=Number(b);return 0===b||isNaN(b)?b:0<b?1:-1}},"es6","es3");
(function(b,k){b.Ui=function(){};b.Ui.DefaultFont="verdana";b.Ui.Background="#7092BE";b.Ui.Foreground="#CCEEFE";b.Ui.UidCounter=1;b.Ui.CreateElement=function(a,c,d,e,f,g){g=g===k?!0:g;a=document.createElement(a);a.id=c;d&&d.append(a);b.Ui.StyleElement(a,e,f,g);return a};b.Ui.StyleElement=function(a,c,b,e){e=e===k?!0:e;if(c)for(var d in c)if(Object.prototype.hasOwnProperty.call(c,d)){var g=c[d];"number"===typeof g?g=g.toString()+"px":"string"===typeof g&&1<g.trim().length&&!isNaN(Number(g.slice(0,
-1)))&&g.endsWith("n")&&(g=Number(g.slice(0,-1)));a.style[d]=g}if(b)for(var h in b)Object.prototype.hasOwnProperty.call(b,h)&&(a[h]=b[h]);e&&(c&&c.hasOwnProperty("position")||(a.style.position="absolute"),c&&c.hasOwnProperty("margin")||(a.style.margin="0px"),c&&c.hasOwnProperty("padding")||(a.style.padding="0px"));return a};b.Ui.CreateButton=function(a,c,d){d=d||b.Ui.Foreground;var e="button_"+(b.Ui.UidCounter++).toString();a=b.Ui.CreateElement("div","button_div",a);b.Ui.CreateElement("button",e,
a,{width:"100%",height:"100%",border:"0",outline:"none",boxShadow:"none",fontSize:"14px",fontFamily:b.Ui.DefaultFont,backgroundColor:d},{innerHTML:c});return a};b.Ui.CreateLoadFileButton=function(a){a=a===k?{}:a;var c=a.styles||{};c.display="flex";c.flexDirection="row";c.textAlign="center";c.alignItems="center";c.justifyContent="center";c.fontSize=c.fontSize||14;c.fontFamily=c.fontFamily||b.Ui.DefaultFont;a.flatStyle&&(c.border=0,c.boxShadow="none",c.borderRadius="0px");var d=b.Ui.CreateElement("button",
a.id,a.parent,c,{innerHTML:a.text}),e=a.dbTag||"biglimeRecentDirHandle";d.addEventListener(b.Utils.isTouchDevice()?"touchstart":"click",function(){if(!d.ignoreClicks)if(d.ignoreClicks=!0,b.Utils.isTouchDevice())showOpenFilePicker({multiple:a.multiple}).then(function(c){d.ignoreClicks=!1;a.callback&&a.callback(c)}).catch(function(a){d.ignoreClicks=!1});else{var c=b.UtilityDb.Instance();c.get(e).then(function(b){showOpenFilePicker({multiple:a.multiple,startIn:b?b.value:k}).then(function(b){d.ignoreClicks=
!1;0<b.length&&c.put(e,b[0]);a.callback&&a.callback(b)}).catch(function(a){d.ignoreClicks=!1})})}});return d};b.Ui.CreateSaveFileButton=function(a){a=a===k?{}:a;var c=a.styles||{};c.display="flex";c.flexDirection="row";c.textAlign="center";c.alignItems="center";c.justifyContent="center";c.fontSize=c.fontSize||14;c.fontFamily=c.fontFamily||b.Ui.DefaultFont;a.flatStyle&&(c.border=0,c.boxShadow="none",c.borderRadius="0px");c=b.Ui.CreateElement("button",a.id,a.parent,c,{innerHTML:a.text});var d=a.dbTag||
"biglimeRecentDirHandle",e=a.suggestedName||k;c.addEventListener(b.Utils.isTouchDevice()?"touchstart":"click",function(){var c=b.UtilityDb.Instance();c.get(d).then(function(b){b=b?b.value:k;var f=b instanceof FileSystemFileHandle?b.name:k;showSaveFilePicker({startIn:b,suggestedName:e||f}).then(function(b){b&&c.put(d,b);a.callback&&a.callback(b)}).catch(function(a){})})});return c};b.Ui.CreateButtonGroup=function(a,c,d,e,f,g){d=d||{};g=g||{};d.border=d.border===k?"1px solid #606060":d.border;c=b.Ui.CreateElement("div",
a+"_host_div",c,d);var h=[],m=parseInt(c.style.height,10),l=e.length;d=d.fontSize||24;var n=g.btnSize||24;m=(m-l*n)/(l+1);l=!g.independent;g=g.btnLeft||d;for(var q=function(a){a.target.btn.click()},r=function(a){a.target.btn.dblclick()},t=0;t<e.length;t++){var p=e[t],u=m+t*(m+n),v={type:l?"radio":"checkbox",name:l?a:a+"_"+p.value,value:p.value};p.checked&&(v.checked=!0);v=b.Ui.CreateElement("input",a+"_"+p.value+"_btn",c,{top:u,left:g,width:n,height:n},v);f&&v.addEventListener("change",f);h.push(v);
p=b.Ui.CreateElement("label","",c,{top:u+n/2-(d+2)/2,left:g+n+.5*d,fontSize:d},{innerHTML:p.label,btn:v});p.addEventListener("click",q);p.addEventListener("dblclick",r)}return{div:c,btns:h}};b.Ui.CreateHSlider=function(a,c,d,e,f,g,h,m,l){c=b.Ui.CreateElement("div",a+"_div",c,d.styles,d.props);var n=d.styles.fontSize||18,q=parseInt(d.styles.height,10);f.styles.top=q/2-n/2;f.styles.textAlign="left";b.Ui.CreateElement("label","slider_label",c,f.styles,f.props);var k=e.props.hasOwnProperty("valueScale")?
e.props.valueScale:1,t=e.props.hasOwnProperty("xfrm")?e.props.xfrm:function(a){return a*k};e.styles.left=f.styles.width+10;e.styles.height=d.styles.height;e.styles.width=d.styles.width-f.styles.width-g.styles.width-20;e.props.type="range";var p=b.Ui.CreateElement("input",a+"_inp",c,e.styles,e.props);h&&p.addEventListener("input",function(){h(t(parseInt(p.value)))});m&&p.addEventListener(b.Utils.isTouchDevice()?"touchstart":"mousedown",m);l&&p.addEventListener(b.Utils.isTouchDevice()?"touchend":"mouseup",
l);var u=e.props.decimals||0===e.props.decimals?e.props.decimals:2;g.props.innerHTML=t(parseInt(p.value)).toFixed(u).toString();g.styles.top=q/2-(n+2)/2;g.styles.right=0;g.styles.textAlign="left";var v=b.Ui.CreateElement("label","slider_val_label",c,g.styles,g.props);p.valLabel=v;p.addEventListener("input",function(a){v.innerHTML=t(parseInt(p.value)).toFixed(u).toString()});return p};b.Ui.CreateNumericInput=function(a,c,d,e,f,g){g=g===k?"change":g;var h=b.Ui;d=d||{};d.display="flex";d.alignItems=
"center";c=h.CreateElement("div",a+"_div",c,d);e=e||{};var m=e.min||0===e.min?e.min:0,l=e.max||0===e.max?e.max:10,n=d.fontSize||18,q=d.inpWidth||5*n;a=h.CreateElement("input",a+"_inp",c,{height:"100%",width:q,fontSize:n,textAlign:d.textAlign||"left"},{type:"number",min:m.toString(),max:l.toString(),value:(e.val||0===e.val?e.val:(l+m)/2).toString(),step:(e.step||0===e.step?e.step:(l-m)/10).toString()});f&&a.addEventListener(g,f);e.label&&h.CreateElement("label","lbl",c,{fontSize:n,left:q},{innerHTML:"&nbsp;&nbsp;"+
e.label});return a};b.Ui.OnClickAndDoubleClick=function(a,c,d,e){a.Namespace={};a.Namespace.clicks=0;a.Namespace.clickTimer=a.Namespace.clickTimer||null;var f=b.Utils.isTouchDevice()?"tap":"click";a.addEventListener(f,function(b){if(e){if(null===b.data||b.data===k)b.data={};for(var f in e)b.data[f]=e[f]}a.Namespace.clicks++;1===a.Namespace.clicks?a.Namespace.clickTimer=setTimeout(function(){c(b);a.Namespace.clicks=0},300):(clearTimeout(a.Namespace.clickTimer),d(b),a.Namespace.clicks=0)});a.addEventListener("dblclick",
function(a){a.preventDefault()})}})(window.BigLime=window.BigLime||{});
(function(b){function k(a,d){a=b(this);!0!==a.data("tap_event")&&a.bind("touchend.tap",c).bind("touchmove.tap",function(){e=!0}).data("tap_event",!0)}function a(a){b(this).unbind("touchend.tap touchmove.tap")}function c(a){if(e)return e=!1;var c=b(a.target),f=c.data("lastTouch")||0,m=a.timeStamp;f=m-f;if(20<f&&500>f)return clearTimeout(d),a.preventDefault(),c.data("lastTouch",0).trigger("doubleTap");c.data("lastTouch",m);d=setTimeout(function(){c.trigger("tap")},500)}if("undefined"!==typeof b){var d,
e=!1;b.event.special.doubleTap={setup:k,teardown:a,handler:c};b.event.special.tap={setup:k,teardown:a,handler:c}}})(window.jQuery);(function(b,k){b.Annotation=function(a,c,b,e,f){a=a===k?"":a;c=c===k?"#FF0000":c;b=b===k?!1:b;e=e===k?2:e;f=f===k?!0:f;this.name=a;this.color=c;this.filled=b;this.lineWidth=e;this.visible=f};b.Annotation.prototype.contains=function(a){return!1}})(window.BigLime=window.BigLime||{});
(function(b,k){b.PixelType={Byte:0,Ushort:1,Int:2,RGB:3,Float32:4};Object.freeze(b.PixelType);b.ImageBase=function(a,c,b){this.width=a;this.height=c;this.pixelType=b;this.attrs={};this.attrs.dicomAttrs={};this.annots=[];this.overlays=[]};b.ImageBase.createImage=function(a,c,d,e){if(d==b.PixelType.Byte)return new b.ByteImage(a,c,e);if(d==b.PixelType.Ushort)return new b.UshortImage(a,c,e);if(d==b.PixelType.Int)return new b.IntImage(a,c,e);if(d==b.PixelType.Float32)return new b.FloatImage(a,c,e);if(d==
b.PixelType.RGB)return new b.RGBImage(a,c,e);throw"Unsupported image type, in Namespace.ImageBase.createImage";};b.ImageBase.prototype.setValue=function(a,c,d){this.pixelType===b.PixelType.RGB?(a=3*(a+c*this.width),this.data[a]=d.r,this.data[a+1]=d.g,this.data[a+2]=d.b):this.data[a+c*this.width]=d};b.ImageBase.prototype.getValue=function(a,c){return this.pixelType===b.PixelType.RGB?(a=3*(a+c*this.width),new b.Color(this.data[a],this.data[a+1],this.data[a+2])):this.data[a+c*this.width]};b.ImageBase.prototype.getValueLin=
function(a,c){var d=this.width,e=this.height;if(0>a||a>=d||0>c||c>=e)return 0;var f=Math.floor(a-.5),g=Math.floor(c-.5),h=Math.min(f+1,d-1);e=Math.min(g+1,e-1);a=a-.5-f;c=c-.5-g;var m=1-a,l=1-c,n=this.data;if(this.pixelType===b.PixelType.RGB){var q=3*(f+g*d);f=3*(f+e*d);g=3*(h+g*d);d=3*(h+e*d);return new b.Color(Math.round(l*(m*n[q]+a*n[g])+c*(m*n[f]+a*n[d])),Math.round(l*(m*n[q+1]+a*n[g+1])+c*(m*n[f+1]+a*n[d+1])),Math.round(l*(m*n[q+2]+a*n[g+2])+c*(m*n[f+2]+a*n[d+2])))}return l*(m*n[g*d+f]+a*n[g*
d+h])+c*(m*n[e*d+f]+a*n[e*d+h])};b.ImageBase.prototype.setToZero=function(){for(var a=this.data,c=a.length,b=0;b<c;b++)a[b]=0};b.ImageBase.prototype.addAnnotation=function(a){this.annots.push(a);return a};b.ImageBase.prototype.removeAnnotation=function(a){a=this.annots.indexOf(a);return-1<a?this.annots.splice(a,1)[0]:null};b.ImageBase.prototype.getAnnotations=function(a){return this.annots.filter(function(c){return c.name===a})};b.ImageBase.prototype.addOverlay=function(a){this.overlays.push(a);return a};
b.ImageBase.prototype.removeOverlay=function(a){a=this.overlays.indexOf(a);return-1<a?this.overlays.splice(a,1)[0]:null};b.ImageBase.prototype.getOverlay=function(a){for(var c=[],b=0;b<this.overlays.length;b++)this.overlays[b].name==a&&c.push(this.overlays[b]);return c};b.ImageBase.prototype.copyPropertiesFrom=function(a,c,b){if("undefined"===typeof c||!0===c)this.attrs=JSON.parse(JSON.stringify(a.attrs));if("undefined"===typeof b||!0===b){this.annots=[];c=0;for(b=a.annots.length;c<b;c++)this.annots.push(a.annots[c].clone());
this.overlays=[];c=0;for(b=a.overlays.length;c<b;c++)this.overlays.push(a.overlays[c].clone())}}})(window.BigLime=window.BigLime||{});
(function(b,k){b.VpTool=function(a,c,d){this.text=a||"";this.name=c||(a?a.replace(/([^a-z0-9_]+)/gi,""):"vptool");this.eventTypes=d||{btns:0,shift:!1,ctrl:!1,alt:!1,meta:!1};this.toolBar=this.btn=null;this.alwaysActive=this.isActive=this.isInteractor=!1;this.cursor="default";this.rafId=null;this.pinching=this.dragging=!1;this.currPoint=new b.Vec2;this.prevPoint=new b.Vec2;this.startPoint=new b.Vec2;this.deltaPrev=new b.Vec2;this.deltaStart=new b.Vec2;this.pinchProps=b.VpTool.calcPinchProperties(null)};
b.VpTool.InactiveToolColor="#ccecfe";b.VpTool.ActiveToolColor="#6fc8fd";b.VpTool.prototype._buildUi=function(a){var c=$('<div id="'+this.name+'_maindiv">')[0];this.btn=$('<button id="'+this.name+'_btn">')[0];this.btn.innerHTML=this.text;c.append(this.btn);b.VpTool.styleDefaultButton(this.btn);var d=this,e=function(){d.toolBar&&d.toolBar._onToolButtonClicked(d)},f=function(){d.toolBar&&d.toolBar._onToolButtonDoubleClicked(d)};if(b.Utils.isTouchDevice()){if($(this.btn).on("tap",e),!a)$(this.btn).on("doubleTap",
f)}else if(a)$(this.btn).on("click",e);else b.Ui.OnClickAndDoubleClick(this.btn,e,f);return c};b.VpTool.styleDefaultButton=function(a){$(a).css("width","100%");$(a).css("height","100%");$(a).css("border","0");$(a).css("outline","none");$(a).css("padding","0");$(a).css("box-shadow","none");$(a).css("font-size","14px");$(a).css("font-family",b.Viewport.fontFamily);$(a).css("background-color",b.VpTool.InactiveToolColor)};b.VpTool.prototype.setParentToolBar=function(a){this.toolBar=a};b.VpTool.prototype._blurUi=
function(){this.btn&&$(this.btn).blur()};b.VpTool.prototype.setActive=function(a,c){a!=this.isActive&&(this.dragging||this.pinching)&&this._onPointerUp&&this._onPointerUp({data:{}});(this.isActive=a)||this.stopAnimation();this._updateUi();if(a&&c)for(a=0;a<c.length;a++){var b=$.isArray(this.cursor)?this.cursor:[this.cursor];b.push("default");for(var e=b.length-1;0<=e;e--)$(c[a].innerVp.displayCanvas).css("cursor",b[e])}};b.VpTool.prototype._updateUi=function(){if(this.btn){var a=this.isActive?b.VpTool.ActiveToolColor:
b.VpTool.InactiveToolColor;$(this.btn).css("background-color",a)}};b.VpTool.prototype._onNewImage=function(){};b.VpTool.prototype._onViewportParamChange=function(a){};b.VpTool.prototype._updateCurrentPointFromEvent=function(a){var c=b.VpTool.getEventCoordinates(a);if(null===c.x||null===c.y)return!1;var d=b.Vec2.zero();a.data&&a.data.vp&&(a=a.data.vp.innerVp.displayCanvas.getBoundingClientRect(),b.Vec2.set(d,a.left,a.top));b.Vec2.subtract(this.currPoint,c,d);return!0};b.VpTool.MouseEventMatches=function(a,
c){Array.isArray(c)||(c=[c]);c=$jscomp.makeIterator(c);for(var b=c.next();!b.done;b=c.next())if(b=b.value,(Array.isArray(b.btns)?b.btns:[b.btns]).some(function(c){return c===a.button})&&!(b.shift!==k&&b.shift!==a.shiftKey||b.ctrl!==k&&b.ctrl!==(a.ctrlKey||a.metaKey)||b.alt!==k&&b.alt!==a.altKey||b.meta!==k&&b.meta!==a.metaKey))return!0;return!1};b.VpTool.getEventCoordinates=function(a){var c=a.clientX,d=a.clientY;("undefined"===typeof c||"undefined"===typeof d||null===c||null===d)&&a.originalEvent&&
a.originalEvent.targetTouches&&0<a.originalEvent.targetTouches.length&&(c=a.originalEvent.targetTouches[0].clientX,d=a.originalEvent.targetTouches[0].clientY);if("undefined"===typeof c||"undefined"===typeof d)c=d=null;return new b.Vec2(c,d)};b.VpTool.calcPinchProperties=function(a){var c={separation:1,center:new b.Vec2,angle:0};if(a&&a.originalEvent&&a.originalEvent.targetTouches&&1<a.originalEvent.targetTouches.length){var d=a.originalEvent.targetTouches[0].clientX,e=a.originalEvent.targetTouches[0].clientY,
f=a.originalEvent.targetTouches[1].clientX;a=a.originalEvent.targetTouches[1].clientY;c.separation=Math.sqrt((f-d)*(f-d)+(a-e)*(a-e));b.Vec2.set(c.center,(d+f)/2,(e+a)/2);c.angle=Math.atan2(e-a,f-d)}return c};b.VpTool.prototype.startAnimation=function(a,c){if(!this.rafId&&0!==this.rafId){var d=this,e=function(){a&&a(c);d.rafId=b.Utils.requestAnimFrame(e)};this.rafId=b.Utils.requestAnimFrame(e)}};b.VpTool.prototype.stopAnimation=function(){if(this.rafId||0===this.rafId)b.Utils.cancelAnimFrame(this.rafId),
this.rafId=null};b.VpTool.prototype.addEventListener=function(a,c){b.Notifier.prototype.addEventListener.call(this,a,c)};b.VpTool.prototype.removeEventListener=function(a,c){b.Notifier.prototype.removeEventListener.call(this,a,c)};b.VpTool.prototype.trigger=function(a,c){b.Notifier.prototype.trigger.call(this,a,c)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Color=function(a,c,b,e){"undefined"===typeof e&&(e=255);this.r=Math.round(Math.max(0,Math.min(255,a)));this.g=Math.round(Math.max(0,Math.min(255,c)));this.b=Math.round(Math.max(0,Math.min(255,b)));this.a=Math.round(Math.max(0,Math.min(255,e)))};b.Color.FromObj=function(a){return new b.Color(a.r,a.g,a.b,a.a)};b.Color.Clone=function(a){return new b.Color(a.r,a.g,a.b,a.a)};b.Color.prototype.valueEquals=function(a){return this===a?!0:a?this.r==a.r&&this.g==a.g&&this.b==a.b&&this.a==a.a:
!1};b.Color.AreEqual=function(a,c){return a&&c?a.r==c.r&&a.g==c.g&&a.b==c.b&&a.a==c.a:!1};b.Color.ScaleTo1=function(a){return[a.r/255,a.g/255,a.b/255,a.a/255]};b.Color.ToArray=function(a){return[a.r,a.g,a.b,a.a]};b.Color.prototype.toString=function(){return"("+this.r.toString()+", "+this.g.toString()+", "+this.b.toString()+", "+this.a.toString()+")"};b.Color.FromString=function(a){var c=new b.Color(0,0,0);try{var d=a.replace(/[()]/g,"").split(",");c=new b.Color(parseInt(d[0]),parseInt(d[1]),parseInt(d[2]),
parseInt(d[3]))}catch(e){b.Logger.Report("Color.FromString: invalid input string.",b.Logger.Severity.Warn)}return c};b.Color.ToHexString=function(a){return"#"+("0"+a.r.toString(16)).slice(-2).toUpperCase()+("0"+a.g.toString(16)).slice(-2).toUpperCase()+("0"+a.b.toString(16)).slice(-2).toUpperCase()};b.Color.ArrayToHexString=function(a){return"#"+("0"+a[0].toString(16)).slice(-2).toUpperCase()+("0"+a[1].toString(16)).slice(-2).toUpperCase()+("0"+a[2].toString(16)).slice(-2).toUpperCase()};b.Color.prototype.toHexString=
function(){return b.Color.ToHexString(this)};b.Color.FromHexString=function(a,c){a=a.replace("#","");a=parseInt(a,16);var d=new b.Color(0,0,0,255);d.r=a>>16&255;d.g=a>>8&255;d.b=a&255;d.a=c||0===c?c:255;return d};b.Color.FromName=function(a,c){try{var d=document.createElement("canvas").getContext("2d");d.fillStyle=a;var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(d.fillStyle),f=new b.Color(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),255);c&&(f=b.Color.ScaleTo1(f));return f}catch(g){return b.Logger.Report("Color.NameToColor: Invalid color name.",
b.Logger.Severity.Warn),new b.Color(0,0,0,255)}};b.Color.Black=function(a){return a?new b.Color(0,0,0,1):new b.Color(0,0,0,255)};b.Color.White=function(a){return a?new b.Color(1,1,1,1):new b.Color(255,255,255,255)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Dialog=function(a){a=a||{};this.parent=a.parent||document.body;this.title=a.title||"";this.width=a.width;this.height=a.height;this.modal=a.modal;this.bkgndColor=a.bkgndColor||b.Dialog.BkgndColor;this.titleBarColor=a.titleBarColor||b.Dialog.TitleBarColor;this.borderWidth=a.borderWidth||0;this.borderColor=a.borderColor||"#000000";this.mainDiv=null;this.prevMouseLoc=[0,0];this.pointerDownFunc=this._onPointerDown.bind(this);this.pointerMoveFunc=this._onPointerMove.bind(this);this.pointerUpFunc=
this._onPointerUp.bind(this);this.onCancel=this.onOk=null;this.neverBeenShown=!0;this._initUi()};b.Dialog.FontFamily=b.Ui.DefaultFont;b.Dialog.BkgndColor="#D5BFA2";b.Dialog.TitleBarColor="#BEA074";b.Dialog.prototype.setContent=function(a){this.mainDiv.append(a);b.Ui.StyleElement(a,{position:"absolute",left:"0px",right:"0px",top:"32px",bottom:"0px"},{},!1)};b.Dialog.prototype._initUi=function(){var a=b.Ui;this.mainDiv=a.CreateElement("div","dialog_maindiv",this.parent,{position:"absolute",width:this.width,
height:this.height,display:"none",zIndex:"9",backgroundColor:this.bkgndColor,fontSize:"16px",fontFamily:b.Dialog.FontFamily,border:this.borderWidth?this.borderWidth+"px solid "+this.borderColor:"none"});this.titleDiv=a.CreateElement("div","dialog_titlediv",this.mainDiv,{position:"absolute",left:"0px",right:"32px",top:"0px",height:"32px",lineHeight:"32px",textAlign:"center",verticalAlign:"middle",backgroundColor:this.titleBarColor,fontSize:"16px",fontFamily:b.Dialog.FontFamily,userSelect:"none",MsUserSelect:"none",
MozUserSelect:"none",WebkitUserSelect:"none"},{innerHTML:this.title});this.titleDiv.addEventListener("pointerdown",this.pointerDownFunc);this.closeDiv=a.CreateElement("div","dialog_closediv",this.mainDiv,{position:"absolute",width:"32px",height:"32px",right:"0px",top:"0px",lineHeight:"32px",textAlign:"center",verticalAlign:"middle",backgroundColor:this.titleBarColor,fontSize:"16px",fontFamily:b.Dialog.FontFamily,userSelect:"none",MsUserSelect:"none",MozUserSelect:"none",WebkitUserSelect:"none"},{innerHTML:"X"});
this.closeDiv.addEventListener(b.Utils.isTouchDevice()?"touchstart":"click",this._onTitleBarClose.bind(this));this.closeDiv.addEventListener("mouseover",function(){this.closeDiv.style.fontWeight="bold"}.bind(this));this.closeDiv.addEventListener("mouseout",function(){this.closeDiv.style.fontWeight="normal"}.bind(this));this.escapeListener=function(a){a=a||window.event;if("key"in a?"Escape"===a.key||"Esc"===a.key:27===a.keyCode)this.hide(),a.stopImmediatePropagation(),a.preventDefault()}.bind(this)};
b.Dialog.prototype.show=function(a,c){a&&(this.onOk=a);c&&(this.onCancel=c);"none"==this.mainDiv.style.display&&(this.mainDiv.style.display="inline-block",this.neverBeenShown&&(this.neverBeenShown=!1,a=this.mainDiv.getBoundingClientRect(),c=this.parent.getBoundingClientRect(),b.Ui.StyleElement(this.mainDiv,{left:(c.width-a.width)/2+"px",top:(c.height-a.height)/2+"px"})),document.addEventListener("keydown",this.escapeListener));this.trigger("shown")};b.Dialog.prototype.hide=function(){this.mainDiv.style.display=
"none";document.removeEventListener("keydown",this.escapeListener);this.trigger("hidden")};b.Dialog.prototype.isShown=function(){return"none"!=this.mainDiv.style.display};b.Dialog.prototype._onTitleBarClose=function(){if(this.onCancel)this.onCancel(this);this.hide()};b.Dialog.prototype._onPointerDown=function(a){if(!this.dragging){var c=b.Dialog._getEventCoordinates(a);null!==c[0]&&null!==c[1]&&(this.dragging=!0,this.pointerId=a.pointerId,a.preventDefault(),a.stopImmediatePropagation(),this.prevMouseLoc=
[c[0],c[1]],document.addEventListener("pointermove",this.pointerMoveFunc),document.addEventListener("pointerup",this.pointerUpFunc))}};b.Dialog.prototype._onPointerMove=function(a){if(this.dragging&&a.pointerId==this.pointerId){var c=b.Dialog._getEventCoordinates(a);if(null!==c[0]&&null!==c[1])try{a.preventDefault();a.stopImmediatePropagation();var d=[c[0]-this.prevMouseLoc[0],c[1]-this.prevMouseLoc[1]];this.prevMouseLoc=[c[0],c[1]];var e=this.mainDiv.getBoundingClientRect(),f=b.Dialog._getElementWidth(this.parent),
g=b.Dialog._getElementHeight(this.parent),h=Math.max(64-e.width,Math.min(f-64,parseInt(this.mainDiv.style.left,10)+d[0])),m=Math.max(0,Math.min(g-64,parseInt(this.mainDiv.style.top,10)+d[1]));this.mainDiv.style.left=h.toString()+"px";this.mainDiv.style.top=m.toString()+"px"}catch(l){}}};b.Dialog.prototype._onPointerUp=function(a){this.dragging&&a.pointerId===this.pointerId&&(document.removeEventListener("pointermove",this.pointerMoveFunc),document.removeEventListener("pointerup",this.pointerUpFunc),
this.dragging=!1,this.pointerId=k,a.preventDefault(),a.stopImmediatePropagation())};b.Dialog._getEventCoordinates=function(a){var c=a.clientX,d=a.clientY;("undefined"==typeof c||"undefined"==typeof d||null===c||null===d)&&b.Utils.isTouchDevice()&&a.originalEvent&&a.originalEvent.targetTouches&&0<a.originalEvent.targetTouches.length&&(c=a.originalEvent.targetTouches[0].clientX,d=a.originalEvent.targetTouches[0].clientY);if("undefined"==typeof c||"undefined"==typeof d)c=d=null;return[c,d]};b.Dialog._getElementHeight=
function(a){return parseFloat(a.getBoundingClientRect().height)||window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight};b.Dialog._getElementWidth=function(a){return parseFloat(a.getBoundingClientRect().width)||window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth};b.Dialog.prototype.addEventListener=function(a,c){b.Notifier.prototype.addEventListener.call(this,a,c)};b.Dialog.prototype.removeEventListener=function(a,c){b.Notifier.prototype.removeEventListener.call(this,
a,c)};b.Dialog.prototype.trigger=function(a,c){b.Notifier.prototype.trigger.call(this,a,c)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.FpsAnimator=function(a,c){this.fps=a||10;this.drawFunc=c;this.loopFunc=this._loop.bind(this);this.isPlaying=!1;this.frame=-1;this.rafId=this.time=null};b.FpsAnimator.prototype.start=function(){this.isPlaying||(this.isPlaying=!0,this.rafId=b.Utils.requestAnimFrame(this.loopFunc))};b.FpsAnimator.prototype.stop=function(){this.isPlaying&&(b.Utils.cancelAnimFrame(this.rafId),this.isPlaying=!1,this.time=null,this.frame=-1)};b.FpsAnimator.prototype.setFrameRate=function(a){this.fps=a};
b.FpsAnimator.prototype._loop=function(a){null===this.time&&(this.time=a);a=Math.floor((a-this.time)*this.fps/1E3);a>this.frame&&(this.frame=a,this.drawFunc());this.rafId=requestAnimationFrame(this.loopFunc)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Logger=function(){};b.Logger.Severity={Debug:0,Info:1,Client:2,Warning:3,Warn:3,Error:4};Object.freeze(b.Logger.Severity);b.Logger.ConsoleThresh=b.Logger.Severity.Info;b.Logger._MaxIncidents=1E3;b.Logger._IncidentList=[];b.Logger._NumErrors=0;b.Logger._NumWarnings=0;b.Logger.Report=function(a,c,d,e){var f=b.Logger.Severity;a=a||"";c>=f.Debug&&c<=f.Error||(c=f.Error);for(;b.Logger._IncidentList.length>=b.Logger._MaxIncidents;)b.Logger._IncidentList.shift();b.Logger._IncidentList.push({msg:a,
severity:c});c===f.Error&&b.Logger._NumErrors++;c===f.Warn&&b.Logger._NumWarnings++;c>=b.Logger.ConsoleThresh&&window.console&&(c=(c=c<=f.Debug?window.console.debug:c==f.Info||c==f.Client?window.console.info:c==f.Warn?window.console.warn:window.console.error)||window.console.log)&&c(a);if(e)throw Error(a);!0===d&&alert(a)};b.Logger.Clear=function(){b.Logger._IncidentList=[];b.Logger._NumErrors=0;b.Logger._NumWarnings=0};b.Logger.NumIncidents=function(){return b.Logger._IncidentList.length};b.Logger.NumErrors=
function(){return b.Logger._NumErrors};b.Logger.NumWarnings=function(){return b.Logger._NumWarnings};b.Logger.LastIncident=function(){var a=b.Logger._IncidentList.length;return 0<a?b.Logger._IncidentList[a-1]:null};b.Logger.LastErrorMsg=function(){for(var a=b.Logger._IncidentList.length-1;0<=a;a--){var c=b.Logger._IncidentList[a];if(c.severity===b.Logger.Severity.Error)return c.msg}return""};b.Logger.LastWarningMsg=function(){for(var a=b.Logger._IncidentList.length-1;0<=a;a--){var c=b.Logger._IncidentList[a];
if(c.severity===b.Logger.Severity.Warn)return c.msg}return""};b.Logger.LastDebugMsg=function(){for(var a=b.Logger._IncidentList.length-1;0<=a;a--){var c=b.Logger._IncidentList[a];if(c.severity===b.Logger.Severity.Debug)return c.msg}return""};b.Logger.LastInfoMsg=function(){for(var a=b.Logger._IncidentList.length-1;0<=a;a--){var c=b.Logger._IncidentList[a];if(c.severity===b.Logger.Severity.Info)return c.msg}return""}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Notifier=function(){};b.Notifier.prototype.addEventListener=function(a,c){this.listeners=this.listeners||{};a=a.split(/[ ,]+/);for(var b=0;b<a.length;b++){var e=a[b];this.listeners.hasOwnProperty(e)||(this.listeners[e]=[]);this.listeners[e].push(c)}};b.Notifier.prototype.removeEventListener=function(a,c){this.listeners=this.listeners||{};a=a.split(/[ ,]+/);for(var b=function(a){return a!=c},e=0;e<a.length;e++){var f=a[e];this.listeners.hasOwnProperty(f)&&(this.listeners[f]=this.listeners[f].filter(b))}};
b.Notifier.prototype.trigger=function(a,c){this.listeners=this.listeners||{};if(this.listeners.hasOwnProperty(a))for(var b=this.listeners[a].slice(),e=0;e<b.length;e++)b[e]&&(c=c||{},c.currentTarget=this,b[e](new CustomEvent(a,{detail:c})));else if(this.listeners.hasOwnProperty("AllEvents"))for(b=this.listeners.AllEvents.slice(),e=0;e<b.length;e++)b[e]&&(c=c||{},c.currentTarget=this,b[e](new CustomEvent(a,{detail:c})))}})(window.BigLime=window.BigLime||{});
(function(b,k){b.UtilityDb=function(){if(b.UtilityDbInstance_)throw Error("UtilityDb is a singleton. Use the Instance() method to access it.");this.innerDb=new Dexie(b.UtilityDbName);this.innerDb.version(1).stores({TagValuePairs:"tag, value"})};b.UtilityDbName="BigLimeDB";b.UtilityDbInstance_=null;b.UtilityDb.Instance=function(){b.UtilityDbInstance_||(b.UtilityDbInstance_=new b.UtilityDb);return b.UtilityDbInstance_};b.UtilityDb.prototype.get=function(a){return this.innerDb.TagValuePairs.get(a)};
b.UtilityDb.prototype.put=function(a,c){this.innerDb.TagValuePairs.put({tag:a,value:c})};b.UtilityDb.prototype.delete=function(a){this.innerDb.TagValuePairs.delete(a)}})(window.BigLime=window.BigLime||{});
(function(b,k){var a=glMatrix.vec3,c=glMatrix.mat4;b.Utils=b.Utils||{};b.Utils.requestAnimFrame=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,50)}).bind(window);b.Utils.cancelAnimFrame=(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.oCancelAnimationFrame||
window.msCancelAnimationFrame||window.clearTimeout).bind(window);b.Utils.isTouchDevice=function(){return"ontouchstart"in document.documentElement||window.navigator.msMaxTouchPoints};b.Utils.getBuildInfo=function(){return"17-Aug-2024 23:52"};b.Utils.isString=function(a){return"string"===typeof a||a instanceof String};b.Utils.isStringy=function(a){return b.isString(a)||$.isArray(a)&&a.length&&b.isString(a[0])};b.Utils.ReadFile=function(a,c){c=c===k?"text":c;return new Promise(function(b,d){if(!(a instanceof
Blob))throw Error("Utils.ReadFile: file must be a File or Blob");var e=new FileReader;e.onload=function(){b(e.result)};e.onerror=function(a){d(a)};c=c.toLowerCase();if("text"===c)e.readAsText(a);else if("arraybuffer"===c)e.readAsArrayBuffer(a);else if("dataurl"===c)e.readAsDataURL(a);else throw Error("Unsupported type, in Utils.ReadFile");})};b.Utils.getFileExtension=function(a){a=a.split(".");return 1>=a.length?"":a[a.length-1]};b.Utils.floatEquals=function(a,c,b){"undefined"===typeof b&&(b=1E-6);
return Math.abs(a-c)<=b*Math.max(1,Math.abs(a),Math.abs(c))};b.Utils.GetRotMatrix=function(d,e,f){d=a.normalize(a.create(),d);var g=a.normalize(a.create(),e);a.normalize(g,e);d[2]*=-1;g[2]*=-1;a.negate(g,g);if(.001<Math.abs(a.dot(d,g)))return b.Logger.Report("Non-orthogonal orientation vectors passed to Utils.GetRotMatrix.",b.Logger.Severity.Error),f?c.identity(f):c.create();e=a.create();a.cross(e,d,g);e=[d[0],g[0],e[0],0,d[1],g[1],e[1],0,d[2],g[2],e[2],0,0,0,0,1];return f?c.set.apply(c,[f].concat($jscomp.arrayFromIterable(e))):
c.fromValues.apply(c,$jscomp.arrayFromIterable(e))};b.Utils.DrawLine=function(a,c,b,g){g=g===k?{}:g;a=a.getContext("2d");g.lineWidth&&(a.lineWidth=g.lineWidth);g.strokeStyle&&(a.strokeStyle=g.strokeStyle);a.beginPath();a.moveTo(c[0],c[1]);a.lineTo(b[0],b[1]);a.stroke()};b.Utils.DrawCircle=function(a,c,b,g){g=g===k?{}:g;a=a.getContext("2d");g.lineWidth&&(a.lineWidth=g.lineWidth);g.strokeStyle&&(a.strokeStyle=g.strokeStyle);g.fillStyle&&(a.fillStyle=g.fillStyle);a.beginPath();a.arc(c[0],c[1],b,0,2*
Math.PI);g.fill?a.fill():a.stroke()};b.Utils.SwapByteOrder=function(a,c){a=new Uint8Array(a.buffer||a);var d=a.length,e;if(2===c)for(e=0;e<d;e+=2)c=a[e],a[e]=a[e+1],a[e+1]=c;else if(4===c)for(e=0;e<d;e+=4)c=a[e],a[e]=a[e+3],a[e+3]=c,c=a[e+1],a[e+1]=a[e+2],a[e+2]=c;else b.Logger.Report("Unsupported object size, in Utils.SwapByteOrder",b.Logger.Severity.Error)};b.Utils.SquaredDistanceToLineSegment=function(a,c,b){b=[b[0]-c[0],b[1]-c[1]];var d=Math.pow(b[0],2)+Math.pow(b[1],2);if(1E-16>d)return Math.pow(a[0]-
c[0],2)+Math.pow(a[1]-c[1],2);d=((a[0]-c[0])*b[0]+(a[1]-c[1])*b[1])/d;d=Math.max(0,Math.min(1,d));c=[c[0]+d*b[0],c[1]+d*b[1]];return Math.pow(a[0]-c[0],2)+Math.pow(a[1]-c[1],2)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.ByteImage=function(a,c,d){b.ImageBase.call(this,a,c,b.PixelType.Byte);this.data=d?d instanceof Uint8Array?d:new Uint8Array(d):new Uint8Array(a*c);if(this.data.length!=a*c)throw"Invalid buffer size, in ByteImage.ctor";};b.ByteImage.prototype=Object.create(b.ImageBase.prototype);b.ByteImage.prototype.constructor=b.ByteImage;b.ByteImage.prototype.clone=function(a,c,d){d="undefined"===typeof d||!0===d?new Uint8Array(this.data):null;d=new b.ByteImage(this.width,this.height,d);d.copyPropertiesFrom(this,
a,c);return d}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Contour2D=function(a,c){this.zLoc=c||0;this.points=a||[];if(0<this.points.length){var b=a.length;if(a[0].hasOwnProperty("x"))for(this.points=Array(b),c=0;c<b;c++)this.points[c]=[a[c].x,a[c].y];else if(!$.isArray(a[0]))for(this.points=Array(b),c=0;c<b;c++)this.points[c]=[a[c][0],a[c][1]]}};b.Contour2D.prototype.clone=function(a){for(var c=this.points.length,d=Array(c),e=0;e<c;e++)d[e]=[this.points[e][0],this.points[e][1]];return new b.Contour2D(d,a||0===a?a:this.zLoc)};b.Contour2D.prototype.numPoints=
function(){return this.points?this.points.length:0};b.Contour2D.prototype.xyPoints=function(){if(!this.points||0===this.points.length)return[];for(var a=this.points.length,c=Array(a),b=0;b<a;b++)c[b]={x:this.points[b][0],y:this.points[b][1]};return c};b.Contour2D.toXYContours=function(a){if(!a||0===a.length)return[];for(var c=a.length,b=Array(c),e=0;e<c;e++)b[e]=a[e].xyPoints();return b};b.Contour2D.prototype.centroid=function(){for(var a=0,c=0,b=this.points.length,e=0;e<b;e++)a+=this.points[e][0],
c+=this.points[e][1];return[a/b,c/b]};b.Contour2D.prototype.getBBox=function(){var a=Number.MIN_SAFE_INTEGER,c=Number.MAX_SAFE_INTEGER;a={xmin:c,xmax:a,ymin:c,ymax:a};for(var b=this.points,e=b.length,f=0;f<e;f++){var g=b[f][0],h=b[f][1];g<a.xmin&&(a.xmin=g);g>a.xmax&&(a.xmax=g);h<a.ymin&&(a.ymin=h);h>a.ymax&&(a.ymax=h)}return a.xmin!==c?a:{xmin:0,xmax:0,ymin:0,ymax:0}};b.Contour2D.prototype.shift=function(a){var c=a.hasOwnProperty("x")?a.x:a[0];a=a.hasOwnProperty("y")?a.y:a[1];for(var b=this.points,
e=b.length,f=0;f<e;f++)b[f][0]+=c,b[f][1]+=a};b.Contour2D.prototype.standardize=function(a){a=this.equispace(a);var c=this.standardizePointNumbering();return a&&c};b.Contour2D.standardize=function(a,c){for(var b=[],e=a.length,f=0;f<e;f++){var g=a[f].clone();g.standardize(c);b.push(g)}return b};b.Contour2D.prototype.equispace=function(a){var c=this.numPoints();if(3>c)return!1;var d,e=[];e.push(this.points[0]);for(d=1;d<c-1;d++){var f=this.points[d];var g=this.points[d-1];b.Utils.floatEquals(f[0],g[0])&&
b.Utils.floatEquals(f[1],g[1])||e.push(f)}f=this.points[c-2];g=this.points[c-1];d=this.points[0];b.Utils.floatEquals(f[0],g[0])&&b.Utils.floatEquals(f[1],g[1])||b.Utils.floatEquals(d[0],g[0])&&b.Utils.floatEquals(d[1],g[1])||e.push(this.points[c-1]);c=e.length;if(3>c)return!1;f=Array(c+1);f[0]=0;for(g=1;g<=c;g++){d=e[g%c][0]-e[g-1][0];var h=e[g%c][1]-e[g-1][1];f[g]=f[g-1]+Math.sqrt(d*d+h*h)}g=f[c]/a;d=Array(a);d[0]=e[0];for(var m=h=1;h<a;h++){for(var l=g*h;f[m]<l;)m++;m>c&&(m=c);l=(l-f[m-1])/(f[m]-
f[m-1]);d[h]=[e[m-1][0]+l*(e[m%c][0]-e[m-1][0]),e[m-1][1]+l*(e[m%c][1]-e[m-1][1])]}this.points=d;return!0};b.Contour2D.prototype.standardizePointNumbering=function(){var a=this.points,c=a.length;if(3>c)return!1;for(var d=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY,f=0;f<c;f++){var g=a[f][1];g>e&&(e=g);g<d&&(d=g)}d=(d+e)/2;e=[];for(var h=0;h<c;h++)f=a[h][1],g=a[(h+1)%c][1],(f<=d&&g>d||f>=d&&g<d)&&e.push(h);d=0;f=e.length;g=Number.NEGATIVE_INFINITY;for(h=0;h<f;h++){var m=e[h],l=Math.max(a[m][0],
a[(m+1)%c][0]);l>g&&(g=l,d=m)}e=b.Vec2;f=e.fromArray(a[d]);g=e.fromArray(a[(d+1)%c]);h=e.Subtract(g,f);h=e.normalizeInPlace(e.Perp(h));f=e.Scale(e.Add(g,f),.5);e=e.Subtract(f,e.Scale(h,.001));f=this.contains(e);e=Array(c);if(f)for(f=0;f<c;f++)g=d+f,g>=c&&(g-=c),e[f]=a[g];else for(f=0;f<c;f++)g=d-f,0>g&&(g+=c),e[f]=a[g];this.points=e;return!0};b.Contour2D.prototype.contains=function(a){var c=!1,b=this.points.length;a.hasOwnProperty("x")&&(a=[a.x,a.y]);for(var e=0,f=b-1;e<b;f=e++){var g=this.points[e];
f=this.points[f];var h=(f[1]-g[1])*(a[0]-g[0]),m=(f[0]-g[0])*(a[1]-g[1]);if(g[1]<=a[1]&&a[1]<f[1]&&h<m||f[1]<=a[1]&&a[1]<g[1]&&h>m)c=!c}return c}})(window.BigLime=window.BigLime||{});
(function(b,k){b.FloatImage=function(a,c,d){b.ImageBase.call(this,a,c,b.PixelType.Float32);this.data=d?d instanceof Float32Array?d:new Float32Array(d):new Float32Array(a*c);if(this.data.length!=a*c)throw"Invalid buffer size, in FloatImage.ctor";};b.FloatImage.prototype=Object.create(b.ImageBase.prototype);b.FloatImage.prototype.constructor=b.FloatImage;b.FloatImage.prototype.clone=function(a,c,d){d="undefined"===typeof d||!0===d?new Float32Array(this.data):null;d=new b.FloatImage(this.width,this.height,
d);d.copyPropertiesFrom(this,a,c);return d}})(window.BigLime=window.BigLime||{});
(function(b,k){b.ImageTypeConverter=function(){};b.ImageTypeConverter.toIntImage=function(a){if(a instanceof b.IntImage)return a;if(a.pixelType==b.PixelType.RGB){var c=a.width,d=a.height,e=c*d;c=new b.IntImage(c,d);d=c.data;a=a.data;for(var f=0;f<e;f++){var g=3*f;d[f]=Math.round(.299*a[g]+.587*a[g+1]+.114*a[g+2])}return c}return new b.IntImage(a.width,a.height,a.data)};b.ImageTypeConverter.toFloatImage=function(a){if(a instanceof b.FloatImage)return a;if(a.pixelType==b.PixelType.RGB){var c=a.width,
d=a.height,e=c*d;c=new b.FloatImage(c,d);d=c.data;a=a.data;for(var f=0;f<e;f++){var g=3*f;d[f]=.299*a[g]+.587*a[g+1]+.114*a[g+2]}return c}return new b.FloatImage(a.width,a.height,a.data)};b.ImageTypeConverter.toByteImage=function(a,c,d){if(!c&&0!==c||!d&&0!==d){if(a.pixelType===b.PixelType.Byte)return a;if(a.pixelType!==b.PixelType.RGB)return new b.ByteImage(a.width,a.height,a.data)}var e=a.width*a.height,f=new b.ByteImage(a.width,a.height),g=f.data,h=a.data;if(a.pixelType===b.PixelType.RGB){for(a=
0;a<e;a++)d=3*a,g[a]=Math.round(.299*h[d]+.587*h[d+1]+.114*h[d+2]);return f}d-=c/2;var m=d+c;c=255/(c+1E-4);if(a instanceof b.FloatImage)for(a=0;a<e;a++)g[a]=.5+Math.max(0,Math.min(255,c*(h[a]-d)))|0;else{var l=b.ImageStatistics.getMinMax(a),n=new Uint8Array(l.max-l.min+1);for(a=l.min;a<=l.max;a++)n[a-l.min]=a<=d?0:a>=m?255:.5+c*(a-d)|0;for(a=0;a<e;a++)g[a]=n[h[a]-l.min]}return f};b.ImageTypeConverter.toUshortImage=function(a,c,d){if(!c&&0!==c||!d&&0!==d){if(a.pixelType===b.PixelType.Ushort)return a;
if(a.pixelType!==b.PixelType.RGB)return new b.UshortImage(a.width,a.height,a.data)}var e=a.width*a.height,f=new b.UshortImage(a.width,a.height),g=f.data,h=a.data;if(a.pixelType===b.PixelType.RGB){for(a=0;a<e;a++)d=3*a,g[a]=Math.round(.299*h[d]+.587*h[d+1]+.114*h[d+2]);return f}d-=c/2;var m=d+c;c=65535/(c+1E-4);if(a instanceof b.FloatImage)for(a=0;a<e;a++)g[a]=.5+Math.max(0,Math.min(65535,c*(h[a]-d)))|0;else{var l=b.ImageStatistics.getMinMax(a),n=new Uint16Array(l.max-l.min+1);for(a=l.min;a<=l.max;a++)n[a-
l.min]=a<=d?0:a>=m?65535:.5+c*(a-d)|0;for(a=0;a<e;a++)g[a]=n[h[a]-l.min]}return f};b.ImageTypeConverter.toRGBImage=function(a,c,d){if(a.pixelType===b.PixelType.RGB)return a;var e=b.ImageTypeConverter.toByteImage(a,c,d);c=a.width*a.height;a=new b.RGBImage(a.width,a.height);d=a.data;e=e.data;for(var f=0;f<c;f++){var g=3*f,h=e[f];d[g]=h;d[g+1]=h;d[g+2]=h}return a}})(window.BigLime=window.BigLime||{});
(function(b,k){b.IntImage=function(a,c,d){b.ImageBase.call(this,a,c,b.PixelType.Int);this.data=d?d instanceof Int32Array?d:new Int32Array(d):new Int32Array(a*c);if(this.data.length!=a*c)throw"Invalid buffer size, in IntImage.ctor";};b.IntImage.prototype=Object.create(b.ImageBase.prototype);b.IntImage.prototype.constructor=b.IntImage;b.IntImage.prototype.clone=function(a,c,d){d="undefined"===typeof d||!0===d?new Int32Array(this.data):null;d=new b.IntImage(this.width,this.height,d);d.copyPropertiesFrom(this,
a,c);return d}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Mask=function(a,c,d){this.width=a;this.height=c;this.pixelType=b.PixelType.Byte;this.data=d?d instanceof Uint8Array?d:new Uint8Array(d):new Uint8Array(a*c);if(this.data.length!=a*c)throw"Invalid buffer size, in Mask.ctor";};b.Mask.prototype.clone=function(){return new b.Mask(this.width,this.height,new Uint8Array(this.data))};b.Mask.fromImage=function(a,c){var d=a.width,e=a.height,f=d*e;d=new b.Mask(d,e);e=d.data;a=a.data;for(var g=0;g<f;g++)a[g]>=c&&(e[g]=255);return d};b.Mask.prototype.setToZero=
function(){if(Uint8Array.prototype.fill)this.data.fill(0);else for(var a=this.width*this.height,c=this.data,b=0;b<a;b++)c[b]=0;return this};b.Mask.prototype.equals=function(a){if(!a||this.width!=a.width||this.height!=a.height)return!1;var c=this.width*this.height,b=this.data;a=a.data;for(var e=0;e<c;e++)if(b[e]!=a[e])return!1;return!0};b.Mask.prototype.setValue=function(a,c,b){if(0>a||0>c||a>=this.width||c>=this.height)throw"Coordinates out of bounds, in Mask.setValue";this.data[a+c*this.width]=b};
b.Mask.prototype.getValue=function(a,c){if(0>a||0>c||a>=this.width||c>=this.height)throw"Coordinates out of bounds, in Mask.getValue";return this.data[a+c*this.width]};b.Mask.prototype.toImage=function(){for(var a=new b.ByteImage(this.width,this.height),c=this.width*this.height,d=a.data,e=0;e<c;e++)d[e]=this.data[e]?255:0;return a}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Overlay=function(a,c,d,e,f){this.mask=a;this.color=c||"#FF0000";this.opacity=0===d?0:d?d:.5;this.offset=e?b.Vec2.clone(e):b.Vec2.zero();this.name=f||"";this.visible=!0};b.Overlay.prototype.clone=function(){var a=new b.Overlay;a.mask=this.mask?this.mask.clone():this.mask;a.color=this.color?this.color.slice():this.color;a.opacity=this.opacity;a.offset=b.Vec2.clone(this.offset);a.name=this.name?this.name.slice():this.name;a.visible=this.visible};b.Overlay.prototype.render=function(a){if(this.visible&&
this.mask){a=a.displayCanvas.getContext("2d");var c=a.fillStyle,b=a.globalAlpha;a.globalAlpha=this.opacity;a.fillStyle=this.color||"#000000";for(var e=this.mask.width,f=this.mask.height,g=this.mask.data,h=this.offset.x,m=this.offset.y,l=0;l<f;l++)for(var n=l*e,q=0;q<e;q++){for(var k=q;q<e&&0<g[q+n];)q++;q>k&&a.fillRect(k+h,l+m,q-k,1)}a.globalAlpha=b;a.fillStyle=c}}})(window.BigLime=window.BigLime||{});
(function(b,k){b.RGBImage=function(a,c,d){b.ImageBase.call(this,a,c,b.PixelType.RGB);var e=a*c;if(d)if(d instanceof Uint8Array||d instanceof Uint8ClampedArray)if(d.length==3*e)this.data=d instanceof Uint8Array?d:new Uint8Array(d);else{if(d.length==4*e)for(var f=this.data=new Uint8Array(3*e),g,h,m=0;m<e;m++)g=3*m,h=4*m,f[g]=d[h],f[g+1]=d[h+1],f[g+2]=d[h+2]}else d instanceof b.Color?(this.data=new Uint8Array(3*e),this.fill(d)):this.data=new Uint8Array(d);else this.data=new Uint8Array(3*e);if(!this.data||
this.data.length!=a*c*3)throw"Invalid buffer size, in RGBImage.ctor";};b.RGBImage.prototype=Object.create(b.ImageBase.prototype);b.RGBImage.prototype.constructor=b.RGBImage;b.RGBImage.prototype.clone=function(a,c,d){d="undefined"===typeof d||!0===d?new Uint8Array(this.data):null;d=new b.RGBImage(this.width,this.height,d);d.copyPropertiesFrom(this,a,c);return d};b.RGBImage.prototype.isMonochrome=function(){for(var a=this.width*this.height,c=this.data,b,e,f,g=0;g<a;g++)if(f=3*g,b=c[f],e=c[f+1],f=c[f+
2],b!=e||b!=f||e!=f)return!1;return!0};b.RGBImage.prototype.fill=function(a){for(var c=this.width*this.height,b=this.data,e=a.r,f=a.g,g=a.b,h=0;h<c;h++)a=3*h,b[a]=e,b[a+1]=f,b[a+2]=g;return this}})(window.BigLime=window.BigLime||{});
(function(b,k){b.UshortImage=function(a,c,d){b.ImageBase.call(this,a,c,b.PixelType.Ushort);this.data=d?d instanceof Uint16Array?d:new Uint16Array(d):new Uint16Array(a*c);if(this.data.length!=a*c)throw"Invalid buffer size, in UshortImage.ctor";};b.UshortImage.prototype=Object.create(b.ImageBase.prototype);b.UshortImage.prototype.constructor=b.UshortImage;b.UshortImage.prototype.clone=function(a,c,d){d="undefined"===typeof d||!0===d?new Uint16Array(this.data):null;d=new b.UshortImage(this.width,this.height,
d);d.copyPropertiesFrom(this,a,c);return d}})(window.BigLime=window.BigLime||{});
(function(b,k){b.BitmapReader=function(){};b.BitmapReader.loadImage=function(a,c){c={fileName:a instanceof File?a.name:a,img:null,errors:null,clientCb:c,done:!1};if(a instanceof File){var d=new FileReader;d.loadInfo=c;d.onload=b.BitmapReader._onFileLoaded1;d.onerror=b.BitmapReader._onLoadingError;d.readAsDataURL(a)}else this._onFileLoaded1({target:{loadInfo:c,result:a}})};b.BitmapReader._onLoadingError=function(a){a=a.target.loadInfo;a.done||(a.done=!0,a.errors="Error loading image "+a.fileName,a.clientCb&&
a.clientCb({img:null,errors:a.errors,fileName:a.fileName}))};b.BitmapReader._onFileLoaded1=function(a){try{var c=new Image;c.onload=b.BitmapReader._onFileLoaded2;c.onerror=b.BitmapReader._onLoadingError;c.loadInfo=a.target.loadInfo;c.src=a.target.result}catch(d){b.BitmapReader._onLoadingError(a)}};b.BitmapReader._onFileLoaded2=function(a){var c=a.target;a=c.loadInfo;a.done=!0;try{var d=c.width,e=c.height,f=document.createElement("canvas");f.width=d;f.height=e;var g=f.getContext("2d");g.drawImage(c,
0,0);var h=g.getImageData(0,0,d,e).data,m=new b.RGBImage(d,e),l=m.data;d=d*e*3;for(f=e=0;e<d;e+=3,f+=4)l[e]=h[f],l[e+1]=h[f+1],l[e+2]=h[f+2];m.isMonochrome()&&(m=b.ImageTypeConverter.toByteImage(m));m.attrs.fileName=a.fileName;m.attrs.winWidth=255;m.attrs.winLevel=127.5;m.attrs.photoInterp="MONOCHROME2";m.attrs.isInvertedGrayscale=!1;m.attrs.pixelSpacing=1;m.attrs.position=new b.Vec3(0,0,0);m.attrs.rowDir=new b.Vec3(1,0,0);m.attrs.colDir=new b.Vec3(0,1,0);a.img=m}catch(n){a.errors="Error loading image.\n\n"+
n.message}a.clientCb&&a.clientCb({img:a.img,errors:a.errors,fileName:a.fileName})}})(window.BigLime=window.BigLime||{});
(function(b,k){b.DicomReader=function(){};b.DicomReader.loadImage=function(a,c){c={fileName:a instanceof File?a.name:a,img:null,errors:null,clientCb:c,done:!1};if(a instanceof File){var d=new FileReader;d.loadInfo=c;d.onload=b.DicomReader._onFileLoaded;d.onerror=b.DicomReader._onLoadingError;d.readAsArrayBuffer(a)}else a=new XMLHttpRequest,a.open("GET",c.fileName,!0),a.responseType="arraybuffer",a.loadInfo=c,a.onload=b.DicomReader._onFileLoaded,a.onerror=b.DicomReader._onLoadingError,a.send()};b.DicomReader._onLoadingError=
function(a){a=a.target.loadInfo;a.done||(a.done=!0,a.errors="Error loading image "+a.fileName,a.clientCb(a))};b.DicomReader._onFileLoaded=function(a){var c=a.target.loadInfo;c.done=!0;try{var d=daikon.Series.parseImage(new DataView(a.target.result||a.target.response));a=null;var e=b.DicomReader.getPixelValues(d);if(e instanceof Uint16Array)a=new b.UshortImage(d.getCols(),d.getRows(),e);else if(e instanceof Uint8Array){var f=d.getCols()*d.getRows();if(e.length==f)a=new b.ByteImage(d.getCols(),d.getRows(),
e);else if(e.length==3*f)a=new b.RGBImage(d.getCols(),d.getRows(),e);else throw Error("Unsupported data type");}else a=new b.IntImage(d.getCols(),d.getRows(),e);a.attrs.fileName=c.fileName;a.attrs.winWidth=d.getWindowWidth();a.attrs.winLevel=d.getWindowCenter();a.attrs.photoInterp=d.getPhotometricInterpretation();a.attrs.isInvertedGrayscale="MONOCHROME1"==a.attrs.photoInterp.toUpperCase();var g=d.getImagePosition();g&&(a.attrs.position=new b.Vec3(g[0],g[1],g[2]));(g=d.getImageDirections())?(a.attrs.rowDir=
new b.Vec3(g[0],g[1],g[2]),a.attrs.colDir=new b.Vec3(g[3],g[4],g[5]),a.attrs.perpDir=b.Vec3.Cross(a.attrs.rowDir,a.attrs.colDir)):(a.attrs.rowDir=new b.Vec3(1,0,0),a.attrs.colDir=new b.Vec3(0,1,0),a.attrs.perpDir=new b.Vec3(0,0,1));var h=d.getPixelSpacing();h&&$.isArray(h)&&(h=0<h.length?h[0]:null);a.attrs.pixelSpacing=h?Number(h):0;for(var m in d.tags){var l=d.tags[m].value;l&&$.isArray(l)&&1===l.length&&(l=l[0]);a.attrs.dicomAttrs[m]=l}c.img=a}catch(n){c.errors="Error loading image.\n\n"+n.message}c.clientCb(c)};
b.DicomReader.getPixelValues=function(a){var c=a.getDataType(),b=a.getBitsAllocated()/8,e=a.getRawData(),f=new DataView(e);e=e.byteLength/b;var g=a.littleEndian;a=daikon.Utils.createBitMask(a.getBitsAllocated()/8,a.getBitsStored(),a.getDataType()===daikon.Image.BYTE_TYPE_INTEGER_UNSIGNED);var h;if(c===daikon.Image.BYTE_TYPE_INTEGER_UNSIGNED&&2===b)for(c=new Uint16Array(e),h=0;h<e;h++)b=f.getUint16(2*h,g),c[h]=b&a;else if(c===daikon.Image.BYTE_TYPE_INTEGER_UNSIGNED&&1===b)for(c=new Uint8Array(e),h=
0;h<e;h++)b=f.getUint8(h),c[h]=b&a;else if(c===daikon.Image.BYTE_TYPE_RGB&&1===b)for(c=new Uint8Array(e),h=0;h<e;h++)b=f.getUint8(h),c[h]=b&a;else if(c===daikon.Image.BYTE_TYPE_INTEGER&&2===b)for(c=new Int16Array(e),h=0;h<e;h++)b=f.getInt16(2*h,g),c[h]=b&a;else if(c===daikon.Image.BYTE_TYPE_INTEGER&&1===b)for(c=new Int8Array(e),h=0;h<e;h++)b=f.getInt8(h),c[h]=b&a;else throw Error("Unsupported data type");return c};b.DicomTags={SopInstanceUid:"00080018",Modality:"00080060",PatientName:"00100010",SliceThickness:"00180050",
StudyInstanceUid:"0020000D",SeriesInstanceUid:"0020000E",AcquisitionNumber:"00200012",InstanceNumber:"00200013",ImagePosition:"00200032",ImageOrientation:"00200037",SliceLocation:"00201041",PhotoInterp:"00280004",PixelSpacing:"00280030",BitsPerPixel:"00280100",Rows:"00280010",Columns:"00280011",WindowCenter:"00281050",WindowWidth:"00281051",RescaleIntercept:"00281052",RescaleSlope:"00281053"}})(window.BigLime=window.BigLime||{});
(function(b,k){b.ImageIO=function(){};b.ImageIO.chunkSize=1;b.ImageIO.loadImages=function(a,c,d){var e={fileList:k,isClientSide:k,loadedImgs:[],errors:null,warnings:null,done:!1,sortFunc:d===k?"default":d,clientCb:c};if("string"===typeof a||a instanceof String)a.toLowerCase().endsWith("dirlisting.json")?b.ImageIO._loadFromDirList(a,c,d):(e.done=!0,e.errors="No files were loaded, because the 'files' argument was invalid.",c&&c(e));else if("length"in a)if(e.isClientSide=!0,e.fileList=$.extend({},a),
1>a.length)e.done=!0,e.warnings="No files were loaded, because the supplied file list was empty.",c&&c(e);else for(a=e.fileList.length,c=function(a){b.ImageIO._multiLoadProgress(a,e)},d=0;d<Math.min(b.ImageIO.chunkSize,a);d++)b.ImageIO.loadImage(e.fileList[d],c);else e.done=!0,e.errors="No files were loaded, because the 'files' argument was invalid.",c&&c(e)};b.ImageIO.loadImage=function(a,c){var d=a instanceof File?a.name:a,e=d.lastIndexOf(".")+1;switch((0<e?d.substr(e):"").toLowerCase()){case "dcm":case "dicom":case "":b.DicomReader.loadImage(a,
c);break;case "tif":case "tiff":b.TiffReader.loadImage(a,c);break;default:b.BitmapReader.loadImage(a,c)}};b.ImageIO.loadImageAsync=function(a){return new Promise(function(c,d){b.ImageIO.loadImage(a,function(a){a.errors?d(a.errors):c(a)})})};b.ImageIO._multiLoadProgress=function(a,c){if(!c.done)if(a.errors)c.done=!0,c.errors="Error during load. "+a.errors,c.clientCb(c);else if(c.loadedImgs.push(a.img),a=c.loadedImgs.length,a===c.fileList.length)a={},"default"==c.sortFunc?a=b.ImageIO.sortImages(c.loadedImgs):
"function"===typeof c.sortFunc&&(a=c.sortFunc(c.loadedImgs)),a&&a.warnings&&(c.warnings=(c.warnings||"")+a.warnings+"\n"),c.done=!0,c.clientCb(c);else if(0===a%b.ImageIO.chunkSize)for(var d=function(a){b.ImageIO._multiLoadProgress(a,c)},e=0;e<b.ImageIO.chunkSize;e++)a+e<c.fileList.length&&b.ImageIO.loadImage(c.fileList[a+e],d)};b.ImageIO._loadFromDirList=function(a,c,d){c={isClientSide:!1,fileList:[],dirListFile:a,imgDir:a.substring(0,Math.max(a.lastIndexOf("/"),a.lastIndexOf("\\"))),loadedImgs:[],
errors:null,warnings:null,done:!1,sortFunc:d===k?"default":d,clientCb:c};d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="text";d.multiLoad=c;d.onload=b.ImageIO._onDirListLoaded;d.onerror=b.ImageIO._onDirListLoadError;d.send()};b.ImageIO._onDirListLoadError=function(a){a=a.target.multiLoad;a.done||(a.done=!0,a.errors="Error loading DirList file.",a.clientCb(a))};b.ImageIO._onDirListLoaded=function(a){var c=a.target.multiLoad;a=JSON.parse(a.target.response).files;for(var d=0;d<a.length;d++)a[d]=
c.imgDir+"/"+a[d];c.fileList=a;a=function(a){b.ImageIO._multiLoadProgress(a,c)};for(d=0;d<Math.min(b.ImageIO.chunkSize,c.fileList.length);d++)b.ImageIO.loadImage(c.fileList[d],a)};b.ImageIO.sortImages=function(a){if(!a||2>a.length)return{warnings:null,sortType:"n/a"};var c;0<Object.keys(a[0].attrs.dicomAttrs).length&&(c=b.ImageIO.sortByDicomTags(a));c||(c=b.ImageIO.sortByFilename(a));return c};b.ImageIO.sortByDicomTags=function(a){for(var c={warnings:null,sortType:""},d={},e=a.length,f=0;f<e;f++){var g=
a[f].attrs.dicomAttrs[b.DicomTags.SeriesInstanceUid];g in d||(d[g]=[]);d[g].push(a[f])}e=[];for(var h in d)f=d[h],g=b.ImageIO.sortByGeometry(f)||b.ImageIO.sortByDicomInstanceNumber(f)||b.ImageIO.sortByFilename(f),g.warnings&&(c.warnings=(c.warnings||"")+g.warnings+"\n"),c.sortType+=(c.sortType?",":"")+g.sortType,Array.prototype.push.apply(e,f);a.length=0;Array.prototype.push.apply(a,e);return c};b.ImageIO.sortByGeometry=function(a){try{var c=a.length,d=new b.Vec3,e=a[0].attrs.rowDir,f=a[0].attrs.colDir;
if(!e||!f)return null;for(var g=0;g<c;g++){var h=a[g];if(!(h.attrs.rowDir&&b.Vec3.valueEquals(h.attrs.rowDir,e,1E-4)&&h.attrs.colDir&&b.Vec3.valueEquals(h.attrs.colDir,f,1E-4)))return null;b.Vec3.cross(d,h.attrs.rowDir,h.attrs.colDir);h.attrs.zPos=b.Vec3.dot(h.attrs.position,d)}a.sort(function(a,c){return a.attrs.zPos>c.attrs.zPos?1:a.attrs.zPos<c.attrs.zPos?-1:0});d=!1;for(e=1;e<c;e++)if(1E-5>Math.abs(a[e].attrs.zPos-a[e-1].attrs.zPos)){d=!0;break}return{warnings:d?"Duplicate slice locations found.":
null,sortType:"Geometry"}}catch(m){return null}};b.ImageIO.sortByDicomInstanceNumber=function(a){try{for(var c=a.length,d=0;d<c;d++){var e=a[d],f=e.attrs.dicomAttrs[b.DicomTags.InstanceNumber];f&&(f=Number(f));if(!f&&0!==f)return null;e.zPos=f}a.sort(function(a,c){return a.zPos>c.zPos?1:a.zPos<c.zPos?-1:0});for(d=0;d<c;d++)delete a[d].zPos;return{sortType:"dicomInstanceNumber"}}catch(g){return null}};b.ImageIO.sortByFilename=function(a){a.sort(function(a,b){return a.attrs.fileName.localeCompare(b.attrs.fileName,
k,{numeric:!0,sensitivity:"base"})});return{warnings:null,sortType:"filename"}}})(window.BigLime=window.BigLime||{});
(function(b,k){b.TiffReader=function(){};b.TiffReader.loadImage=function(a,c){c={fileName:a instanceof File?a.name:a,img:null,errors:null,clientCb:c,done:!1};if(a instanceof File){var d=new FileReader;d.loadInfo=c;d.onload=b.TiffReader._onFileLoaded;d.onerror=b.TiffReader._onLoadingError;d.readAsArrayBuffer(a)}else a=new XMLHttpRequest,a.open("GET",c.fileName,!0),a.responseType="arraybuffer",a.loadInfo=c,a.onload=b.TiffReader._onFileLoaded,a.onerror=b.TiffReader._onLoadingError,a.send()};b.TiffReader._onLoadingError=
function(a){a=a.target.loadInfo;a.done||(a.done=!0,a.errors="Error loading image "+a.fileName,a.clientCb(a))};b.TiffReader._onFileLoaded=function(a){var c=a.target.loadInfo;c.done=!0;try{var d=a.target.result||a.target.response,e=UTIF.decode(d);UTIF.decodeImage(d,e[0]);var f=e[0].width,g=e[0].height;a=f*g;var h=e[0].t258[0],m=e[0].hasOwnProperty("t339")?e[0].t339[0]:1,l=e[0].hasOwnProperty("t262")?0==e[0].t262[0]:!1;e[0].hasOwnProperty("t259")&&1!=e[0].t259[0]&&(c.errors="Error loading image.\n\nCompressed tiff files are not supported.");
d=null;if(8==h&&1==m){var n=new Uint8Array(e[0].data.buffer);n.length==a?d=new b.ByteImage(f,g,n):n.length==3*a||n.length==4*a?d=new b.RGBImage(f,g,n):c.errors="Error loading image.\n\nUnsupported tiff file type."}else 8==h&&2==m?(n=new Int8Array(e[0].data.buffer),d=new b.IntImage(f,g,n)):16==h&&1==m?(n=new Uint16Array(e[0].data.buffer),e[0].isLE||b.Utils.SwapByteOrder(n,2),d=new b.UshortImage(f,g,n)):16==h&&2==m?(n=new Int16Array(e[0].data.buffer),e[0].isLE||b.Utils.SwapByteOrder(n,2),d=new b.InttImage(f,
g,n)):c.errors="Error loading image.\n\nUnsupported tiff file type.";d.attrs.fileName=c.fileName;d.attrs.isInvertedGrayscale=l;c.img=d}catch(q){c.errors="Error loading image.\n\n"+q.message}c.clientCb(c)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.TiffWriter=function(){};b.TiffWriter.saveImage=function(a,c,d){d=d===k?!1:d;var e,f,g,h,m,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(n){return 1==n.nextAddress?(e=a.width,f=a.height,g={t256:[e],t257:[f],t259:[1],t273:[256],t278:[f],t279:[a.data.byteLength],t282:[[1,1]],t283:[[1,1]]},a instanceof b.ByteImage?(g.t258=[8],g.t262=[a.attrs.isInvertedGrayscale?0:1],g.t277=[1]):a instanceof b.UshortImage?(g.t258=[16],g.t262=[a.attrs.isInvertedGrayscale?0:1],g.t277=[1]):
a instanceof b.RGBImage?(g.t258=[8,8,8],g.t262=[2],g.t277=[3]):b.Logger.Report("Unsupported image type, in TiffWriter.saveImage",b.Logger.Severity.Error,!1,!0),h=new Uint8Array(256+a.data.byteLength),h.set(b.TiffWriter._encodeHeader([g],d)),h.subarray(256).set(new Uint8Array(a.data.buffer)),m=new Blob([h.buffer],{type:"image/tiff"}),n.yield(c.createWritable(),2)):3!=n.nextAddress?(l=n.yieldResult,n.yield(l.write(m),3)):n.yield(l.close(),0)})};b.TiffWriter._encodeHeader=function(a,c){var b=c?UTIF._binBE:
UTIF._binLE,e=new Uint8Array(8192);e[0]=e[1]=c?77:73;b.writeUshort(e,2,42);c=8;b.writeUint(e,4,c);for(var f=0;f<a.length;f++){var g=UTIF._writeIFD(b,UTIF._types.basic,e,c,a[f]);c=g[1];f<a.length-1&&(0!=(c&3)&&(c+=4-(c&3)),b.writeUint(e,g[0],c))}return e.slice(0,c)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.ImageLook=function(a){this.viewport=a;this.zoom=1;this.pan=new b.Vec2;this.flipH=this.flipV=!1;this.rotAngle=0;this.winWidth=255;this.winLevel=127.5;this.imgRange={min:0,max:255};this.invertBW=!1;this.imgSmoothing=!0;this.showOrient=!1;this.geomTransform=new b.Transform2D;this.geomTransformInv=new b.Transform2D;this.winLevelLut=null};b.ImageLook.prototype._onNewImage=function(){var a=this.viewport.image;a&&(a.pixelType===b.PixelType.RGB?this.imgRange={min:0,max:255}:(a.cachedImgLookMinMax||
(a.cachedImgLookMinMax=b.ImageStatistics.getMinMax(a)),this.imgRange=a.cachedImgLookMinMax),this.winLevelLut=a.pixelType===b.PixelType.Int||a.pixelType===b.PixelType.Ushort||a.pixelType===b.PixelType.Byte?new Uint32Array(new ArrayBuffer(4*(this.imgRange.max-this.imgRange.min+1))):a.pixelType===b.PixelType.RGB?new Uint8Array(new ArrayBuffer(this.imgRange.max-this.imgRange.min+1)):null)};b.ImageLook.prototype.computeWinLeveledImage=function(a){if(this.viewport.image&&a){var c=this.winLevel-.5*this.winWidth,
d=c+this.winWidth,e=255/(this.winWidth+1E-4),f=this.viewport.image.width,g=this.viewport.image.height,h=f*g,m=this.viewport.image.data;a=a.getContext("2d",{willReadFrequently:!0});f=a.getImageData(0,0,f,g);var l=f.data;if(this.viewport.image.pixelType===b.PixelType.Float32)for(g=0;g<h;g++){var n=m[g];var q=n<=c?0:n>=d?255:Math.round((n-c)*e);this.invertBW&&(q=255-q);n=4*g;l[n]=q;l[n+1]=q;l[n+2]=q;l[n+3]=255}else if(this.viewport.image.pixelType===b.PixelType.RGB){for(g=this.imgRange.min;g<=this.imgRange.max;g++)this.winLevelLut[g-
this.imgRange.min]=g<=c?0:g>=d?255:e*(g-c)|0;if(this.invertBW)for(g=0;g<h;g++)e=3*g,c=255-m[e],d=255-m[e+1],e=255-m[e+2],n=c>=d?c>=e?c:e:d>=e?d:e,q=0===n?1:this.winLevelLut[n]/n,n=4*g,l[n]=Math.round(q*c),l[n+1]=Math.round(q*d),l[n+2]=Math.round(q*e),l[n+3]=255;else for(g=0;g<h;g++)e=3*g,c=m[e],d=m[e+1],e=m[e+2],n=c>=d?c>=e?c:e:d>=e?d:e,q=0===n?1:this.winLevelLut[n]/n,n=4*g,l[n]=Math.round(q*c),l[n+1]=Math.round(q*d),l[n+2]=Math.round(q*e),l[n+3]=255}else{n=this.imgRange.min;q=this.imgRange.max;if(this.invertBW)for(g=
n;g<=q;g++)k=g<=c?255:g>=d?0:255-e*(g-c)|0,this.winLevelLut[g-n]=-16777216|k<<16|k<<8|k;else for(g=n;g<=q;g++){var k=g<=c?0:g>=d?255:e*(g-c)|0;this.winLevelLut[g-n]=-16777216|k<<16|k<<8|k}c=this.winLevelLut;l=new Uint32Array(l.buffer);for(g=0;g<h;g++)l[g]=c[m[g]-n]}a.putImageData(f,0,0)}};b.ImageLook.prototype.updateGeomTransform=function(a){if(a){var c=this.geomTransform;c.reset();c.translate(-a.width/2,-a.height/2);var b=this.rotAngle*Math.PI/180;c.rotate(b);this.flipH&&c.hFlip();this.flipV&&c.vFlip();
var e=Math.cos(b);b=Math.sin(b);a=this.zoom*Math.min(this.viewport.vpWidth/(a.width*Math.abs(e)+a.height*Math.abs(b)),this.viewport.vpHeight/(a.width*Math.abs(b)+a.height*Math.abs(e)));c.scale(a,a);c.translate(this.viewport.vpWidth/2,this.viewport.vpHeight/2);c.translate(this.zoom*this.pan.x,this.zoom*this.pan.y);c.calcInverse(this.geomTransformInv)}};b.ImageLook.getOrientationLabel=function(a){a instanceof b.Vec3&&(a=b.Vec3.toArray(a));for(var c=0,d=-1,e=0;3>e;e++){var f=Math.abs(a[e]);f>d&&(d=f,
c=e)}0>a[c]&&(c+=3);return"LPHRAF".split("")[c]}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Scroller=function(a,c,b){this.parentDiv=a;this.min=c||0;this.max=b||10;this.value=this.min;this._initUi()};b.Scroller.backColor="#a0a0a0";b.Scroller.foreColor="#707070";b.Scroller.hiLightColor="#505050";b.Scroller.downArrowImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABNklEQVRYR+2UoaqEQBiF/0WNYjO4MNViEhTLJp/CtKZ9B9s038GkyacwWUTBtMUkCG7YJkYX5uIFw4V1nfEuWMYmnDnf50E9wcHX6WA+cAG+AF+AL7C6gGVZpKqqr/ynHMeBoijeslYFTNMkdV1/RcC2bSjLkk1gJp/PZ9L3/b8kEELQdd3qg26+hLIsk3Ecd0koigLDMHxkbArMZFEUyev1YpKQJAmmadrs3wzM1CiKyO12YxJIkgSu1+tm/2ZgoQZBQMIwpJLAGAPGmKqbKrRQPc8jaZp+lPB9H+I4pu6lDi7Uy+VC8jx/K+G6LmRZxtTJFF6ouq6Tpmn+SBiGAff7nbmP+cBCVVWVPJ/P31tN0+DxeOzq2nVokUAIEUEQoG3b3T27D1J9DhQhLsAX4AvwBQ5f4AfeUlEhvN0J0wAAAABJRU5ErkJggg==";b.Scroller.upArrowImg=
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABJElEQVRYR+2VIc6EMBCFZxMstoLUgyYIBOw9wHOJHoBL1MM9AIEgaPANAlvbZDb7J4g/WaCFTdYU2zffe3khMw/48ff4sT/YALYB24Bt4FYDnufhe5Ety3KZc3mQEILruv4tUkIIrOt6iXVpyPd9nOf53xYPggCmaTLmGQ+kaYpt2348Ic/nE5qmMWIaibMsw7quD+9XnudQVZU2V1vIGMOyLLWOJ2MMyrLUYmuJOOdYFIWW+SbinENRFKf8U8Eb6DgOKqWMAjiOA0qpU/6pwHVdlFIamW9i13VBSnnocfhIKUUhxCXzbYhSCkKIXZ/dhzAMcRzHW+bbcBRFMAzDR6/dAHEcY9/3XwmQJAl0XWcW4CvOGpDTn1CDcUtiA9gGbAO2gRc6jlEhDPYOUQAAAABJRU5ErkJggg==";b.Scroller.prototype._initUi=
function(){this.mainDiv=$('<div id="biglime_scroller_maindiv">')[0];this.parentDiv.append(this.mainDiv);$(this.mainDiv).css("margin","0");$(this.mainDiv).css("padding","0");$(this.mainDiv).css("position","absolute");$(this.mainDiv).css("top","0px");$(this.mainDiv).css("left","0px");$(this.mainDiv).css("width","100%");$(this.mainDiv).css("height","100%");$(this.mainDiv).css("background-color",b.Scroller.backColor);$(this.mainDiv).css("font-size","16px");$(this.mainDiv).css("font-family",b.Viewport.fontFamily);
var a=window.getComputedStyle(this.mainDiv).width;this.topArrow=$('<div id="biglime_scroller_topArrowDiv">')[0];this.mainDiv.append(this.topArrow);$(this.topArrow).css("margin","0");$(this.topArrow).css("padding","0");$(this.topArrow).css("position","absolute");$(this.topArrow).css("top","0px");$(this.topArrow).css("left","0px");$(this.topArrow).css("width",a);$(this.topArrow).css("height",a);$(this.topArrow).css("outline","none");$(this.topArrow).attr("tabindex",0);var c=$('<img id="biglime_scroller_topArrowImg" src="'+
b.Scroller.upArrowImg+'">')[0];this.topArrow.append(c);$(c).css("width","100%");$(c).css("height","100%");$(c).css("opacity","0.35");$(c).hover(function(){$(c).css("opacity","0.60")}.bind(this),function(){$(c).css("opacity","0.35")}.bind(this));this.trough=$('<div id="biglime_scroller_trough">')[0];this.mainDiv.append(this.trough);$(this.trough).css("margin","0");$(this.trough).css("padding","0");$(this.trough).css("position","absolute");$(this.trough).css("top",a);$(this.trough).css("right","2px");
$(this.trough).css("left","2px");$(this.trough).css("bottom",a);$(this.trough).css("outline","none");$(this.trough).attr("tabindex",0);this.botArrow=$('<div id="biglime_scroller_botArrowDiv">')[0];this.mainDiv.append(this.botArrow);$(this.botArrow).css("margin","0");$(this.botArrow).css("padding","0");$(this.botArrow).css("position","absolute");$(this.botArrow).css("bottom","0px");$(this.botArrow).css("left","0px");$(this.botArrow).css("width",a);$(this.botArrow).css("height",a);$(this.botArrow).css("outline",
"none");$(this.botArrow).attr("tabindex",0);var d=$('<img id="biglime_scroller_botArrowImg" src="'+b.Scroller.downArrowImg+'">')[0];this.botArrow.append(d);$(d).css("width","100%");$(d).css("height","100%");$(d).css("opacity","0.35");$(d).hover(function(){$(d).css("opacity","0.60")}.bind(this),function(){$(d).css("opacity","0.35")}.bind(this));this.thumb=$('<div id="biglime_scroller_thumb">')[0];this.trough.append(this.thumb);$(this.thumb).css("position","absolute");$(this.thumb).css("top","0%");
$(this.thumb).css("right","2px");$(this.thumb).css("left","2px");$(this.thumb).css("outline","none");$(this.thumb).attr("tabindex",0);$(this.thumb).css("background-color",b.Scroller.foreColor);$(this.thumb).css("color","white");$(this.thumb).css("text-align","center");$(this.thumb).css("vertical-align","middle");this.thumbSpan=$('<span id="biglime_scroller_thumbspan">')[0];this.thumb.append(this.thumbSpan);this.setRange(this.min,this.max);b.Utils.isTouchDevice()?($(this.thumb).on("touchstart",this._onPointerDown_ThumbBar.bind(this)),
$(this.trough).on("touchstart",this._onPointerDown_Trough.bind(this)),$(this.topArrow).on("touchstart",this.onUpArrowClick.bind(this)),$(this.botArrow).on("touchstart",this.onDownArrowClick.bind(this))):($(this.thumb).on("mousedown",this._onPointerDown_ThumbBar.bind(this)),$(this.trough).on("mousedown",this._onPointerDown_Trough.bind(this)),$(this.topArrow).on("click",this.onUpArrowClick.bind(this)),$(this.botArrow).on("click",this.onDownArrowClick.bind(this)));$(this.mainDiv).on("wheel",this._onMouseWheelChange.bind(this))};
b.Scroller.prototype.setRange=function(a,c){this.min=a;this.max=c;a=Math.max(4,100/(c-a+1));$(this.thumb).css("height",a.toString()+"%");$(this.thumbSpan).css("line-height",window.getComputedStyle(this.thumb).height);this.setValue(this.value)};b.Scroller.prototype.setValue=function(a){var c=this.value;this.value=Math.max(this.min,Math.min(this.max,a));this.reDraw();a!=c&&$(this.mainDiv).trigger("valuechange",[this])};b.Scroller.prototype.on=function(a,c){$(this.mainDiv).on(a,c)};b.Scroller.prototype.off=
function(a,c){$(this.mainDiv).off(a,c)};b.Scroller.prototype.reDraw=function(){var a=this.thumb.getBoundingClientRect().height,c=this.trough.getBoundingClientRect().height;a=100*(c-a)/c;c=(this.value-this.min)/(this.max-this.min);$(this.thumb).css("top",(c*a).toString()+"%");$(this.thumbSpan).text((this.value+1).toString())};b.Scroller.prototype._onPointerDown_Trough=function(a){var c=this.pointerCoordsToScrollValue(a);null!==c&&this.setValue(c);$(this.trough).focus();a.preventDefault();a.stopPropagation()};
b.Scroller.prototype._onPointerDown_ThumbBar=function(a){var c=this,d=function(a){var b=c.pointerCoordsToScrollValue(a);null!==b&&c.setValue(b);a.preventDefault();a.stopPropagation()},e=function(a){b.Utils.isTouchDevice()?($(document).off("touchmove",d),$(document).off("touchend touchcancel",e)):($(document).off("mousemove",d),$(document).off("mouseup",e))};b.Utils.isTouchDevice()?($(document).on("touchmove",d),$(document).on("touchend touchcancel",e)):($(document).on("mousemove",d),$(document).on("mouseup",
e));$(this.thumb).focus();a.preventDefault();a.stopPropagation()};b.Scroller.prototype.pointerCoordsToScrollValue=function(a){a=b.VpTool.getEventCoordinates(a);if(null===a.y)return null;var c=this.thumb.getBoundingClientRect().height,d=this.trough.getBoundingClientRect();a=this.min+Math.round((a.y-d.top-c/2)/(d.height-c)*(this.max-this.min));return a=Math.max(this.min,Math.min(this.max,a))};b.Scroller.prototype.onUpArrowClick=function(a){this.value>this.min&&this.setValue(this.value-1)};b.Scroller.prototype.onDownArrowClick=
function(a){this.value<this.max&&this.setValue(this.value+1)};b.Scroller.prototype._onMouseWheelChange=function(a){a=a.originalEvent||a;if(a.deltaY){var c=Math.sign(a.deltaY);0!==c&&this.setValue(this.value+c);a.preventDefault();a.stopPropagation()}};b.Scroller.prototype.onKeyDown=function(a){var c=!1,b=Math.max(1,Math.round((this.max-this.min)/10));switch(a.which){case 39:case 40:this.value<this.max&&this.setValue(this.value+1);c=!0;break;case 37:case 38:this.value>this.min&&this.setValue(this.value-
1);c=!0;break;case 34:this.value+b<=this.max&&this.setValue(this.value+b);c=!0;break;case 33:this.value-b>=this.min&&this.setValue(this.value-b);c=!0;break;case 36:this.setValue(this.min);c=!0;break;case 35:this.setValue(this.max),c=!0}c&&(a.preventDefault(),a.stopPropagation());return c}})(window.BigLime=window.BigLime||{});
(function(b,k){b.SeriesViewport=function(a,c,b){this.parentDiv="undefined"!==typeof jQuery&&a instanceof jQuery?a[0]:a;this.innerVp=this.imgScrollBar=null;this.imageList=[];this.isSeriesVp=!0;this.initUi(c,b);this.imgScrollBar.on("valuechange",this.onScroll.bind(this));$(this.innerVp.displayCanvas).on("wheel",this._onMouseWheelChange.bind(this));if("undefined"===typeof c||!0===c)$(this.innerVp.displayCanvas).on("dragover drop",this._onDragAndDrop.bind(this))};b.SeriesViewport.prototype.initUi=function(a,
c){this.mainDiv=$('<div id="biglime_seriesvp_maindiv">')[0];this.parentDiv.append(this.mainDiv);$(this.mainDiv).css("display","inline-block");$(this.mainDiv).css("width","100%");$(this.mainDiv).css("height","100%");c=c||"left";a="none"==c?"0px":"42px";var d="left"==c?a:"0px",e="right"==c?a:"0px",f=$('<div id="biglime_seriesvp_vpdiv">')[0];this.mainDiv.append(f);$(f).css("margin","0");$(f).css("padding","0");$(f).css("position","absolute");$(f).css("top","0px");$(f).css("right",e);$(f).css("bottom",
"0px");$(f).css("left",d);this.innerVp=new b.Viewport($(f),{allowDragDrop:!1});"none"!=c&&(d=$('<div id="biglime_seriesvp_sbdiv">')[0],this.mainDiv.append(d),$(d).css("margin","0"),$(d).css("padding","0"),$(d).css("position","absolute"),$(d).css("width",a),$(d).css("top","0px"),$(d).css("bottom","0px"),"left"==c?$(d).css("left","0px"):$(d).css("right","0px"),this.imgScrollBar=new b.Scroller($(d)))};b.SeriesViewport.prototype.setImages=function(a,c){this.imageList=a||[];var b=this.imageList.length;
this.innerVp.setImage(0<b?a[0]:null,c);this.imgScrollBar.setValue(0);this.imgScrollBar.setRange(0,b-1);$(this.innerVp.displayCanvas).trigger("newimages",[this])};b.SeriesViewport.prototype.showAnnots=function(a){this.innerVp.showAnnots=!!a;0===this.suspendCount&&this.reDraw()};b.SeriesViewport.prototype.showOverlays=function(a){this.innerVp.showOverlays=!!a;0===this.suspendCount&&this.reDraw()};b.SeriesViewport.prototype.reDraw=function(a){this.innerVp.reDraw(a)};b.SeriesViewport.prototype.onScroll=
function(a){a=this.imgScrollBar.value;this.imageList&&a<this.imageList.length&&this.innerVp.setImage(this.imageList[a])};b.SeriesViewport.prototype._onMouseWheelChange=function(a,c){if(!this.innerVp.toolBar||c)a=a.originalEvent||a,a.deltaY&&(this.imgScrollBar.setValue(this.imgScrollBar.value+Math.sign(a.deltaY)),a.preventDefault(),a.stopPropagation())};b.SeriesViewport.prototype._onDragAndDrop=function(a){if("dragover"==a.type)a.preventDefault(),a.originalEvent.dataTransfer.dropEffect="move";else if("drop"==
a.type&&(a.preventDefault(),(a=a.originalEvent.dataTransfer.files)&&0<a.length&&a[0])){var c=this;b.ImageIO.loadImages(a,function(a){a.errors?alert(a.errors):(c.innerVp.suspend(),c.setImages(a.loadedImgs),c.innerVp.autoWinLevel(),c.innerVp.setZoom(1),c.innerVp.setPan(b.Vec2.zero()),c.innerVp.resume())})}};b.SeriesViewport.prototype.on=function(a,c){$(this.innerVp.displayCanvas).on(a,c)};b.SeriesViewport.prototype.off=function(a,c){$(this.innerVp.displayCanvas).off(a,null,c)}})(window.BigLime=window.BigLime||
{});
(function(b,k){b.Transform2D=function(){this.data=[1,0,0,1,0,0]};b.Transform2D.prototype.clone=function(){return this.data.slice()};b.Transform2D.prototype.reset=function(){var a=this.data;a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return this};b.Transform2D.prototype.translate=function(a,c){2===arguments.length?(this.data[4]+=a,this.data[5]+=c):1===arguments.length&&(this.data[4]+=a.x,this.data[5]+=a.y);return this};b.Transform2D.prototype.rotate=function(a){var c=Math.cos(a);a=Math.sin(a);var b=this.data.slice();
this.data[0]=c*b[0]-a*b[1];this.data[2]=c*b[2]-a*b[3];this.data[4]=c*b[4]-a*b[5];this.data[1]=a*b[0]+c*b[1];this.data[3]=a*b[2]+c*b[3];this.data[5]=a*b[4]+c*b[5];return this};b.Transform2D.prototype.scale=function(a,c){for(var b=0;3>b;b++)this.data[2*b]*=a,this.data[2*b+1]*=c;return this};b.Transform2D.prototype.hFlip=function(){for(var a=0;3>a;a++)this.data[2*a]*=-1;return this};b.Transform2D.prototype.vFlip=function(){for(var a=0;3>a;a++)this.data[2*a+1]*=-1;return this};b.Transform2D.prototype.getScale=
function(){var a=this.data;return Math.sqrt(Math.abs(a[0]*a[3]-a[1]*a[2]))};b.Transform2D.prototype.calcInverse=function(a){a=a||new b.Transform2D;var c=a.data,d=this.data,e=d[0],f=d[1],g=d[2],h=d[3],m=d[4];d=d[5];var l=e*h-f*g;c[0]=h/l;c[1]=-f/l;c[2]=-g/l;c[3]=e/l;c[4]=-c[0]*m-c[2]*d;c[5]=-c[1]*m-c[3]*d;return a};b.Transform2D.prototype.applyTo=function(a,c){if($.isNumeric(a))c=a*this.getScale();else{c||(c=new b.Vec2);var d=this.data,e=a.x;a=a.y;c.x=d[0]*e+d[2]*a+d[4];c.y=d[1]*e+d[3]*a+d[5]}return c}})(window.BigLime=
window.BigLime||{});
(function(b,k){b.Viewport=function(a,c){this.parentDiv="undefined"!==typeof jQuery&&a instanceof jQuery?a[0]:a;this.image=this.wlCanvas=this.displayCanvas=null;this.imgLook=new b.ImageLook(this);this.suspendCount=c&&"undefined"!==typeof c.initialSuspendCount?c.initialSuspendCount:0;this.innerVp=this;this.toolBar=null;this.overlaysVisible=this.annotsVisible=!0;this.syncPartners=[];this._initUi(c&&"undefined"!==typeof c.bgColor?c.bgColor:"#404040");if(c&&"undefined"!==typeof c.allowDragDrop?c.allowDragDrop:
1)$(this.displayCanvas).on("dragover drop",this._onDragAndDrop.bind(this))};b.Viewport.fontFamily="verdana";b.Viewport.controlAreaColor="#7092BE";b.Viewport.prototype._initUi=function(a){this.displayCanvas=$('<canvas id="biglime_vp_display_canvas">')[0];$(this.displayCanvas).css("display","inline");$(this.displayCanvas).css("float","left");$(this.displayCanvas).css("margin","0px 0px 0px 0px");$(this.displayCanvas).css("padding","0px 0px 0px 0px");$(this.displayCanvas).css("background",a instanceof
b.Color?a.toHexString():a);this.parentDiv.append(this.displayCanvas);this._resize(!0,!0,!0);var c=this;$(window).on("resize",function(){c._resize(!1,!0)})};b.Viewport.prototype._resize=function(a,c,b){if(a){var d=this.parentDiv.getBoundingClientRect();a=d.width;d=d.height;if(!a||!d||!b&&a==this.prevVpWidth&&d==this.prevVpheight)return;this.prevVpWidth=a;this.prevVpheight=d;this.vpWidth=a;this.vpHeight=d;this.displayCanvas.width=this.vpWidth;this.displayCanvas.height=this.vpHeight;$(this.displayCanvas).css("width",
this.vpWidth.toString()+"px");$(this.displayCanvas).css("height",this.vpHeight.toString()+"px");this.imgLook.updateGeomTransform(this.image);0===this.suspendCount&&this.reDraw();this.trigger("resized",{vp:this})}c&&(setTimeout(function(){this._resize(!0,!1)}.bind(this),200),setTimeout(function(){this._resize(!0,!1)}.bind(this),1200))};b.Viewport.prototype.setImage=function(a,c){this.suspend();this.image=a;if(!a||this.wlCanvas&&(this.image.width!=this.wlCanvas.width||this.image.height!=this.wlCanvas.height))this.wlCanvas=
null;a&&!this.wlCanvas&&(this.wlCanvas=$('<canvas id="biglime_vp_canvas_wl">')[0],this.wlCanvas.width=a.width,this.wlCanvas.height=a.height);this.imgLook._onNewImage();a&&(this.imgLook.invertBW=!!a.attrs.isInvertedGrayscale,this.imgLook.computeWinLeveledImage(this.wlCanvas),this.imgLook.updateGeomTransform(this.image));c&&a&&(this.autoWinLevel(),this.setZoom(1),this.setPan(b.Vec2.zero()));this.toolBar&&this.toolBar._onNewImage(this);this.resume();this.trigger("newimage",{vp:this})};b.Viewport.prototype._onDragAndDrop=
function(a){if("dragover"==a.type)a.preventDefault(),a.originalEvent.dataTransfer.dropEffect="move";else if("drop"==a.type&&(a.preventDefault(),(a=a.originalEvent.dataTransfer.files)&&0<a.length&&a[0])){var c=this;b.ImageIO.loadImages(a,function(a){a.errors?alert(a.errors):c.setImage(a.loadedImgs[0],!0)})}};b.Viewport.prototype.suspend=function(){this.suspendCount++};b.Viewport.prototype.resume=function(a){0<this.suspendCount&&this.suspendCount--;0===this.suspendCount&&this.reDraw(a)};b.Viewport.prototype.reDraw=
function(a){if(a){var c=this;b.Utils.requestAnimFrame(function(){c.reDraw()})}else{a=this.displayCanvas.getContext("2d");a.mozImageSmoothingEnabled=a.webkitImageSmoothingEnabled=a.msImageSmoothingEnabled=a.imageSmoothingEnabled=this.imgLook.imgSmoothing;a.setTransform(1,0,0,1,0,0);a.clearRect(0,0,this.displayCanvas.width,this.displayCanvas.height);if(this.image){a.save();var d=this.imgLook.geomTransform.data;a.setTransform(d[0],d[1],d[2],d[3],d[4],d[5]);a.drawImage(this.wlCanvas,0,0);var e=this.image.annots.length;
d=this.image.overlays.length;if(0<e&&this.annotsVisible||0<d&&this.overlaysVisible){a.beginPath();a.rect(0,0,this.image.width,this.image.height);a.clip();if(this.annotsVisible)for(var f=0;f<e;f++)this.image.annots[f].render(this);if(this.overlaysVisible)for(e=0;e<d;e++)this.image.overlays[e].render(this)}a.restore();this.imgLook.showOrient&&this._drawOrientLabels()}this.trigger("redraw",{vp:this})}};b.Viewport.prototype._drawOrientLabels=function(){if(this.image){var a=["",""],c=this.image.attrs.rowDir,
d=this.image.attrs.colDir;c&&d&&(a[0]=b.ImageLook.getOrientationLabel(c),a[1]=b.ImageLook.getOrientationLabel(b.Vec3.Negate(d)));c=this.displayCanvas.getContext("2d");d=this.displayCanvas.width;var e=this.displayCanvas.height;c.font="18px Arial Narrow";c.textAlign="center";c.textBaseline="middle";c.fillStyle="#cfcfcf";c.shadowColor="black";c.shadowOffsetX=2;c.shadowOffsetY=2;c.fillText(a[0],d-24,e/2);c.fillText(a[1],d/2,15);c.shadowOffsetX=0;c.shadowOffsetY=0}};b.Viewport.prototype.showAnnots=function(a){this.annotsVisible=
!!a;0===this.suspendCount&&this.reDraw()};b.Viewport.prototype.showOverlays=function(a){this.overlaysVisible=!!a;0===this.suspendCount&&this.reDraw()};b.Viewport.prototype.setWidthAndLevel=function(a,c,b){this.imgLook.winWidth=a;this.imgLook.winLevel=c;this.imgLook.computeWinLeveledImage(this.wlCanvas);b||this.syncPartners.forEach(function(b){b.setWidthAndLevel(a,c,!0)});0===this.suspendCount&&this.reDraw()};b.Viewport.prototype.getWidthAndLevel=function(){return{width:this.imgLook.winWidth,level:this.imgLook.winLevel}};
b.Viewport.prototype.autoWinLevel=function(a,c){return this.image?(a||0===a||(a=1),a=b.ImageStatistics.calcAutoWinLevel(this.image,a),this.setWidthAndLevel(a.width,a.level,c),0===this.suspendCount&&this.reDraw(),a):{width:NaN,level:NaN}};b.Viewport.prototype.setZoom=function(a,c){this.imgLook.zoom=a;this.imgLook.updateGeomTransform(this.image);c||this.syncPartners.forEach(function(c){c.setZoom(a,!0)});this.toolBar&&this.toolBar._onViewportParamChange("zoom");0===this.suspendCount&&this.reDraw()};
b.Viewport.prototype.setPan=function(a,c){a&&a.hasOwnProperty("x")||(a=b.Vec2.zero());b.Vec2.set(this.imgLook.pan,a);this.imgLook.updateGeomTransform(this.image);c||this.syncPartners.forEach(function(c){c.setPan(a,!0)});this.toolBar&&this.toolBar._onViewportParamChange("pan");0===this.suspendCount&&this.reDraw()};b.Viewport.prototype.flipVertically=function(a,c){this.imgLook.flipV=a;this.imgLook.updateGeomTransform(this.image);c||this.syncPartners.forEach(function(c){c.flipVertically(a,!0)});this.toolBar&&
this.toolBar._onViewportParamChange("flipv");0===this.suspendCount&&this.reDraw()};b.Viewport.prototype.flipHorizontally=function(a,c){this.imgLook.flipH=a;this.imgLook.updateGeomTransform(this.image);c||this.syncPartners.forEach(function(c){c.flipHorizontally(a,!0)});this.toolBar&&this.toolBar._onViewportParamChange("fliph");0===this.suspendCount&&this.reDraw()};b.Viewport.prototype.setRotation=function(a,c){for(;0>a;)a+=360;for(;360<=a;)a-=360;this.imgLook.rotAngle=a;this.imgLook.updateGeomTransform(this.image);
c||this.syncPartners.forEach(function(c){c.setRotation(a,!0)});this.toolBar&&this.toolBar._onViewportParamChange("rotangle");0===this.suspendCount&&this.reDraw()};b.Viewport.prototype.invertGrayscale=function(a,c){this.imgLook.invertBW=!!a;this.imgLook.computeWinLeveledImage(this.wlCanvas);c||this.syncPartners.forEach(function(c){c.invertGrayscale(a,!0)});this.toolBar&&this.toolBar._onViewportParamChange("invertbw");0===this.suspendCount&&this.reDraw()};b.Viewport.prototype.enableImgSmoothing=function(a,
c){this.imgLook.imgSmoothing=a;c||this.syncPartners.forEach(function(c){c.enableImgSmoothing(a,!0)});this.toolBar&&this.toolBar._onViewportParamChange("smoothing");0===this.suspendCount&&this.reDraw()};b.Viewport.prototype.showOrient=function(a,c){this.imgLook.showOrient=a;c||this.syncPartners.forEach(function(c){c.showOrient(a,!0)});0===this.suspendCount&&this.reDraw()};b.Viewport.prototype.imageToVp=function(a){return this.imgLook.geomTransform.applyTo(a)};b.Viewport.prototype.vpToImage=function(a){return this.imgLook.geomTransformInv.applyTo(a)};
b.Viewport.prototype.addEventListener=function(a,c){b.Notifier.prototype.addEventListener.call(this,a,c)};b.Viewport.prototype.removeEventListener=function(a,c){b.Notifier.prototype.removeEventListener.call(this,a,c)};b.Viewport.prototype.trigger=function(a,c){b.Notifier.prototype.trigger.call(this,a,c)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.ViewportArray=function(a,c,d,e){this.parentDiv="undefined"!==typeof jQuery&&a instanceof jQuery?a[0]:a;this.mainDiv=null;this.nx=c;this.ny=d;this.viewports=[];this.suspendCount=0;this.overlaysVisible=this.annotsVisible=!0;this.vpColor=e&&"undefined"!==typeof e.bgColor?e.bgColor:"#404040";this.vpColor instanceof b.Color&&(this.vpColor=this.vpColor.toHexString());var f=e&&"undefined"!==typeof e.railColor?e.railColor:"#606060";this.mainDiv=$('<div id="vparray_maindiv">');this.mainDiv.css("position",
"relative");this.mainDiv.css("width","100%");this.mainDiv.css("height","100%");this.mainDiv.css("background",f instanceof b.Color?f.toHexString():f);a.append(this.mainDiv[0]);this.setLayout(c,d,!0);var g=this;$(window).on("resize",function(){g._resize(!1,!0)});if(e&&e.allowDragDrop)this.mainDiv.on("dragover drop",this._onDragAndDrop.bind(this))};b.ViewportArray.prototype.setLayout=function(a,c,d){if(a!=this.nx||c!=this.ny||d){this.nx=a;this.ny=c;for(this.parentDiv.removeChild(this.mainDiv[0]);this.mainDiv[0].firstChild;)this.mainDiv[0].removeChild(this.mainDiv[0].lastChild);
this.viewports.forEach(function(a){a.suspend();a.Image=null});this.viewports=[];for(d=0;d<a*c;d++){var e=$('<div id="vparray_vpdiv">');e.css("display","block");e.css("position","absolute");e.css("margin","0");e.css("padding","0");var f=new b.Viewport(e,{allowDragDrop:!1,initialSuspendCount:this.suspendCount,bgColor:this.vpColor});f.showOverlays(this.overlaysVisible);f.showAnnots(this.annotsVisible);this.viewports.push(f);this.mainDiv.append(e[0])}this.parentDiv.append(this.mainDiv[0]);this._resize(!0,
!0,!0);var g=this;this.viewports.forEach(function(a){a.syncPartners=g.viewports.filter(function(c){return c!==a})});this.trigger("vp_list_change",{viewports:this.viewports})}};b.ViewportArray.prototype._resize=function(a,c,b){if(a){a=this.parentDiv.getBoundingClientRect();var d=a.width,f=a.height;if(!b&&(!d||!f||d==this.prevParentWidth&&f==this.prevParentHeight))return;this.prevParentWidth=d;this.prevParentHeight=f;b=this.nx;a=this.ny;var g=Math.floor((d-3*(b-1))/b),h=Math.floor((f-3*(a-1))/a);d=
Math.round((d-b*g-3*(b-1))/2);f=Math.round((f-a*h-3*(a-1))/2);for(var m=0;m<a;m++)for(var l=0;l<b;l++){var n=this.viewports[l+b*m],k=$(n.parentDiv);k.css("width",g.toString()+"px");k.css("height",h.toString()+"px");k.css("left",(d+l*(g+3)).toString()+"px");k.css("top",(f+m*(h+3)).toString()+"px");n._resize(!0,!1)}}c&&(setTimeout(function(){this._resize(!0,!1)}.bind(this),200),setTimeout(function(){this._resize(!0,!1)}.bind(this),1200))};b.ViewportArray.prototype._onDragAndDrop=function(a){"dragover"==
a.type?(a.preventDefault(),a.originalEvent.dataTransfer.dropEffect="move"):"drop"==a.type&&a.preventDefault()};b.ViewportArray.prototype.setImages=function(a,c,b){var d=a.length;if(c||"undefined"==typeof c){c=Math.floor(Math.sqrt(d));var f=Math.ceil(Math.sqrt(d));c*f<d&&(c+=1);this.mainDiv[0].getBoundingClientRect().width>this.mainDiv[0].getBoundingClientRect().height&&(d=c,c=f,f=d);this.setLayout(c,f)}this.suspend();for(d=0;d<this.viewports.length;d++)this.viewports[d].setImage(d<a.length?a[d]:null,
b);this.resume()};b.ViewportArray.prototype.suspend=function(){this.suspendCount++;this.viewports.forEach(function(a){a.suspend()})};b.ViewportArray.prototype.resume=function(){0<this.suspendCount&&this.suspendCount--;this.viewports.forEach(function(a){a.resume()})};b.ViewportArray.prototype.showAnnots=function(a){this.annotsVisible=a;this.viewports.forEach(function(c){c.showAnnots(a)})};b.ViewportArray.prototype.showOverlays=function(a){this.overlaysVisible=a;this.viewports.forEach(function(c){c.showOverlays(a)})};
b.ViewportArray.prototype.autoWinLevel=function(a){return this.viewports.length?this.viewports[Math.floor(this.viewports.length/2)].autoWinLevel(a):{width:NaN,level:NaN}};b.ViewportArray.prototype.setZoom=function(a){this.viewports.length&&this.viewports[0].setZoom(a)};b.ViewportArray.prototype.setPan=function(a){this.viewports.length&&this.viewports[0].setPan(a)};b.ViewportArray.prototype.addEventListener=function(a,c){b.Notifier.prototype.addEventListener.call(this,a,c)};b.ViewportArray.prototype.removeEventListener=
function(a,c){b.Notifier.prototype.removeEventListener.call(this,a,c)};b.ViewportArray.prototype.trigger=function(a,c){b.Notifier.prototype.trigger.call(this,a,c)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.CircleAnnot=function(a,c,d,e,f){f||""===f||(f="circle");b.Annotation.call(this,f,d,e);this.center=b.Vec2.clone(a);this.radius=c};b.CircleAnnot.prototype=Object.create(b.Annotation.prototype);b.CircleAnnot.prototype.constructor=b.CircleAnnot;b.CircleAnnot.prototype.clone=function(){return new b.CircleAnnot(this.center,this.radius,this.color,this.filled,this.name)};b.CircleAnnot.prototype.render=function(a){if(this.visible){var c=a.displayCanvas.getContext("2d");c.beginPath();c.arc(this.center.x,
this.center.y,this.radius,0,2*Math.PI);this.filled?(c.fillStyle=this.color,c.fill()):(c.lineWidth=this.lineWidth/a.imgLook.geomTransform.getScale(),c.strokeStyle=this.color,a=c.getLineDash(),this.lineDash&&c.setLineDash(this.lineDash),c.stroke(),this.lineDash&&c.setLineDash(a))}};b.CircleAnnot.prototype.contains=function(a){return b.Vec2.distance(a,this.center)<=this.radius}})(window.BigLime=window.BigLime||{});
(function(b,k){b.CrossHairAnnot=function(a,c,d,e){e||""===e||(e="crosshair");b.Annotation.call(this,e,d);this.center=b.Vec2.clone(a);this.radius=c};b.CrossHairAnnot.prototype=Object.create(b.Annotation.prototype);b.CrossHairAnnot.prototype.constructor=b.CrossHairAnnot;b.CrossHairAnnot.prototype.clone=function(){return new b.CrossHairAnnot(this.center,this.radius,this.color,this.name)};b.CrossHairAnnot.prototype.render=function(a){if(this.visible){var c=a.displayCanvas.getContext("2d");c.beginPath();
c.moveTo(this.center.x,this.center.y-this.radius);c.lineTo(this.center.x,this.center.y+this.radius);c.moveTo(this.center.x-this.radius,this.center.y);c.lineTo(this.center.x+this.radius,this.center.y);c.lineWidth=this.lineWidth/a.imgLook.geomTransform.getScale();c.strokeStyle=this.color;c.stroke()}}})(window.BigLime=window.BigLime||{});
(function(b,k){b.LineAnnot=function(a,c,d,e){e||""===e||(e="line");b.Annotation.call(this,e,d);this.startPt=b.Vec2.clone(a);this.endPt=b.Vec2.clone(c)};b.LineAnnot.prototype=Object.create(b.Annotation.prototype);b.LineAnnot.prototype.constructor=b.LineAnnot;b.LineAnnot.prototype.clone=function(){return new b.LineAnnot(this.startPt,this.endPt,this.color,this.name)};b.LineAnnot.prototype.render=function(a){if(this.visible){var c=a.displayCanvas.getContext("2d");c.lineWidth=this.lineWidth/a.imgLook.geomTransform.getScale();
c.strokeStyle=this.color;c.beginPath();c.moveTo(this.startPt.x,this.startPt.y);c.lineTo(this.endPt.x,this.endPt.y);a=c.getLineDash();this.lineDash&&c.setLineDash(this.lineDash);c.stroke();this.lineDash&&c.setLineDash(a)}};b.LineAnnot.prototype.contains=function(a,c){c=c||.5;var d=Math.atan2(this.endPt.y-this.startPt.y,this.endPt.x-this.startPt.x);d=(new b.Transform2D).translate(b.Vec2.Negate(this.startPt)).rotate(-d).applyTo(a);a=d.x;d=d.y;return 0<=a&&a<=b.Vec2.distance(this.startPt,this.endPt)&&
Math.abs(d)<c}})(window.BigLime=window.BigLime||{});
(function(b,k){b.PolyLineAnnot=function(a){a=a===k?{}:a;b.Annotation.call(this,a.name||"polyline",a.color,a.filled,a.lineWidth,a.visible);this.isClosed=!!a.isClosed;this.pointRadius=a.pointRadius||0;this.pointColor=a.pointColor||this.color;this.vertices=a.vertices||[];0<this.vertices.length&&!this.vertices[0].hasOwnProperty("x")&&(this.vertices=this.vertices.map(function(a){return new b.Vec2(a[0],a[1])}))};b.PolyLineAnnot.prototype=Object.create(b.Annotation.prototype);b.PolyLineAnnot.prototype.constructor=
b.PolyLineAnnot;b.PolyLineAnnot.prototype.clone=function(){var a=this.vertices.map(function(a){return b.Vec2.clone(a)});return new b.PolyLineAnnot({vertices:a,isClosed:this.isClosed,color:this.color,filled:this.filled,name:this.name,pointRadius:this.pointRadius,pointColor:this.pointColor,lineWidth:this.lineWidth,visible:this.visible})};b.PolyLineAnnot.prototype.render=function(a){if(this.visible){var c=this.vertices,b=c.length;if(2<=b){var e=a.displayCanvas.getContext("2d");e.beginPath();e.moveTo(c[0].x,
c[0].y);for(var f=1;f<b;f++)e.lineTo(c[f].x,c[f].y);this.isClosed&&e.closePath();this.filled?(e.fillStyle=this.color,e.fill()):(e.lineWidth=this.lineWidth/a.imgLook.geomTransform.getScale(),e.strokeStyle=this.color,f=e.getLineDash(),this.lineDash&&e.setLineDash(this.lineDash),e.stroke(),this.lineDash&&e.setLineDash(f));e.setLineDash([]);if(0<this.pointRadius)for(a=this.pointRadius/a.imgLook.geomTransform.getScale(),e.fillStyle=this.pointColor,f=0;f<b;f++)e.beginPath(),e.arc(c[f].x,c[f].y,a,0,2*Math.PI),
e.fill()}}};b.PolyLineAnnot.prototype.contains=function(a){for(var c=!1,b=this.vertices,e=b.length,f=0,g=e-1;f<e;g=f++){var h=b[f];g=b[g];var m=(g.y-h.y)*(a.x-h.x),l=(g.x-h.x)*(a.y-h.y);if(h.y<=a.y&&a.y<g.y&&m<l||g.y<=a.y&&a.y<h.y&&m>l)c=!c}return c}})(window.BigLime=window.BigLime||{});
(function(b,k){b.RectangleAnnot=function(a,c,d,e,f,g,h){h||""===h||(h="rectangle");b.Annotation.call(this,h,f,g);this.topLeft=b.Vec2.clone(a);this.width=c;this.height=d;this.angle=e||0};b.RectangleAnnot.prototype=Object.create(b.Annotation.prototype);b.RectangleAnnot.prototype.constructor=b.RectangleAnnot;b.RectangleAnnot.prototype.clone=function(){return new b.RectangleAnnot(this.topLeft,this.width,this.height,this.angle,this.color,this.filled,this.name)};b.RectangleAnnot.prototype.render=function(a){if(this.visible){var c=
this.topLeft.x,d=this.topLeft.y,e=this.width,f=this.height;e=[new b.Vec2(c,d),new b.Vec2(c+e,d),new b.Vec2(c+e,d+f),new b.Vec2(c,d+f)];if(0!==this.angle)for(c=(new b.Transform2D).translate(-c,-d).rotate(this.angle*Math.PI/180).translate(c,d),d=0;4>d;d++)c.applyTo(e[d],e[d]);c=a.displayCanvas.getContext("2d");c.beginPath();c.moveTo(e[0].x,e[0].y);for(d=1;4>d;d++)c.lineTo(e[d].x,e[d].y);c.closePath();this.filled?(c.fillStyle=this.color,c.fill()):(c.lineWidth=this.lineWidth/a.imgLook.geomTransform.getScale(),
c.strokeStyle=this.color,a=c.getLineDash(),this.lineDash&&c.setLineDash(this.lineDash),c.stroke(),this.lineDash&&c.setLineDash(a))}};b.RectangleAnnot.prototype.contains=function(a){var c=(new b.Transform2D).translate(b.Vec2.Negate(this.topLeft)).rotate(-this.angle*Math.PI/180).applyTo(a);a=c.x;c=c.y;return 0<=a&&a<=this.width&&0<=c&&c<=this.height}})(window.BigLime=window.BigLime||{});
(function(b,k){b.FileChooserTool=function(a,c,d,e){b.VpTool.call(this,d||"Load",e||"filechooser");this.isInteractor=!1;this.onLoad=a;this.onError=c;this.ui=this._buildUi();var f=null;if(f=a instanceof b.Viewport?this._loadToSingleViewport.bind(this):a instanceof b.SeriesViewport?this._loadToSeriesViewport.bind(this):a){var g=this;$(this.fileInput).change(function(){try{var a=g.fileInput.files;a&&0<a.length&&($(g.fileInput).prop("disabled",!0),f(a,g))}finally{g.fileInput.value=null}})}};b.FileChooserTool.prototype=
Object.create(b.VpTool.prototype);b.FileChooserTool.prototype.constructor=b.FileChooserTool;b.FileChooserTool.InstanceNumber=0;b.FileChooserTool.prototype._buildUi=function(){var a=$('<div id="'+this.name+'_maindiv">')[0];$(a).css("display","flex");$(a).css("flex-direction","row");$(a).css("align-items","center");$(a).css("justify-content","center");$(a).css("background-color",b.VpTool.InactiveToolColor);var c="biglime_FileChooserTool_fileinput"+(b.FileChooserTool.InstanceNumber++).toString();b.Utils.isTouchDevice()?
this.fileInput=$('<input id="'+c+'" type="file" webkitdirectory multiple>')[0]:this.fileInput=$('<input id="'+c+'" type="file" multiple>')[0];$(this.fileInput).css("width","0.1px");$(this.fileInput).css("height","0.1px");$(this.fileInput).css("opacity","0");$(this.fileInput).css("overflow","hidden");$(this.fileInput).css("position","absolute");$(this.fileInput).css("z-index","-1");this.fileInputLabel=$('<label for="'+c+'">')[0];this.fileInputLabel.innerHTML=this.text;$(this.fileInputLabel).css("width",
"100%");$(this.fileInputLabel).css("line-height","3");$(this.fileInputLabel).css("overflow","hidden");$(this.fileInputLabel).css("text-align","center");$(this.fileInputLabel).css("font-size","14px");$(this.fileInputLabel).css("font-family",b.Viewport.fontFamily);a.appendChild(this.fileInput);a.appendChild(this.fileInputLabel);return a};b.FileChooserTool.prototype._blurUi=function(){$(this.fileInput).blur();$(this.fileInputLabel).blur();$(this.mainDiv).blur()};b.FileChooserTool.prototype._loadToSingleViewport=
function(a){var c=this;b.ImageIO.loadImages(a,function(a){$(c.fileInput).prop("disabled",!1);if(a.errors)if(this.onError)this.onError(a.errors);else alert(a.errors);else{var b=c.onLoad;b&&b.setImage(a.loadedImgs[0],!0)}})};b.FileChooserTool.prototype._loadToSeriesViewport=function(a){var c=this;b.ImageIO.loadImages(a,function(a){$(c.fileInput).prop("disabled",!1);if(a.errors)if(this.onError)this.onError(a.errors);else alert(a.errors);else{var b=c.onLoad;b&&b.setImages(a.loadedImgs,!0)}})}})(window.BigLime=
window.BigLime||{});
(function(b,k){b.HFlipTool=function(a,c){b.VpTool.call(this,a||"H Flip",c||"hflip");this.isInteractor=!1;this.ui=this._buildUi()};b.HFlipTool.prototype=Object.create(b.VpTool.prototype);b.HFlipTool.prototype.constructor=b.HFlipTool;b.HFlipTool.prototype._onVpClick=function(a){this.isActive&&(a=a.data.vp.innerVp,a.image&&a.imgLook&&a.flipHorizontally(!a.imgLook.flipH))};b.HFlipTool.prototype._onVpDoubleClick=function(a){this.isActive&&a.data.vp.innerVp.flipHorizontally(!1)};b.HFlipTool.prototype.resetAllViewports=function(a){if(a)for(var c=
0;c<a.length;c++)a[c].innerVp.flipHorizontally(!1)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.InvertTool=function(a,c){b.VpTool.call(this,a||"Invert",c||"invert");this.isInteractor=!1;this.ui=this._buildUi()};b.InvertTool.prototype=Object.create(b.VpTool.prototype);b.InvertTool.prototype.constructor=b.InvertTool;b.InvertTool.prototype._onVpClick=function(a){this.isActive&&(a=a.data.vp.innerVp,a.image&&a.imgLook&&a.invertGrayscale(!a.imgLook.invertBW))};b.InvertTool.prototype._onVpDoubleClick=function(a){this.isActive&&(a=a.data.vp.innerVp,a.invertGrayscale(a.image&&a.image.attrs?
a.image.attrs.isInvertedGrayscale:!1))};b.InvertTool.prototype.resetAllViewports=function(a){if(a)for(var c=0;c<a.length;c++){var b=a[c].innerVp;b.invertGrayscale(b.image&&b.image.attrs?b.image.attrs.isInvertedGrayscale:!1)}}})(window.BigLime=window.BigLime||{});
(function(b,k){b.PanTool=function(a,c,d){b.VpTool.call(this,a||"Pan",c||"pan",d);this.isInteractor=!0;this.cursor=["grab","-moz-grab","-webkit-grab","pointer"];this.modPan=new b.Vec2;this.ui=this._buildUi()};b.PanTool.prototype=Object.create(b.VpTool.prototype);b.PanTool.prototype.constructor=b.PanTool;b.PanTool.prototype._onPointerDown=function(a){var c=a.data.vp.innerVp;b.Vec2.set(this.modPan,c.imgLook.pan);this.dragging=!0;var d=this;this.startAnimation(function(){c.setPan(d.modPan)})};b.PanTool.prototype._onPointerMove=
function(a){this.dragging&&b.Vec2.scaleAndAddInPlace(this.modPan,this.deltaPrev,1/a.data.vp.innerVp.imgLook.zoom);return this.dragging};b.PanTool.prototype._onPointerUp=function(a){this.stopAnimation();this.dragging=!1};b.PanTool.prototype._onVpDoubleClick=function(a){this.isActive&&a.data.vp.innerVp.setPan(b.Vec2.zero())};b.PanTool.prototype.resetAllViewports=function(a){if(a)for(var c=0;c<a.length;c++)a[c].innerVp.setPan(b.Vec2.zero())}})(window.BigLime=window.BigLime||{});
(function(b,k){b.PinchTool=function(){b.VpTool.call(this,"Pinch","pinch");this.isInteractor=!0;this.initialPan=new b.Vec2;this.modPan=new b.Vec2;this.ui=this.vp=null};b.PinchTool.prototype=Object.create(b.VpTool.prototype);b.PinchTool.prototype.constructor=b.PinchTool;b.PinchTool.prototype.createControls=null;b.PinchTool.prototype._onPinchStart=function(a){var c=this.vp=a.data.vp.innerVp;if(c&&c.image&&c.imgLook){b.Vec2.set(this.initialPan,c.imgLook.pan);this.initialZoom=c.imgLook.zoom;this.initialRotAngle=
c.imgLook.rotAngle;this.initialRotScale=this._calcRotationScale(this.initialRotAngle,c);b.Vec2.set(this.modPan,this.initialPan);this.modZoom=this.initialZoom;this.modRotAngle=this.initialRotAngle;this.pinching=!0;var d=this;this.startAnimation(function(){d.pinching&&(c.suspend(),c.setZoom(d.modZoom),c.setPan(d.modPan),c.setRotation(d.modRotAngle),c.resume())})}};b.PinchTool.prototype._onPinchMove=function(a){this.pinching&&(this.modZoom=this.pinchProps.separation/this.initialPinchSeparation*this.initialZoom,
b.Vec2.scaleAndAdd(this.modPan,this.initialPan,b.Vec2.Subtract(this.pinchProps.center,this.initialPinchCenter),1/this.modZoom),this.modRotAngle=this.initialRotAngle-180/Math.PI*(this.pinchProps.angle-this.initialPinchAngle),a=this._calcRotationScale(this.modRotAngle,this.vp),this.modZoom/=a/this.initialRotScale,this.modZoom=Math.max(b.ZoomTool.MinZoom,Math.min(b.ZoomTool.MaxZoom,this.modZoom)));return this.pinching};b.PinchTool.prototype._onPinchEnd=function(a){this.stopAnimation();this.pinching=
!1};b.PinchTool.prototype._calcRotationScale=function(a,c){var b=1;if(c&&c.image){b=c.image;var e=Math.abs(Math.cos(Math.PI/180*a));a=Math.abs(Math.sin(Math.PI/180*a));b=Math.min(c.vpWidth/(b.width*e+b.height*a),c.vpHeight/(b.width*a+b.height*e))}return b}})(window.BigLime=window.BigLime||{});
(function(b,k){b.PoseTool=function(a,c,d){d=d||{};var e=d.pan||{btns:2,shift:!1,ctrl:!1,alt:!1,meta:!1};d=d.zoom||{btns:0,shift:!0,ctrl:!1,alt:!1,meta:!1};e=Array.isArray(e)?e:[e];d=Array.isArray(d)?d:[d];b.VpTool.call(this,a||"Pose",c||"pose",e.concat(d));this.isInteractor=!0;this.cursor="pointer";this.modZoom=1;this.modPan=new b.Vec2;this.mode="none";this.ui=this._buildUi()};b.PoseTool.prototype=Object.create(b.VpTool.prototype);b.PoseTool.prototype.constructor=b.PoseTool;b.PoseTool.MinZoom=.1;
b.PoseTool.MaxZoom=100;b.PoseTool.prototype._onPointerDown=function(a){if("none"==this.mode){if(b.Utils.isTouchDevice())this.mode="pan";else{var c=b.VpTool.MouseEventMatches;this.mode=c(a,this.panEventTypes)?"pan":c(a,this.zoomEventTypes)?"zoom":"none"}if("none"!=this.mode){var d=a.data.vp.innerVp;"zoom"==this.mode?this.modZoom=d.imgLook.zoom:"pan"==this.mode&&b.Vec2.set(this.modPan,d.imgLook.pan);this.dragging=!0;var e=this;this.startAnimation(function(){"zoom"==e.mode?d.setZoom(e.modZoom):"pan"==
e.mode&&d.setPan(e.modPan)})}}};b.PoseTool.prototype._onPointerMove=function(a){this.dragging&&("zoom"==this.mode?(this.modZoom*=Math.pow(1.01,-this.deltaPrev.y),this.modZoom=Math.max(b.PoseTool.MinZoom,Math.min(b.PoseTool.MaxZoom,this.modZoom))):"pan"==this.mode&&b.Vec2.scaleAndAddInPlace(this.modPan,this.deltaPrev,1/a.data.vp.innerVp.imgLook.zoom));return this.dragging};b.PoseTool.prototype._onPointerUp=function(a){this.stopAnimation();this.dragging=!1;this.mode="none"};b.PoseTool.prototype._onMouseWheelChange=
function(a){if(a&&a.data&&a.data.vp instanceof b.SeriesViewport)return!1;if(a.normalizedDelta&&0<Math.abs(a.normalizedDelta)){var c=a.data.vp.innerVp;if(c){var d=c.imgLook.zoom*Math.pow(1.04,-a.normalizedDelta);d=Math.max(b.PoseTool.MinZoom,Math.min(b.PoseTool.MaxZoom,d));b.Utils.requestAnimFrame(function(){c.setZoom(d)})}a.preventDefault();return!0}return!1};b.PoseTool.prototype._onVpDoubleClick=function(a){this.isActive&&(a.data.vp.innerVp.suspend(),a.data.vp.innerVp.setZoom(1),a.data.vp.innerVp.setPan(b.Vec2.zero()),
a.data.vp.innerVp.resume())};b.PoseTool.prototype.resetAllViewports=function(a){if(a)for(var c=0;c<a.length;c++)a[c].innerVp.suspend(),a[c].innerVp.setZoom(1),a[c].innerVp.setPan(b.Vec2.zero()),a[c].innerVp.resume()}})(window.BigLime=window.BigLime||{});
(function(b,k){b.ResetViewTool=function(a,c){b.VpTool.call(this,a||"Reset View",c||"resetview");this.isInteractor=!1;this.ui=this._buildUi()};b.ResetViewTool.prototype=Object.create(b.VpTool.prototype);b.ResetViewTool.prototype.constructor=b.ResetViewTool;b.ResetViewTool.prototype._onVpClick=function(a){this.isActive&&(a=a.data.vp.innerVp,a.image&&a.imgLook&&(a.suspend(),a.setPan(b.Vec2.zero()),a.setZoom(1),a.setRotation(0),a.flipHorizontally(!1),a.flipVertically(!1),a.resume()))};b.ResetViewTool.prototype._onVpDoubleClick=
function(a){this._onVpClick(a)};b.ResetViewTool.prototype.resetAllViewports=function(a){if(a)for(var c=0;c<a.length;c++){var d=a[c].innerVp;d.image&&d.imgLook&&(d.suspend(),d.setPan(b.Vec2.zero()),d.setZoom(1),d.setRotation(0),d.flipHorizontally(!1),d.flipVertically(!1),d.resume())}}})(window.BigLime=window.BigLime||{});
(function(b,k){b.RotateTool=function(a,c,d){b.VpTool.call(this,a||"Rotate",c||"rotate",d);this.isInteractor=!1;this.ui=this._buildUi()};b.RotateTool.prototype=Object.create(b.VpTool.prototype);b.RotateTool.prototype.constructor=b.RotateTool;b.RotateTool.prototype._onVpClick=function(a){if(this.isActive&&(a=a.data.vp.innerVp,a.image&&a.imgLook)){var c=(a.imgLook.rotAngle+90)%360;c=Math.round(c-c%90);a.setRotation(c)}};b.RotateTool.prototype._onVpDoubleClick=function(a){this.isActive&&a.data.vp.innerVp.setRotation(0)};
b.RotateTool.prototype.resetAllViewports=function(a){if(a)for(var c=0;c<a.length;c++)a[c].innerVp.setRotation(0)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.SmoothingTool=function(a,c){b.VpTool.call(this,a||"Smooth",c||"smooth");this.isInteractor=!1;this.ui=this._buildUi()};b.SmoothingTool.prototype=Object.create(b.VpTool.prototype);b.SmoothingTool.prototype.constructor=b.SmoothingTool;b.SmoothingTool.prototype._onVpClick=function(a){this.isActive&&(a=a.data.vp.innerVp,a.image&&a.imgLook&&a.enableImgSmoothing(!a.imgLook.imgSmoothing))};b.SmoothingTool.prototype._onVpDoubleClick=function(a){this.isActive&&a.data.vp.innerVp.enableImgSmoothing(!0)};
b.SmoothingTool.prototype.resetAllViewports=function(a){if(a)for(var c=0;c<a.length;c++)a[c].innerVp.enableImgSmoothing(!0)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.ToolBar=function(a,c,d,e,f){this.parentDiv=a;this.tools=c;this.activeVp=this.activeTool=null;this.btnWidth=e||100;this.btnSpacing=f||6;d instanceof b.ViewportArray?(this.vpList=d.viewports,d.addEventListener("vp_list_change",this._onVpListChange.bind(this))):this.vpList=Array.isArray(d)?d:[d];this._initUi();this._attachToViewports(this.vpList);for(a=0;a<this.vpList.length;a++)this.vpList[a].innerVp.toolBar=this;if(b.Utils.isTouchDevice())$(document).on("touchmove",this._onPointerMove.bind(this));
else $(document).on("mousemove",this._onPointerMove.bind(this)),$(document).on("mouseup",this._onPointerUp.bind(this));if(this.tools)for(a=0;a<this.tools.length;a++)if(this.tools[a].isInteractor){this.setActiveTool(this.tools[a]);break}};b.ToolBar.FontFamily="verdana";b.ToolBar.BackgroundColor="#7092BE";b.ToolBar.prototype._initUi=function(){this.mainDiv=$('<div id="biglime_toolbar_maindiv">')[0];this.parentDiv.append(this.mainDiv);$(this.mainDiv).css("height","100%");$(this.mainDiv).css("margin",
"0");$(this.mainDiv).css("padding","0");$(this.mainDiv).css("display","flex");$(this.mainDiv).css("flex-direction","row");$(this.mainDiv).css("align-items","center");$(this.mainDiv).css("justify-content","center");$(this.mainDiv).css("background-color",b.ToolBar.BackgroundColor);for(var a=0;a<this.tools.length;a++){var c=this.tools[a],d=c.preferredWidth||this.btnWidth;c.ui&&(this.mainDiv.append(c.ui),$(c.ui).css("height","100%"),$(c.ui).css("width",d.toString()+"px"),$(c.ui).css("margin","0px "+this.btnSpacing.toString()+
"px 0px 0px"));c.setParentToolBar&&c.setParentToolBar(this)}};b.ToolBar.prototype._attachToViewports=function(a){var c;if(b.Utils.isTouchDevice())for(c=0;c<a.length;c++){var d=a[c].innerVp;$(d.displayCanvas).on("tap",{vp:d},this._onDelayedVpClick.bind(this));$(d.displayCanvas).on("doubleTap",{vp:d},this._onVpDoubleClick.bind(this));$(d.displayCanvas).on("touchstart",{vp:d},this._onPointerDown.bind(this));$(d.displayCanvas).on("touchstart",{vp:d},this._onVpClick.bind(this));$(d.displayCanvas).on("touchend touchcancel",
{vp:d},this._onPointerUp.bind(this));$(d.displayCanvas).on("contextmenu",{vp:d},this._onVpClick.bind(this));$(d.displayCanvas).on("wheel",{vp:d},this._onMouseWheelChange.bind(this))}else for(c=0;c<a.length;c++)d=a[c].innerVp,b.Ui.OnClickAndDoubleClick(d.displayCanvas,this._onDelayedVpClick.bind(this),this._onVpDoubleClick.bind(this),{vp:d}),$(d.displayCanvas).on("click",{vp:d},this._onVpClick.bind(this)),$(d.displayCanvas).on("mousedown",{vp:d},this._onPointerDown.bind(this)),$(d.displayCanvas).on("contextmenu",
{vp:d},this._onVpClick.bind(this)),$(d.displayCanvas).on("wheel",{vp:d},this._onMouseWheelChange.bind(this))};b.ToolBar.prototype._onVpListChange=function(a){this.vpList=a.detail.viewports;this._attachToViewports(this.vpList);this.setActiveTool(this.activeTool)};b.ToolBar.prototype.getTool=function(a){for(var c=0;c<this.tools.length;c++)if(this.tools[c].name==a)return this.tools[c];return null};b.ToolBar.prototype._onToolButtonClicked=function(a){this.setActiveTool(a);a._blurUi&&a._blurUi()};b.ToolBar.prototype._onToolButtonDoubleClicked=
function(a){this.setActiveTool(a);a.resetAllViewports&&a.resetAllViewports(this.vpList);a._blurUi&&a._blurUi()};b.ToolBar.prototype.setActiveTool=function(a){this.activeTool=a;for(var c=0;c<this.tools.length;c++){var b=this.tools[c];b.setActive&&b.setActive(b==a||b.alwaysActive,this.vpList)}this.trigger("active-tool-change",{activeTool:a})};b.ToolBar.prototype.getActiveTool=function(){for(var a=0;a<this.tools.length;a++)if(this.tools[a].isActive)return this.tools[a];return null};b.ToolBar.prototype._onViewportParamChange=
function(a){for(var c=0;c<this.tools.length;c++)this.tools[c]._onViewportParamChange&&this.tools[c]._onViewportParamChange(a)};b.ToolBar.prototype._onNewImage=function(a){for(var c=0;c<this.tools.length;c++)this.tools[c]._onNewImage&&this.tools[c]._onNewImage(a)};b.ToolBar.prototype._onPointerDown=function(a){var c=a.originalEvent;c=c&&c.touches?c.touches.length:0;if(!(2<c)){c=2==c;this.mouseDownPt=b.VpTool.getEventCoordinates(a);this.mouseCaptured=!0;this.activeVp=a.data.vp;for(var d=0;d<this.tools.length;d++){var e=
this.tools[d];if(e.isActive&&!c)e.dragging&&e._onPointerUp&&e._onPointerUp(a),e._updateCurrentPointFromEvent(a)&&(b.Vec2.set(e.startPoint,e.currPoint),b.Vec2.set(e.prevPoint,e.currPoint),b.Vec2.set(e.deltaStart,0,0),b.Vec2.set(e.deltaPrev,0,0),e._onPointerDown&&(b.Utils.isTouchDevice()||b.VpTool.MouseEventMatches(a,e.eventTypes))&&e._onPointerDown(a)),a.preventDefault();else if(c){var f=b.VpTool.calcPinchProperties(a);e.initialPinchSeparation=f.separation;e.initialPinchCenter=f.center;e.initialPinchAngle=
f.angle;e._onPinchStart&&e._onPinchStart(a);a.preventDefault()}}}};b.ToolBar.prototype._onPointerMove=function(a){var c=a.originalEvent,d=c&&c.touches?c.touches.length:0;c=2==d;if(2>=d){if(null===a.data||a.data===k)a.data={};a.data.vp=this.activeVp;if(!a.data.vp)for(d=0;d<this.vpList.length;d++)if(this.vpList[d].innerVp.displayCanvas==a.target){a.data.vp=this.activeVp=this.vpList[d];break}for(d=0;d<this.tools.length;d++){var e=this.tools[d];if(e.isActive&&!c&&e._onPointerMove){if(e._updateCurrentPointFromEvent(a)){b.Vec2.subtract(e.deltaPrev,
e.currPoint,e.prevPoint);b.Vec2.subtract(e.deltaStart,e.currPoint,e.startPoint);b.Vec2.set(e.prevPoint,e.currPoint);var f=e._onPointerMove(a);f===k&&b.Logger.Report(e.name+": _onPointerMove must return a value.",b.Logger.Severity.Warning);if(f){a.preventDefault();break}}}else if(c&&e._onPinchMove&&(e.pinchProps=b.VpTool.calcPinchProperties(a),f=e._onPinchMove(a),f===k&&b.Logger.Report(e.name+": _onPointerMove must return a value.",b.Logger.Severity.Warning),f)){a.preventDefault();break}}}};b.ToolBar.prototype._onPointerUp=
function(a){if(this.mouseCaptured){this.mouseCaptured=!1;for(var c=0;c<this.tools.length;c++){var b=this.tools[c];b.isActive&&b._onPointerUp&&(b._onPointerUp(a),a.preventDefault());b._onPinchEnd&&(b._onPinchEnd(a),a.preventDefault())}}};b.ToolBar.prototype._onVpClick=function(a){"contextmenu"==a.type&&a.preventDefault();var c=b.VpTool.getEventCoordinates(a);b.Utils.isTouchDevice()&&(c=b.Vec2.clone(this.mouseDownPt),a.clientX=this.mouseDownPt.x,a.clientY=this.mouseDownPt.y);if(null!==c.x&&null!==this.mouseDownPt.x&&
2>=b.Vec2.norm(b.Vec2.Subtract(c,this.mouseDownPt)))for(c=0;c<this.tools.length;c++){var d=this.tools[c];d._onVpClick&&!d._onVpDoubleClick&&d._updateCurrentPointFromEvent(a)&&(b.Vec2.set(d.startPoint,d.currPoint),d._onVpClick(a),a.preventDefault())}};b.ToolBar.prototype._onDelayedVpClick=function(a){"contextmenu"==a.type&&a.preventDefault();var c=b.VpTool.getEventCoordinates(a);b.Utils.isTouchDevice()&&(c=b.Vec2.clone(this.mouseDownPt),a.clientX=this.mouseDownPt.x,a.clientY=this.mouseDownPt.y);if(null!==
c.x&&null!==this.mouseDownPt.x&&2>=b.Vec2.norm(b.Vec2.Subtract(c,this.mouseDownPt)))for(c=0;c<this.tools.length;c++){var d=this.tools[c];d._onVpClick&&d._onVpDoubleClick&&d._updateCurrentPointFromEvent(a)&&(b.Vec2.set(d.startPoint,d.currPoint),d._onVpClick(a),a.preventDefault())}};b.ToolBar.prototype._onVpDoubleClick=function(a){b.Utils.isTouchDevice()&&(a.clientX=this.mouseDownPt.x,a.clientY=this.mouseDownPt.y);for(var c=0;c<this.tools.length;c++){var d=this.tools[c];d._onVpDoubleClick&&(d._onVpDoubleClick(a),
a.preventDefault())}};b.ToolBar.prototype._onMouseWheelChange=function(a){for(var c=null,d=0;d<this.vpList.length;d++)if(this.vpList[d].innerVp.displayCanvas===a.target){c=this.vpList[d];break}if(null===a.data||a.data===k)a.data={};a.data.vp=c;a.normalizedDelta=0;a.originalEvent&&a.originalEvent.deltaY&&(a.normalizedDelta=Math.sign(a.originalEvent.deltaY));d=!1;var e;for(e=0;e<this.tools.length;e++){var f=this.tools[e];if(f.isActive&&f._onMouseWheelChange){d=f._onMouseWheelChange(a);break}}if(!d)for(e=
0;e<this.tools.length&&(f=this.tools[e],!f._onMouseWheelChange||!(d=f._onMouseWheelChange(a)));e++);!d&&c instanceof b.SeriesViewport&&(c._onMouseWheelChange(a,!0),d=!0);d&&a.preventDefault()};b.ToolBar.prototype.addEventListener=function(a,c){b.Notifier.prototype.addEventListener.call(this,a,c)};b.ToolBar.prototype.removeEventListener=function(a,c){b.Notifier.prototype.removeEventListener.call(this,a,c)};b.ToolBar.prototype.trigger=function(a,c){b.Notifier.prototype.trigger.call(this,a,c)}})(window.BigLime=
window.BigLime||{});(function(b,k){b.ToolSpacer=function(a,c){b.VpTool.call(this,"",c||"spacer");this.preferredWidth=a;this.ui=this._buildUi()};b.ToolSpacer.prototype=Object.create(b.VpTool.prototype);b.ToolSpacer.prototype.constructor=b.ToolSpacer;b.ToolSpacer.prototype._buildUi=function(){var a=$('<div id="'+this.name+'_maindiv">')[0];$(a).css("background-color",b.ToolBar.BackgroundColor);return a}})(window.BigLime=window.BigLime||{});
(function(b,k){b.VFlipTool=function(a,c){b.VpTool.call(this,a||"V Flip",c||"vflip");this.isInteractor=!1;this.ui=this._buildUi()};b.VFlipTool.prototype=Object.create(b.VpTool.prototype);b.VFlipTool.prototype.constructor=b.VFlipTool;b.VFlipTool.prototype._onVpClick=function(a){this.isActive&&(a=a.data.vp.innerVp,a.image&&a.imgLook&&a.flipVertically(!a.imgLook.flipV))};b.VFlipTool.prototype._onVpDoubleClick=function(a){this.isActive&&a.data.vp.innerVp.flipVertically(!1)};b.VFlipTool.prototype.resetAllViewports=
function(a){if(a)for(var c=0;c<a.length;c++)a[c].innerVp.flipVertically(!1)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.WinLevelTool=function(a,c,d,e){b.VpTool.call(this,a||"Win Level",c||"winlevel",e);this.isInteractor=!0;this.cursor="move";this.modWidth=this.scaleFactor=1;this.modLevel=0;this.autoPercent="undefined"==typeof d?1:d;this.ui=this._buildUi()};b.WinLevelTool.prototype=Object.create(b.VpTool.prototype);b.WinLevelTool.prototype.constructor=b.WinLevelTool;b.WinLevelTool.prototype._onPointerDown=function(a){var c=a.data.vp.innerVp;if(c&&c.image){a=b.ImageStatistics.getMinMax(c.image);this.scaleFactor=
(a.max-a.min)/2048;this.modWidth=c.imgLook.winWidth;this.modLevel=c.imgLook.winLevel;this.dragging=!0;var d=this;this.startAnimation(function(){c.setWidthAndLevel(d.modWidth,d.modLevel)})}};b.WinLevelTool.prototype._onPointerMove=function(a){this.dragging&&(a=a.data.vp.innerVp.imgLook.invertBW?1:-1,this.modWidth-=this.deltaPrev.x*this.scaleFactor,this.modWidth=Math.max(1E-6,this.modWidth),this.modLevel-=this.deltaPrev.y*this.scaleFactor*a);return this.dragging};b.WinLevelTool.prototype._onPointerUp=
function(a){this.stopAnimation();this.dragging=!1};b.WinLevelTool.prototype._onVpDoubleClick=function(a){this.isActive&&a.data.vp.innerVp.autoWinLevel(this.autoPercent)};b.WinLevelTool.prototype.resetAllViewports=function(a){if(a)for(var c=0;c<a.length;c++)a[c].innerVp.autoWinLevel(this.autoPercent)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.ZoomTool=function(a,c,d){b.VpTool.call(this,a||"Zoom",c||"zoom",d);this.isInteractor=!0;this.cursor="zoom-in";this.modZoom=1;this.ui=this._buildUi()};b.ZoomTool.prototype=Object.create(b.VpTool.prototype);b.ZoomTool.prototype.constructor=b.ZoomTool;b.ZoomTool.MinZoom=.1;b.ZoomTool.MaxZoom=100;b.ZoomTool.prototype._onPointerDown=function(a){var c=a.data.vp.innerVp;this.modZoom=c.imgLook.zoom;this.dragging=!0;var b=this;this.startAnimation(function(){c.setZoom(b.modZoom)})};b.ZoomTool.prototype._onPointerMove=
function(a){this.dragging&&(this.modZoom*=Math.pow(1.01,-this.deltaPrev.y),this.modZoom=Math.max(b.ZoomTool.MinZoom,Math.min(b.ZoomTool.MaxZoom,this.modZoom)));return this.dragging};b.ZoomTool.prototype._onPointerUp=function(a){this.stopAnimation();this.dragging=!1};b.ZoomTool.prototype._onMouseWheelChange=function(a){if(a&&a.data&&a.data.vp instanceof b.SeriesViewport)return!1;if(a.normalizedDelta&&0<Math.abs(a.normalizedDelta)){var c=a.data.vp.innerVp;if(c){var d=c.imgLook.zoom*Math.pow(1.04,-a.normalizedDelta);
d=Math.max(b.ZoomTool.MinZoom,Math.min(b.ZoomTool.MaxZoom,d));b.Utils.requestAnimFrame(function(){c.setZoom(d)})}a.preventDefault();return!0}return!1};b.ZoomTool.prototype._onVpDoubleClick=function(a){this.isActive&&a.data.vp.innerVp.setZoom(1)};b.ZoomTool.prototype.resetAllViewports=function(a){if(a)for(var c=0;c<a.length;c++)a[c].innerVp.setZoom(1)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Geometry=function(){};b.Geometry.convexHull=function(a){if(!a||1>=a.length)return a?a.slice():null;a=a.slice();a.sort(function(a,c){return a.x<c.x?-1:a.x>c.x?1:a.y<c.y?-1:a.y>c.y?1:0});var c,b,e=a.length,f=[];for(c=0;c<e;c++){for(b=a[c];2<=f.length;){var g=f[f.length-1];var h=f[f.length-2];if((g.x-h.x)*(b.y-h.y)>=(g.y-h.y)*(b.x-h.x))f.pop();else break}f.push(b)}f.pop();var m=[];for(c=e-1;0<=c;c--){for(b=a[c];2<=m.length;)if(g=m[m.length-1],h=m[m.length-2],(g.x-h.x)*(b.y-h.y)>=(g.y-
h.y)*(b.x-h.x))m.pop();else break;m.push(b)}m.pop();return 1===f.length&&1===m.length&&f[0].x===m[0].x&&f[0].y===m[0].y?f:f.concat(m)}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Matrix3=function(a,c,d,e,f,g,h,m,l){this.data=[0,0,0,0,0,0,0,0,0];0<arguments.length&&b.Matrix3.set(this,a,c,d,e,f,g,h,m,l)};b.Matrix3.fromArray=function(a){return new b.Matrix3(a)};b.Matrix3.clone=function(a){return new b.Matrix3(a)};b.Matrix3.identity=function(){return new b.Matrix3(1,0,0,0,1,0,0,0,1)};b.Matrix3.zero=function(){return new b.Matrix3};b.Matrix3.set=function(a,c,d,e,f,g,h,m,l,n){a||(a=new b.Matrix3);if(2===arguments.length)Array.isArray(c)&&9===c.length?a.data=c.slice():
ArrayBuffer.isView(c)&&9===c.length?a.data=Array.prototype.slice.call(c):c instanceof b.Matrix3?a.data=c.data.slice():b.Logger.Report("Matrix3.set: Invalid argument(s).",b.Logger.Severity.Error);else if(10===arguments.length){var k=a.data;k[0]=c;k[1]=d;k[2]=e;k[3]=f;k[4]=g;k[5]=h;k[6]=m;k[7]=l;k[8]=n}return a};b.Matrix3.toFloat32Array=function(a){var c=new Float32Array(9);a=a.data;for(var b=0;9>b;b++)c[b]=a[b];return c};b.Matrix3.toFloat64Array=function(a){var c=new Float64Array(9);a=a.data;for(var b=
0;9>b;b++)c[b]=a[b];return c};b.Matrix3.toArray=function(a){var c=Array(9);a=a.data;for(var b=0;9>b;b++)c[b]=a[b];return c};b.Matrix3.valueEquals=function(a,c,d){if(a===c)return!0;if(!a||!c)return!1;d=d||0;a=a.data;c=c.data;for(var e=0;9>e;e++)if(!b.Utils.floatEquals(a[e],c[e],d))return!1;return!0};b.Matrix3.negate=function(a,c){c=c.data;for(var b=a.data,e=0;9>e;e++)b[e]=-c[e];return a};b.Matrix3.negateInPlace=function(a){for(var c=a.data,b=0;9>b;b++)c[b]=-c[b];return a};b.Matrix3.Negate=function(a){var c=
new b.Matrix3,d=c.data;a=a.data;for(var e=0;9>e;e++)d[e]=-a[e];return c};b.Matrix3.add=function(a,c,b){for(var d=0;9>d;d++)a[d]=c[d]+b[d];return a};b.Matrix3.addInPlace=function(a,c){for(var b=0;9>b;b++)a[b]+=c[b];return a};b.Matrix3.Add=function(a,c){return new b.Matrix3(a[0]+c[0],a[1]+c[1],a[2]+c[2],a[3]+c[3],a[4]+c[4],a[5]+c[5],a[6]+c[6],a[7]+c[7],a[8]+c[8])};b.Matrix3.subtract=function(a,c,b){for(var d=0;9>d;d++)a[d]=c[d]-b[d];return a};b.Matrix3.subtractInPlace=function(a,c){for(var b=0;9>b;b++)a[b]-=
c[b];return a};b.Matrix3.Subtract=function(a,c){return new b.Matrix3(a[0]-c[0],a[1]-c[1],a[2]-c[2],a[3]-c[3],a[4]-c[4],a[5]-c[5],a[6]-c[6],a[7]-c[7],a[8]-c[8])};b.Matrix3.scale=function(a,c,b){for(var d=0;9>d;d++)a[d]=c[d]*b;return a};b.Matrix3.scaleInPlace=function(a,c){for(var b=0;9>b;b++)a[b]*=c;return a};b.Matrix3.Scale=function(a,c){return new b.Matrix3(a[0]*c,a[1]*c,a[2]*c,a[3]*c,a[4]*c,a[5]*c,a[6]*c,a[7]*c,a[8]*c)};b.Matrix3.rotation=function(a,c,d){Array.isArray(d)&&(d=b.Vec3.fromArray(d));
if(0===b.Vec3.norm(d))return b.Logger.Report("Matrix3.rotation: Invalid axis.",b.Logger.Severity.Error),b.Matrix3.identity();b.Vec3.normalizeInPlace(d);var e=d.x,f=d.y;d=d.z;var g=Math.sin(c);c=Math.cos(c);var h=1-c;a||(a=new b.Matrix3);var m=a.data;m[0]=e*e*h+c;m[1]=f*e*h+d*g;m[2]=d*e*h-f*g;m[3]=e*f*h-d*g;m[4]=f*f*h+c;m[5]=d*f*h+e*g;m[6]=e*d*h+f*g;m[7]=f*d*h-e*g;m[8]=d*d*h+c;return a};b.Matrix3.toString=function(a){return"("+a.x.toString()+", "+a.y.toString()+", "+a.z.toString()+")"}})(window.BigLime=
window.BigLime||{});(function(b,k){b.SeededRandGen=function(a){this.seed=a};b.SeededRandGen.prototype.next=function(){var a=1E4*Math.sin(this.seed++);return a-Math.floor(a)};b.SeededRandGen.prototype.nextInt=function(a){var c=1E4*Math.sin(this.seed++);return(c-Math.floor(c))*a+.5|0}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Vec2=function(a,c){this.x=a||0;this.y=c||0};b.Vec2.fromArray=function(a){return new b.Vec2(a[0],a[1])};b.Vec2.clone=function(a){return new b.Vec2(a.x,a.y)};b.Vec2.set=function(a,c,b){2===arguments.length?(a.x=c.x,a.y=c.y):3===arguments.length&&(a.x=c,a.y=b);return a};b.Vec2.toArray=function(a){return[a.x,a.y]};b.Vec2.toFloat32Array=function(a){var c=new Float32Array(2);c[0]=a.x;c[1]=a.y;return c};b.Vec2.toFloat64Array=function(a){var c=new Float64Array(2);c[0]=a.x;c[1]=a.y;return c};
b.Vec2.zero=function(){return new b.Vec2};b.Vec2.half=function(){return new b.Vec2(.5,.5)};b.Vec2.unitX=function(){return new b.Vec2(1,0)};b.Vec2.unitY=function(){return new b.Vec2(0,1)};b.Vec2.valueEquals=function(a,c,b){if(a===c)return!0;if(!a||!c)return!1;b=b||0;return Math.abs(a.x-c.x)>b||Math.abs(a.y-c.y)>b?!1:!0};b.Vec2.componentsEqual=function(a,c,b,e){e=e||0;return Math.abs(a.x-c)>e||Math.abs(a.y-b)>e?!1:!0};b.Vec2.negate=function(a,c){a.x=-c.x;a.y=-c.y;return a};b.Vec2.negateInPlace=function(a){a.x=
-a.x;a.y=-a.y;return a};b.Vec2.Negate=function(a){return new b.Vec2(-a.x,-a.y)};b.Vec2.add=function(a,c,b){a.x=c.x+b.x;a.y=c.y+b.y;return a};b.Vec2.addInPlace=function(a,c){a.x+=c.x;a.y+=c.y;return a};b.Vec2.Add=function(a,c){return new b.Vec2(a.x+c.x,a.y+c.y)};b.Vec2.subtract=function(a,c,b){a.x=c.x-b.x;a.y=c.y-b.y;return a};b.Vec2.subtractInPlace=function(a,c){a.x-=c.x;a.y-=c.y;return a};b.Vec2.Subtract=function(a,c){return new b.Vec2(a.x-c.x,a.y-c.y)};b.Vec2.scale=function(a,c,b){a.x=c.x*b;a.y=
c.y*b;return a};b.Vec2.scaleInPlace=function(a,c){a.x*=c;a.y*=c;return a};b.Vec2.Scale=function(a,c){return new b.Vec2(a.x*c,a.y*c)};b.Vec2.scaleAndAdd=function(a,c,b,e){a.x=c.x+b.x*e;a.y=c.y+b.y*e;return a};b.Vec2.scaleAndAddInPlace=function(a,c,b){a.x+=c.x*b;a.y+=c.y*b;return a};b.Vec2.ScaleAndAdd=function(a,c,d){return new b.Vec2(a.x+c.x*d,a.y+c.y*d)};b.Vec2.dot=function(a,c){return a.x*c.x+a.y*c.y};b.Vec2.cross=function(a,c){return a.x*c.y-a.y*c.x};b.Vec2.perp=function(a,c){a.x=c.y;a.y=-c.x;return a};
b.Vec2.Perp=function(a){return new b.Vec2(a.y,-a.x)};b.Vec2.normSq=function(a){var c=a.x;a=a.y;return c*c+a*a};b.Vec2.norm=function(a){var c=a.x;a=a.y;return Math.sqrt(c*c+a*a)};b.Vec2.normalize=function(a,c){var b=c.x;c=c.y;var e=b*b+c*c;0<e&&(e=Math.sqrt(e),a.x=b/e,a.y=c/e);return a};b.Vec2.normalizeInPlace=function(a){var c=a.x,b=a.y,e=c*c+b*b;0<e&&(e=Math.sqrt(e),a.x=c/e,a.y=b/e);return a};b.Vec2.Normalize=function(a){var c=a.x;a=a.y;var d=c*c+a*a;return 0<d?(d=Math.sqrt(d),new b.Vec2(c/d,a/d)):
new b.Vec2};b.Vec2.distance=function(a,c){var b=a.x-c.x;a=a.y-c.y;return Math.sqrt(b*b+a*a)};b.Vec2.distanceSq=function(a,c){var b=a.x-c.x;a=a.y-c.y;return b*b+a*a};b.Vec2.squaredDistanceToLineSegment=function(a,c,b){var d=b.x-c.x;b=b.y-c.y;var f=Math.pow(d,2)+Math.pow(b,2);if(1E-16>f)return Math.pow(a.x-c.x,2)+Math.pow(a.y-c.y,2);f=((a.x-c.x)*d+(a.y-c.y)*b)/f;f=Math.max(0,Math.min(1,f));return Math.pow(a.x-(c.x+f*d),2)+Math.pow(a.y-(c.y+f*b),2)};b.Vec2.round=function(a,b){a.x=Math.round(b.x);a.y=
Math.round(b.y);return a};b.Vec2.roundInPlace=function(a){a.x=Math.round(a.x);a.y=Math.round(a.y);return a};b.Vec2.Round=function(a){return new b.Vec2(Math.round(a.x),Math.round(a.y))};b.Vec2.floor=function(a,b){a.x=Math.floor(b.x);a.y=Math.floor(b.y);return a};b.Vec2.floorInPlace=function(a){a.x=Math.floor(a.x);a.y=Math.floor(a.y);return a};b.Vec2.Floor=function(a){return new b.Vec2(Math.floor(a.x),Math.floor(a.y))};b.Vec2.ceil=function(a,b){a.x=Math.ceil(b.x);a.y=Math.ceil(b.y);return a};b.Vec2.ceilInPlace=
function(a){a.x=Math.ceil(a.x);a.y=Math.ceil(a.y);return a};b.Vec2.Ceil=function(a){return new b.Vec2(Math.ceil(a.x),Math.ceil(a.y))};b.Vec2.toString=function(a){return"("+a.x.toString()+", "+a.y.toString()+")"}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Vec3=function(a,b,d){this.x=a||0;this.y=b||0;this.z=d||0};b.Vec3.fromArray=function(a){return new b.Vec3(a[0],a[1],a[2])};b.Vec3.clone=function(a){return new b.Vec3(a.x,a.y,a.z)};b.Vec3.set=function(a,b,d,e){2===arguments.length?(a.x=b.x,a.y=b.y,a.z=b.z):4===arguments.length&&(a.x=b,a.y=d,a.z=e);return a};b.Vec3.toFloat32Array=function(a){var b=new Float32Array(3);b[0]=a.x;b[1]=a.y;b[2]=a.z;return b};b.Vec3.toFloat64Array=function(a){var b=new Float64Array(3);b[0]=a.x;b[1]=a.y;b[2]=
a.z;return b};b.Vec3.toArray=function(a){var b=Array(3);b[0]=a.x;b[1]=a.y;b[2]=a.z;return b};b.Vec3.zero=function(){return new b.Vec3};b.Vec3.half=function(){return new b.Vec3(.5,.5,.5)};b.Vec3.unitX=function(){return new b.Vec3(1,0,0)};b.Vec3.unitY=function(){return new b.Vec3(0,1,0)};b.Vec3.unitZ=function(){return new b.Vec3(0,0,1)};b.Vec3.valueEquals=function(a,b,d){if(a===b)return!0;if(!a||!b)return!1;d=d||0;return Math.abs(a.x-b.x)>d||Math.abs(a.y-b.y)>d||Math.abs(a.z-b.z)>d?!1:!0};b.Vec3.componentsEqual=
function(a,b,d,e,f){f=f||0;return Math.abs(a.x-b)>f||Math.abs(a.y-d)>f||Math.abs(a.z-e)>f?!1:!0};b.Vec3.negate=function(a,b){a.x=-b.x;a.y=-b.y;a.z=-b.z;return a};b.Vec3.negateInPlace=function(a){a.x=-a.x;a.y=-a.y;a.z=-a.z;return a};b.Vec3.Negate=function(a){return new b.Vec3(-a.x,-a.y,-a.z)};b.Vec3.add=function(a,b,d){a.x=b.x+d.x;a.y=b.y+d.y;a.z=b.z+d.z;return a};b.Vec3.addInPlace=function(a,b){a.x+=b.x;a.y+=b.y;a.z+=b.z;return a};b.Vec3.Add=function(a,c){return new b.Vec3(a.x+c.x,a.y+c.y,a.z+c.z)};
b.Vec3.subtract=function(a,b,d){a.x=b.x-d.x;a.y=b.y-d.y;a.z=b.z-d.z;return a};b.Vec3.subtractInPlace=function(a,b){a.x-=b.x;a.y-=b.y;a.z-=b.z;return a};b.Vec3.Subtract=function(a,c){return new b.Vec3(a.x-c.x,a.y-c.y,a.z-c.z)};b.Vec3.scale=function(a,b,d){a.x=b.x*d;a.y=b.y*d;a.z=b.z*d;return a};b.Vec3.scaleInPlace=function(a,b){a.x*=b;a.y*=b;a.z*=b;return a};b.Vec3.Scale=function(a,c){return new b.Vec3(a.x*c,a.y*c,a.z*c)};b.Vec3.scaleAndAdd=function(a,b,d,e){a.x=b.x+d.x*e;a.y=b.y+d.y*e;a.z=b.z+d.z*
e;return a};b.Vec3.scaleAndAddInPlace=function(a,b,d){a.x+=b.x*d;a.y+=b.y*d;a.z+=b.z*d;return a};b.Vec3.ScaleAndAdd=function(a,c,d){return new b.Vec3(a.x+c.x*d,a.y+c.y*d,a.z+c.z*d)};b.Vec3.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};b.Vec3.cross=function(a,b,d){a.x=b.y*d.z-b.z*d.y;a.y=b.z*d.x-b.x*d.z;a.z=b.x*d.y-b.y*d.x;return a};b.Vec3.Cross=function(a,c){return new b.Vec3(a.y*c.z-a.z*c.y,a.z*c.x-a.x*c.z,a.x*c.y-a.y*c.x)};b.Vec3.normSq=function(a){var b=a.x,d=a.y;a=a.z;return b*b+d*d+a*a};
b.Vec3.norm=function(a){var b=a.x,d=a.y;a=a.z;return Math.sqrt(b*b+d*d+a*a)};b.Vec3.normalize=function(a,b){var c=b.x,e=b.y;b=b.z;var f=c*c+e*e+b*b;0<f&&(f=Math.sqrt(f),a.x=c/f,a.y=e/f,a.z=b/f);return a};b.Vec3.normalizeInPlace=function(a){var b=a.x,d=a.y,e=a.z,f=b*b+d*d+e*e;0<f&&(f=Math.sqrt(f),a.x=b/f,a.y=d/f,a.z=e/f);return a};b.Vec3.Normalize=function(a){var c=a.x,d=a.y;a=a.z;var e=c*c+d*d+a*a;return 0<e?(e=Math.sqrt(e),new b.Vec3(c/e,d/e,a/e)):new b.Vec3};b.Vec3.distance=function(a,b){var c=
a.x-b.x,e=a.y-b.y;a=a.z-b.z;return Math.sqrt(c*c+e*e+a*a)};b.Vec3.distanceSq=function(a,b){var c=a.x-b.x,e=a.y-b.y;a=a.z-b.z;return c*c+e*e+a*a};b.Vec3.round=function(a,b){a.x=Math.round(b.x);a.y=Math.round(b.y);a.z=Math.round(b.z);return a};b.Vec3.roundInPlace=function(a){a.x=Math.round(a.x);a.y=Math.round(a.y);a.z=Math.round(a.z);return a};b.Vec3.Round=function(a){return new b.Vec3(Math.round(a.x),Math.round(a.y),Math.round(a.z))};b.Vec3.floor=function(a,b){a.x=Math.floor(b.x);a.y=Math.floor(b.y);
a.z=Math.floor(b.z);return a};b.Vec3.floorInPlace=function(a){a.x=Math.floor(a.x);a.y=Math.floor(a.y);a.z=Math.floor(a.z);return a};b.Vec3.Floor=function(a){return new b.Vec3(Math.floor(a.x),Math.floor(a.y),Math.floor(a.z))};b.Vec3.ceil=function(a,b){a.x=Math.ceil(b.x);a.y=Math.ceil(b.y);a.z=Math.ceil(b.z);return a};b.Vec3.ceilInPlace=function(a){a.x=Math.ceil(a.x);a.y=Math.ceil(a.y);a.z=Math.ceil(a.z);return a};b.Vec3.Ceil=function(a){return new b.Vec3(Math.ceil(a.x),Math.ceil(a.y),Math.ceil(a.z))};
b.Vec3.toString=function(a){return"("+a.x.toString()+", "+a.y.toString()+", "+a.z.toString()+")"}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Canny=function(){};b.Canny.getEdgeMask=function(a,c,d,e,f){if(a.pixelType===b.PixelType.RGB)throw"Color images not supported, in Namespace.Canny.getEdgeMask.";a=b.Canny.getNonMaxSuppressedImg(a,c);d=f?[d,e]:b.Canny._getAbsoluteThresholds(a,d,e);return b.Canny._threshold(a,d[0],d[1])};b.Canny.getNonMaxSuppressedImg=function(a,c){if(a.pixelType===b.PixelType.RGB)throw"Color images not supported, in Namespace.Canny.getNonMaxSuppressedImg.";var d=a.width,e=a.height,f=d*e,g=b.Gradients.xGradient(a,
c);c=b.Gradients.yGradient(a,c);a=new b.FloatImage(d,e);g=g.data;c=c.data;var h=a.data,m=(new b.FloatImage(d,e)).data,l;for(l=0;l<f;l++){var n=g[l];var k=c[l];m[l]=n*n+k*k}for(f=1;f<e-1;f++)for(var r=f*d,t=1;t<d-1;t++){l=t+r;n=g[l];k=c[l];var p=m[l];Math.abs(n)<.4142*Math.abs(k)?p>=m[l-d]&&p>=m[l+d]&&(h[l]=Math.sqrt(p)):Math.abs(k)<.4142*Math.abs(n)?p>=m[l-1]&&p>=m[l+1]&&(h[l]=Math.sqrt(p)):0<n*k?p>=m[l+1+d]&&p>=m[l-1-d]&&(h[l]=Math.sqrt(p)):0>n*k&&p>=m[l+1-d]&&p>=m[l-1+d]&&(h[l]=Math.sqrt(p))}return a};
b.Canny._threshold=function(a,c,d){var e=a.width,f=a.height,g=e-1,h=f-1;f=new b.Mask(e,f);a=a.data;for(var m=f.data,l=1;l<h;l++)for(var n=l*e,k=1;k<g;k++){var r=k+n;if(0===m[r]&&a[r]>=c)for(m[r]=1,r=[],r.push(k),r.push(l);0<r.Count;)for(var t=r.pop(),p=r.pop(),u=-1;1>=u;u++)for(var v=t+u,w=v*e,y=-1;1>=y;y++){var z=p+y,x=z+w;0===m[x]&&a[x]>=d&&(m[x]=1,r.push(z),r.push(v))}}return f};b.Canny._getAbsoluteThresholds=function(a,c,d){a=new b.Histogram.fromImage(a,512);var e=a.bins,f=a.numSamples-e[0];c=
(1-c)*f|0;for(var g=511,h=e[g];h<c;){g--;if(0>g)break;h+=e[g]}var m=a.minPixVal+(g+.5)*a.binWidth;c=d*f|0;g=1;for(h=e[g];h<c;){g++;if(512<=g)break;h+=e[g]}return[m,a.minPixVal+(g+.5)*a.binWidth]}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Convolver=function(){};b.Convolver.convolve=function(a,b,d){var c=a.width,f=a.height,g=b.length,h=d.length;if(1!=g%2||1!=h%2)throw"Kernel size must be odd, in Convolver.convolve";if(g>c||h>f)throw"Kernel is larger than image, in Convolver.convolve";var m=2*c,l=2*f,n=(g-1)/2,k=(h-1)/2,r=a.clone(!0,!1,!1);a=a.data;var t=r.data,p=new Float32Array(new ArrayBuffer(4*c*f)),u,v,w,y;for(w=0;w<f;w++){var z=w*c;for(v=n;v<c-n;v++){var x=v-n+z;for(u=y=0;u<g;u++)y+=b[u]*a[u+x];p[v+z]=y}for(v=
0;v<n;v++){x=v-n;for(u=y=0;u<g;u++){var A=x+u;0>A&&(A=-A);y+=b[u]*a[A+z]}p[v+z]=y}for(v=c-n;v<c;v++){x=v-n;for(u=y=0;u<g;u++)A=x+u,A>=c&&(A=m-2-A),y+=b[u]*a[A+z];p[v+z]=y}}for(v=0;v<c;v++){for(w=k;w<f-k;w++){x=v+(w-k)*c;for(u=y=0;u<h;u++)y+=d[u]*p[x+u*c];t[v+w*c]=y}for(w=0;w<k;w++){x=w-k;for(u=y=0;u<h;u++)A=x+u,0>A&&(A=-A),y+=d[u]*p[v+A*c];t[v+w*c]=y}for(w=f-k;w<f;w++){x=w-k;for(u=y=0;u<h;u++)A=x+u,A>=f&&(A=l-2-A),y+=d[u]*p[v+A*c];t[v+w*c]=y}}return r}})(window.BigLime=window.BigLime||{});
(function(b,k){b.GaussianFilter=function(){};b.GaussianFilter.run=function(a,c,d){c=b.GaussianFilter.createGaussianKernel(c,d);return b.Convolver.convolve(a,c,c)};b.GaussianFilter.createGaussianKernel=function(a,b){if(!b&&0!==b||0>b)b=Math.ceil(1.52*a);var c=2*b+1,e=new Float32Array(new ArrayBuffer(4*c));a=1/(a*a);for(var f=0;f<=b;f++)e[b+f]=e[b-f]=Math.exp(-a*f*f);for(a=b=0;a<c;a++)b+=e[a];b=1/b;for(a=0;a<c;a++)e[a]*=b;return e}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Gradients=function(){};b.Gradients.xGradient=function(a,c){if(a.pixelType===b.PixelType.RGB)throw"Color images are not supported, in Namespace.Gradients.xGradient.";c||0===c||(c=1);var d=a.width,e=a.height,f=d-1,g=a.data;a=new b.FloatImage(d,e);for(var h=a.data,m=0;m<e;m++){var l=m*d,n=l;h[n]=g[n+1]-g[n];for(var k=1;k<f;k++)n=k+l,h[n]=.5*(g[n+1]-g[n-1]);n=f+l;h[n]=g[n]-g[n-1]}1<c&&(d=b.GaussianFilter.createGaussianKernel(c,Math.ceil(2*c)),c=b.GaussianFilter.createGaussianKernel(c),
a=b.Convolver.convolve(a,d,c));return a};b.Gradients.yGradient=function(a,c){if(a.pixelType===b.PixelType.RGB)throw"Color images are not supported, in Namespace.Gradients.yGradient.";c||0===c||(c=1);var d=a.width,e=a.height,f=a.data;a=new b.FloatImage(d,e);var g=a.data,h;for(h=0;h<d;h++)g[h]=f[h+d]-f[h];for(var m=e-1,l=1;l<m;l++){var n=l*d;for(h=0;h<d;h++){var k=h+n;g[k]=.5*(f[k+d]-f[k-d])}}e=(e-1)*d;for(h=0;h<d;h++)k=h+e,g[k]=f[k]-f[k-d];1<c&&(d=b.GaussianFilter.createGaussianKernel(c,Math.ceil(2*
c)),c=b.GaussianFilter.createGaussianKernel(c),a=b.Convolver.convolve(a,c,d));return a};b.Gradients.gradMag=function(a,c){var d=b.Gradients.xGradient(a,c);c=b.Gradients.yGradient(a,c);d=d.data;var e=c.data;a=a.width*a.height;for(var f=0;f<a;f++){var g=d[f],h=e[f];e[f]=Math.sqrt(g*g+h*h)}return c};b.Gradients.gradMagSq=function(a,c){var d=b.Gradients.xGradient(a,c);c=b.Gradients.yGradient(a,c);d=d.data;var e=c.data;a=a.width*a.height;for(var f=0;f<a;f++){var g=d[f],h=e[f];e[f]=g*g+h*h}return c}})(window.BigLime=
window.BigLime||{});
(function(b,k){b.Histogram=function(){this.bins=new Int32Array(1);this.binWidth=this.numSamples=this.numBins=1;this.maxPixVal=this.minPixVal=0};b.Histogram.fromImage=function(a,c){var d=new b.Histogram;d.bins=new Int32Array(c);d.numBins=c;d.numSamples=0;var e=a.width*a.height,f=b.ImageStatistics.getMinMax(a);d.minPixVal=f.min;d.maxPixVal=f.max;f=a.data;if(a instanceof b.FloatImage)for(d.binWidth=(d.maxPixVal-d.minPixVal)/c,0===d.binWidth&&(d.binWidth=1),a=0;a<e;a++)c=f[a],c=(c-d.minPixVal)/d.binWidth|
0,d.bins[c]+=1,d.numSamples++;else for(d.binWidth=(d.maxPixVal-d.minPixVal+1)/c,a=0;a<e;a++)c=f[a],c=(c-d.minPixVal+.5)/d.binWidth|0,d.bins[c]+=1,d.numSamples++;return d}})(window.BigLime=window.BigLime||{});
(function(b,k){b.ImageGeometry=function(){};b.ImageGeometry.flipHorizontal=function(a){var c=a.width,d=a.height,e=a.clone(!1,!1,!1),f=a.data,g=e.data,h;if(a.pixelType===b.PixelType.RGB)for(h=0;h<d;h++){var m=h*c;for(a=0;a<c;a++){var l=3*(a+m);var n=3*(c-1-a+m);g[l]=f[n];g[l+1]=f[n+1];g[l+2]=f[n+2]}}else for(h=0;h<d;h++)for(m=h*c,a=0;a<c;a++)g[a+m]=f[c-1-a+m];return e};b.ImageGeometry.flipVertical=function(a){var c=a.width,d=a.height,e=a.clone(!1,!1,!1),f=a.data,g=e.data;if(a.pixelType===b.PixelType.RGB)for(a=
0;a<d;a++){var h=d-1-a;var m=h*c;var l=a*c;for(h=0;h<c;h++){var n=3*(h+m);var k=3*(h+l);g[n]=f[k];g[n+1]=f[k+1];g[n+2]=f[k+2]}}else for(a=0;a<d;a++)for(h=d-1-a,m=h*c,l=a*c,h=0;h<c;h++)g[h+m]=f[h+l];return e};b.ImageGeometry.crop=function(a,c,d,e,f){var g=a.width,h=a.height;c=Math.round(c);d=Math.round(d);e=Math.round(e);f=Math.round(f);var m=Math.max(0,c),l=Math.max(0,d);c=Math.min(c+e,g)-m;d=Math.min(d+f,h)-l;if(0>=c||0>=d)return a instanceof b.Mask?new b.Mask(0,0):b.ImageBase.createImage(0,0,a.pixelType);
f=a instanceof b.Mask?new b.Mask(c,d):b.ImageBase.createImage(c,d,a.pixelType);h=f.data;e=a.data;var n;if(a.pixelType===b.PixelType.RGB)for(n=0;n<d;n++){var k=n*c;var r=(n+l)*g;for(a=0;a<c;a++){var t=3*(a+m+r);var p=3*(a+k);h[p]=e[t];h[p+1]=e[t+1];h[p+2]=e[t+2]}}else for(n=0;n<d;n++)for(k=n*c,r=(n+l)*g,a=0;a<c;a++)h[a+k]=e[a+m+r];return f};b.ImageGeometry.cropConstantBorder=function(a,c){var d=a,e=b.ImageGeometry.getBorderInfo(a);c||(c=0);e.cropRequired&&(e.modWidth*e.modHeight>=c*a.width*a.height?
d=b.ImageGeometry.crop(a,e.offset.x,e.offset.y,e.modWidth,e.modHeight):(e.offset=new b.Vec2(0,0),e.modWidth=a.width,e.modHeight=a.height,e.cropRequired=!1));return{image:d,offset:e.offset,cropped:e.cropRequired}};b.ImageGeometry.getBorderInfo=function(a){var c=a.width,d=a.height,e=a.data,f,g,h=a.pixelType===b.PixelType.RGB?!0:!1,m=0,l=a.getValue(0,0),n=!0;for(g=0;g<d&&n;g++){var k=g*c;for(f=0;f<c;f++)if(h){var r=3*(f+k);if(e[r]!=l.r||e[r+1]!=l.g||e[r+2]!=l.b){n=!1;break}}else if(e[f+k]!=l){n=!1;break}n&&
m++}var t=0;l=a.getValue(0,d-1);n=!0;for(g=d-1;g>=m&&n;g--){k=g*c;for(f=0;f<c;f++)if(h){if(r=3*(f+k),e[r]!=l.r||e[r+1]!=l.g||e[r+2]!=l.b){n=!1;break}}else if(e[f+k]!=l){n=!1;break}n&&t++}k=0;l=a.getValue(0,m);n=!0;for(f=0;f<c&&n;f++){if(h)for(g=m;g<d-t;g++){if(r=3*(f+g*c),e[r]!=l.r||e[r+1]!=l.g||e[r+2]!=l.b){n=!1;break}}else for(g=m;g<d-t;g++)if(e[f+g*c]!=l){n=!1;break}n&&k++}var p=0;l=a.getValue(c-1,m);n=!0;for(f=c-1;f>=k&&n;f--){if(h)for(g=m;g<d-t;g++){if(r=3*(f+g*c),e[r]!=l.r||e[r+1]!=l.g||e[r+
2]!=l.b){n=!1;break}}else for(g=m;g<d-t;g++)if(e[f+g*c]!=l){n=!1;break}n&&p++}return{offset:new b.Vec2(k,m),modWidth:c-k-p,modHeight:d-m-t,cropRequired:0<k||0<p||0<m||0<t}};b.ImageGeometry.centerPad=function(a,c,d,e){var f=a.width,g=a.height,h=Math.round((c-f)/2),m=Math.round((d-g)/2),l=a instanceof b.Mask?new b.Mask(c,d):b.ImageBase.createImage(c,d,a.pixelType);l.data.fill(e||0);e=l.data;var n=a.data,k=Math.max(0,h),r=Math.max(0,m),t=Math.min(h+f,c);d=Math.min(m+g,d);if(a.pixelType===b.PixelType.RGB)for(g=
r;g<d;g++){r=g*c;var p=(g-m)*f;for(a=k;a<t;a++){var u=3*(a-h+p);var v=3*(a+r);e[v]=n[u];e[v+1]=n[u+1];e[v+2]=n[u+2]}}else for(g=r;g<d;g++)for(r=g*c,p=(g-m)*f,a=k;a<t;a++)e[a+r]=n[a-h+p];return l}})(window.BigLime=window.BigLime||{});
(function(b,k){b.ImageBase.prototype.invert=function(a,c,d){var e=255;this.pixelType!==b.PixelType.Byte&&this.pixelType!==b.PixelType.RGB&&(e=b.ImageStatistics.getMinMax(this),e=e.max+e.min);a=a?this:this.clone(c,d,!1);c=a.data;d=this.data;for(var f=this.width*this.height*(this.pixelType===b.PixelType.RGB?3:1),g=0;g<f;g++)c[g]=e-d[g];return a};b.ImageBase.prototype.add=function(a){var c=this.data,d=this.width*this.height;if(this.pixelType===b.PixelType.RGB)for(var e=0;e<d;e++){var f=3*e;c[f]+=a.r;
c[f+1]+=a.g;c[f+2]+=a.b}else for(e=0;e<d;e++)c[e]+=a;return this};b.ImageBase.WeightedSum=function(a,c,d,e){a.width==d.width&&a.height==d.height&&a.pixelType===d.pixelType||b.Logger.Report("Incompatible images, in ImageBase.WeighteSum",b.Logger.Severity.Warning,!1,!0);var f=b.ImageBase.createImage(a.width,a.height,a.pixelType),g=a.data;d=d.data;var h=f.data,m=a.width*a.height;if(a.pixelType===b.PixelType.Byte)for(a=0;a<m;a++)h[a]=Math.max(0,Math.min(255,Math.round(g[a]*c+d[a]*e)));else if(a.pixelType===
b.PixelType.Ushort)for(a=0;a<m;a++)h[a]=Math.max(0,Math.min(65535,Math.round(g[a]*c+d[a]*e)));else if(a.pixelType===b.PixelType.Int)for(a=0;a<m;a++)h[a]=Math.max(-2147483648,Math.min(2147483647,Math.round(g[a]*c+d[a]*e)));else if(a.pixelType===b.PixelType.Float32)for(a=0;a<m;a++)h[a]=g[a]*c+d[a]*e;else if(a.pixelType===b.PixelType.RGB)for(a=0;a<m;a++){var l=3*a;h[l]=Math.max(0,Math.min(255,Math.round(g[l]*c+d[l]*e)));h[l+1]=Math.max(0,Math.min(255,Math.round(g[l+1]*c+d[l+1]*e)));h[l+2]=Math.max(0,
Math.min(255,Math.round(g[l+2]*c+d[l+2]*e)))}else b.Logger.Report("Unsupported pixel type, in ImageBase.WeighteSum",b.Logger.Severity.Warning,!1,!0);return f};b.ImageBase.prototype.multiplyBy=function(a){for(var c=this.data,d=this.width*this.height*(this.pixelType===b.PixelType.RGB?3:1),e=0;e<d;e++)c[e]*=a;return this}})(window.BigLime=window.BigLime||{});
(function(b,k){b.ImageStatistics=function(){};b.ImageStatistics.getMinMax=function(a){var c={min:0,max:0},d=a.width*a.height;a.pixelType===b.PixelType.RGB&&(d*=3);if(0<d){c=Number.POSITIVE_INFINITY;var e=Number.NEGATIVE_INFINITY;a=a.data;for(var f=0;f<d;f++){var g=a[f];g<c&&(c=g);g>e&&(e=g)}c={min:c,max:e}}return c};b.ImageStatistics.basicStats=function(a){var c={min:0,max:0,avg:0,sdev:0},d=a.width*a.height;a.pixelType===b.PixelType.RGB&&(d*=3);if(0<d){c=Number.POSITIVE_INFINITY;var e=Number.NEGATIVE_INFINITY,
f=0,g=0;a=a.data;for(var h=0;h<d;h++){var m=a[h];f+=m;g+=m*m;m<c&&(c=m);m>e&&(e=m)}f/=d;c={min:c,max:e,avg:f,sdev:Math.sqrt(Math.max(0,g/d-f*f))}}return c};b.ImageStatistics.calcAutoWinLevel=function(a,c){if(a.pixelType===b.PixelType.RGB)return{width:255,level:127.5};a=new b.Histogram.fromImage(a,512);for(var d=a.bins,e=.01*c*a.numSamples+.5|0,f=0,g=0;f<=e&&512>g;)for(f+=d[g],g++;512>g&&0===d[g];)g++;c=a.minPixVal+(g+.5)*a.binWidth;f=0;for(g=511;0<=g&&f<=e;)for(f+=d[g],g--;0<=g&&0===d[g];)g--;d=a.maxPixVal-
(511-g+.5)*a.binWidth;d<c&&(d=c);e=d-c;0===e&&(e=(a.maxPixVal-a.minPixVal)/10);return{width:e,level:(d+c)/2}}})(window.BigLime=window.BigLime||{});
(function(b,k){var a=b.Logger.Severity;b.Mask.prototype.add=function(c){if(this.width!=c.width||this.height!=c.height)b.Logger.Report("Size mismatch, in Mask.add",a.Error);else{var d=this.data;c=c.data;for(var e=this.width*this.height,f=0;f<e;f++)0<c[f]&&(d[f]=1)}};b.Mask.add=function(a,b){a=a.clone();a.add(b);return a};b.Mask.prototype.subtract=function(c){if(this.width!=c.width||this.height!=c.height)b.Logger.Report("Size mismatch, in Mask.subtract",a.Error);else{var d=this.data;c=c.data;for(var e=
this.width*this.height,f=0;f<e;f++)0<c[f]&&(d[f]=0)}};b.Mask.subtract=function(a,b){a=a.clone();a.subtract(b);return a};b.Mask.prototype.invert=function(a){var b=this.data,c=this.width*this.height;a=a||1;for(var f=0;f<c;f++)b[f]=0===b[f]?a:0};b.Mask.invert=function(a,b){a=a.clone();a.invert(b);return a};b.Mask.prototype.intersect=function(c){if(this.width!=c.width||this.height!=c.height)b.Logger.Report("Size mismatch, in Mask.intersect",a.Error);else{var d=this.data;c=c.data;for(var e=this.width*
this.height,f=0;f<e;f++)0===c[f]&&(d[f]=0)}};b.Mask.intersect=function(a,b){a=a.clone();a.intersect(b);return a};b.Mask.prototype.area=function(){for(var a=0,b=this.data,e=this.width*this.height,f=0;f<e;f++)0<b[f]&&a++;return a};b.Mask.prototype.centroid=function(){for(var a=this.width,d=this.height,e=this.data,f=0,g=0,h=0,m=0;m<d;m++)for(var l=m*a,k=0;k<a;k++)0<e[k+l]&&(g+=k,h+=m,f+=1);return 0===f?null:new b.Vec2(g/f,h/f)};b.Mask.prototype.getBorder=function(){var a=[];a.push(new b.Vec2(1,0));a.push(new b.Vec2(1,
-1));a.push(new b.Vec2(0,-1));a.push(new b.Vec2(-1,-1));a.push(new b.Vec2(-1,0));a.push(new b.Vec2(-1,1));a.push(new b.Vec2(0,1));a.push(new b.Vec2(1,1));var d=[],e=this.width,f=this.height,g=this.data,h,m=new b.Vec2(-1,-1);var l=0;a:for(;l<f;l++){var k=l*e;for(h=0;h<e;h++)if(0<g[h+k]){b.Vec2.set(m,h,l);break a}}if(0>m.x)return d;k=b.Vec2.half();d.push(b.Vec2.Add(m,k));for(var q=7;;){for(var r=0===q%2?(q+7)%8:(q+6)%8,t=!1,p=0;8>p;p++){var u=(r+p)%8;l=a[u];h=m.x+l.x;l=m.y+l.y;if(!(0>h||0>l||h>=e||
l>=f)&&g[h+l*e]){t=!0;b.Vec2.set(m,h,l);q=u;d.push(b.Vec2.Add(m,k));break}}if(!t)break;h=d.length;if(3<h&&b.Vec2.valueEquals(d[0],d[h-2],.01)&&b.Vec2.valueEquals(d[1],d[h-1],.01))break}3<d.length&&(d.pop(),d.pop());return d};b.Mask.prototype.addRegion=function(a){var b=a.numPoints();if(0!==b){var c=a.points;a=c[0][0];for(var f=c[0][1],g=a,h=f,m=0;m<b;m++){var l=c[m],k=l[0];l=l[1];k<a?a=k:k>g&&(g=k);l<f?f=l:l>h&&(h=l)}a=Math.floor(a);g=Math.ceil(g);f=Math.floor(f);h=Math.ceil(h);k=document.createElement("canvas");
k.width=g-a+1;k.height=h-f+1;m=k.getContext("2d");m.fillStyle="#ffffff";m.beginPath();m.moveTo(c[0][0]-a,c[0][1]-f);for(g=1;g<b;g++)h=c[g],m.lineTo(h[0]-a,h[1]-f);m.closePath();m.fill();b=k.width;c=k.height;g=this.width;h=this.height;m=new Uint32Array(m.getImageData(0,0,b,c).data.buffer);k=this.data;for(l=0;l<c;l++){var q=l+f;if(!(q>=h||0>q)){var r=l*b;q*=g;for(var t=0;t<b;t++){var p=t+a;p>=g||0>p||0<m[t+r]&&(k[p+q]=1)}}}}};b.Mask.prototype.erode=function(){for(var a=this.width,b=this.height,e=a-
1,f=b-1,g=this.data,h=new Uint32Array(a*b),m=0,l=0;l<b;l++)for(var k=l*a,q=0;q<a;q++){var r=q+k;g[r]&&(0<l&&0===g[r-a]||0<q&&0===g[r-1]||l<f&&0===g[r+a]||q<e&&0===g[r+1])&&(h[m++]=r)}for(a=0;a<m;a++)g[h[a]]=0;return this};b.Mask.prototype.skeletonize=function(){function a(a,b){for(var c=0,d=0;8>d;d++)0!==m[a+l[d][0]+f*(b+l[d][1])]&&c++;return c}function b(a,b){for(var c=0,d=0;8>d;d++)0===m[a+l[d][0]+f*(b+l[d][1])]&&0!==m[a+l[d+1][0]+f*(b+l[d+1][1])]&&c++;return c}function e(a,b,c){var d=0;c=k[c];
for(var e=0;2>e;e++)for(var g=0;3>g;g++){var h=l[c[e][g]];if(0===m[a+h[0]+f*(b+h[1])]){d++;break}}return 1<d}var f=this.width,g=this.height,h=this.clone(),m=h.data,l=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1],[0,-1]],k=[[[0,2,4],[2,4,6]],[[0,2,6],[0,4,6]]],q=[],r=!1;do{var t=!1;r=!r;for(var p=1;p<g-1;p++)for(var u=p*f,v=1;v<f-1;v++)if(0!==m[v+u]){var w=a(v,p);2>w||6<w||1!==b(v,p)||!e(v,p,r?0:1)||(q.push([v,p]),t=!0)}for(p=0;p<q.length;p++)u=q[p],m[u[0]+f*u[1]]=0;q=[]}while(r||t);return h};
b.Mask.prototype.getComponents=function(){for(var a=[],d=this.clone(),e=d.data,f=this.width,g=this.height,h=0;h<g;h++)for(var m=h*f,l=0;l<f;l++)if(0<e[l+m]){var k=b.RegionGrowing.growRegionFromSeeds(d,[{x:l,y:h}],.5,255);a.push(k);d.subtract(k)}a.sort(function(a,b){return b.area()-a.area()});return a};b.Mask.prototype.distanceMap=function(a){function c(a,b,c){return(a-b)*(a-b)+c*c}function e(a,b,c,d){return Math.floor((b*b-a*a+d*d-c*c)/(2*(b-a)))}a=a===k?!1:a;for(var f=this.height,g=this.width,h=
g+f,m=this.data,l=Array(g*f),n=0;n<g;n++){l[n]=m[n]?0:h;for(var q=1;q<f;q++){var r=n+q*g;l[r]=m[r]?0:1+l[r-g]}for(q=f-2;0<=q;q--)r=n+q*g,l[r+g]<l[r]&&(l[r]=1+l[r+g])}h=Array(g);m=Array(g);n=new b.IntImage(g,f);for(q=0;q<f;q++){r=q*g;var t=0;h[0]=0;m[0]=0;for(var p=1;p<g;p++){for(;0<=t&&c(m[t],h[t],l[h[t]+r])>c(m[t],p,l[p+r]);)t--;if(0>t)t=0,h[0]=p;else{var u=1+e(h[t],p,l[h[t]+r],l[p+r]);u<g&&(t++,h[t]=p,m[t]=u)}}for(p=g-1;0<=p;p--)u=c(p,h[t],l[h[t]+r]),n.data[p+r]=a?u:Math.round(Math.sqrt(u)),p==
m[t]&&t--}return n}})(window.BigLime=window.BigLime||{});
(function(b,k){b.MedianFilter=function(){};b.MedianFilter.run=function(a,c){if(a.pixelType===b.PixelType.RGB||a.pixelType===b.PixelType.Float32)throw"Image type not supported, in Namespace.MedianFilter.run";var d=a.clone(!0,!1,!1),e=a.data,f=d.data,g=a.width,h=a.height,k=0,l=0,n,q,r=(2*c+1)*(2*c+1),t=r/2;var p=b.ImageStatistics.getMinMax(a);a=p.min;var u=p.max-p.min+1,v=new Int32Array(u),w=new Int32Array(r);for(n=0;n<h;n++){var y=n*g;for(p=0;p<g;p++){if(0===p){for(q=0;q<r;q++)w[q]=0;for(q=0;q<u;q++)v[q]=
0;k=0;for(q=-c;q<=c;q++){var z=n+q;z=0>z?-z:z>=h?2*h-2-z:z;z*=g;for(l=-c;l<=c;l++){var x=p+l;x=0>x?-x:x>=g?2*g-2-x:x;x=e[x+z]-a;w[k++]=x;v[x]++}}w.sort?w.sort():Array.prototype.sort.call(w,function(a,b){return a-b});k=w[Math.floor((r-1)/2)];for(q=l=0;q<r;q++)if(w[q]<k)l++;else break}else{x=p-c-1;var A=p+c;0>x&&(x=-x);A>=g&&(A=2*g-2-A);for(q=-c;q<=c;q++){z=n+q;z=0>z?-z:z>=h?2*h-2-z:z;z*=g;var E=e[x+z]-a;v[E]--;E<k&&l--;z=e[A+z]-a;v[z]++;z<k&&l++}if(l<=t)for(;l+v[k]<=t;)l+=v[k],k++;else for(;l>t;)k--,
l-=v[k]}f[p+y]=k+a}}return d}})(window.BigLime=window.BigLime||{});
(function(b,k){b.RegionGrowing=function(){};b.RegionGrowing.growRegionFromSeeds=function(a,c,d,e){if(a.pixelType===b.PixelType.RGB)return b.Logger.Report("Color images are not supported, in RegionGrowing.growRegionFromSeeds",b.Logger.Severity.Error),a;var f=a.width,g=a.height,h=new b.Mask(f,g),k=h.data;a=a.data;$.isArray(c)||(c=[c]);for(var l=[],n,q,r=0;r<c.length;r++)n=c[r].x,q=c[r].y,0<=n&&n<f&&0<=q&&q<g&&(l.push(n),l.push(q),h.setValue(n,q,1));for(;0<l.length;)for(q=l.pop(),n=l.pop(),c=-1;1>=c;c++)if(r=
q+c,!(0>r||r>=g))for(var t=r*f,p=-1;1>=p;p++){var u=n+p,v=u+t;if(!(0>u||u>=f||0!==k[v])){var w=a[v];w>=d&&w<=e&&(k[v]=1,l.push(u),l.push(r))}}return h};b.RegionGrowing.growFuzzyRegionFromSeed=function(a,c){if(a.pixelType!==b.PixelType.Byte)return b.Logger.Report("Color images are not supported, in RegionGrowing.growFuzzyRegionFromSeed",b.Logger.Severity.Error),img;var d=a.width,e=a.height,f=a.data,g=new b.ByteImage(d,e),h=g.data,k=c.x,l=c.y;c=0;var n=[];0<=k&&k<d&&0<=l&&l<e&&(n.push(k),n.push(l),
g.setValue(k,l,255),c=a.getValue(k,l));for(;0<n.length;){a=n.pop();k=n.pop();l=g.getValue(k,a);for(var q=-1;1>=q;q++){var r=a+q;if(!(0>r||r>=e))for(var t=r*d,p=0===q?2:1,u=-1;1>=u;u+=p){var v=k+u;if(!(0>v||v>=d)){var w=v+t,y=255-Math.max(0,c-f[w]);y=Math.min(y,l);y>h[w]&&(h[w]=y,n.push(v),n.push(r))}}}}return g}})(window.BigLime=window.BigLime||{});
(function(b,k){var a=b.Logger.Severity;b.Resampler=function(){};b.Resampler.resampleNN=function(a,d,e){e||(e=d);var c=a.width,g=a.height,h=Math.max(1,Math.round(c*d)),k=Math.max(1,Math.round(g*e)),l=a instanceof b.Mask?new b.Mask(h,k):b.ImageBase.createImage(h,k,a.pixelType),n=l.data,q=a.data,r=1/d,t=new Int32Array(new ArrayBuffer(4*h)),p;for(p=0;p<h;p++){var u=r*(p+.5)|0;u>=c&&(u=c-1);t[p]=u}r=1/e;for(u=0;u<k;u++){var v=u*h;p=r*(u+.5)|0;p>=g&&(p=g-1);var w=p*c;for(p=0;p<h;p++)n[p+v]=q[t[p]+w]}b.Resampler._updatePixelSpacingAttrs(a,
l,1/d,1/e);return l};b.Resampler.resampleLin=function(a,d,e){e||(e=d);if(1<=d){if(1<=e)return b.Resampler.upsampleLin(a,d,e);a=b.Resampler.upsampleLin(a,d,1);return b.Resampler.downsampleAvg(a,1,e)}if(1>=e)return b.Resampler.downsampleAvg(a,d,e);a=b.Resampler.downsampleAvg(a,d,1);return b.Resampler.upsampleLin(a,1,e)};b.Resampler.downsampleAvg=function(c,d,e){e||(e=d);if(1<d||1<e)return b.Logger.Report("Downsample factor must be less than or equal to 1, in Resampler.downsampleAvg",a.Error),c;var f=
c.width,g=c.height,h=Math.max(1,Math.round(f*d)),k=Math.max(1,Math.round(g*e)),l=f-1,n=g-1,q=c instanceof b.Mask?new b.Mask(h,k):b.ImageBase.createImage(h,k,c.pixelType),r=q.data,t=c.data,p=b.Resampler._getDownsampleArrays(f,d),u=b.Resampler._getDownsampleArrays(g,e),v=p[0],w=p[1],y=p[2],z=p[3],x=p[4];p=u[0];var A=u[1],E=u[2],I=u[3];u=u[4];var J=c.pixelType!=b.PixelType.Float32,C,B,D=new Float64Array(h*g);for(B=0;B<g;B++){var F=B*f;for(C=0;C<h;C++){for(var H=v[C],G=w[C],K=0,L=H+1;L<G;L++){var M=L>
l?l:L;K+=t[M+F]}K*=z[C];K+=t[H+F]*y[C]+t[(G>l?l:G)+F]*x[C];D[C*g+B]=K}}for(C=0;C<h;C++)for(l=C*g,t=0;t<k;t++){v=p[t];w=A[t];y=0;for(B=v+1;B<w;B++)f=B>n?n:B,y+=D[f+l];y*=I[t];y+=D[v+l]*E[t]+D[(w>n?n:w)+l]*u[t];r[C+t*h]=J?Math.round(y):y}b.Resampler._updatePixelSpacingAttrs(c,q,1/d,1/e);return q};b.Resampler.upsampleLin=function(c,d,e){e||(e=d);if(1>d||1>e)return b.Logger.Report("Upsample factor must be greater than or equal to 1.0, in Resampler.upsampleLin",a.Error),c;var f=c.width,g=c.height,h=Math.max(1,
Math.round(f*d)),k=Math.max(1,Math.round(g*e)),l=c instanceof b.Mask?new b.Mask(h,k):b.ImageBase.createImage(h,k,c.pixelType),n=l.data,q=c.data,r=b.Resampler._getUpsampleLinArrays(f,d),t=b.Resampler._getUpsampleLinArrays(g,e);g=r[0];var p=r[1],u=r[2];r=r[3];var v=t[0],w=t[1],y=t[2];t=t[3];for(var z=c.pixelType!=b.PixelType.Float32,x=0;x<k;x++)for(var A=y[x],E=t[x],I=v[x]*f,J=w[x]*f,C=x*h,B=0;B<h;B++){var D=u[B],F=r[B],H=g[B],G=p[B];D=A*(D*q[H+I]+F*q[G+I])+E*(D*q[H+J]+F*q[G+J]);n[B+C]=z?Math.round(D):
D}b.Resampler._updatePixelSpacingAttrs(c,l,1/d,1/e);return l};b.Resampler._getDownsampleArrays=function(a,b){a=Math.max(1,Math.round(a*b));var c=new Int32Array(a),d=new Int32Array(a),g=new Float64Array(a),h=new Float64Array(a),k=new Float64Array(a);b=1/b;for(var l=0;l<a;l++){var n=b*l,q=n+b;c[l]=Math.floor(n);d[l]=Math.floor(q);var r=q-Math.floor(q);q=1/(q-n);g[l]=(1-(n-Math.floor(n)))*q;k[l]=r*q;h[l]=q}return[c,d,g,h,k]};b.Resampler._getUpsampleLinArrays=function(a,b){var c=Math.max(1,Math.round(a*
b)),d=new Int32Array(c),g=new Int32Array(c),h=new Float64Array(c),k=new Float64Array(c);b=1/b;for(var l=0;l<c;l++){var n=b*(l+.5);d[l]=Math.max(0,Math.floor(n-.5));g[l]=d[l]+1;0>n-.5&&(g[l]=0);g[l]>=a&&(g[l]=a-1);h[l]=Math.min(1,g[l]+.5-n);k[l]=1-h[l]}return[d,g,h,k]};b.Resampler._updatePixelSpacingAttrs=function(a,b,e,f){if(a.attrs&&b.attrs&&(f||(f=e),a.attrs.pixelSpacing&&(b.attrs.pixelSpacing=a.attrs.pixelSpacing*e),e=[e,f],(a=a.attrs.dicomAttrs["00280030"])&&$.isArray(a))){f=[];for(var c=0;c<
a.length;c++)f.push(a[c]*e[c]);b.attrs.dicomAttrs["00280030"]=f}}})(window.BigLime=window.BigLime||{});
(function(b,k){b.Thresholding=function(){};b.Thresholding.IsoData=function(a,c){if(a.pixelType===b.PixelType.RGB)return b.Logger.Report("Color images are not supported, in Thresholding.IsoData",b.Logger.Severity.Error),k;c||(c=a instanceof b.ByteImage?256:512);var d=b.ImageStatistics.getMinMax(a);if(d.min===d.max)return d.min;c=Math.min(d.max-d.min+1,c);c=b.Histogram.fromImage(a,c);var e=c.bins,f=0,g,h,m,l;do{for(var n=g=h=m=l=0;n<=f;n++)g+=n*e[n],h+=e[n];for(n=f+1;n<c.numBins;n++)m+=n*e[n],l+=e[n];
g=(g/h+m/l)/2;f++}while(f+1<=g&&f<c.numBins-1);g=(g+.5)*c.binWidth+d.min;a instanceof b.FloatImage||(g=Math.round(g));return g}})(window.BigLime=window.BigLime||{});
